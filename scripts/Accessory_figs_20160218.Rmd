#Data 0. means, counts to include in manuscript
```{r}
#number of plants in study
count(subset(SummaryInd,age>1))

#number of reproducing individuals in study
count(subset(SummaryInd,repro_inv>0))

#number of individuals in study that produce seed
count(subset(SummaryInd,seed_count>0))

#average proportion energy going to failed tissues (among reproducing individuals)
mean(subset(SummaryInd$prop_failure,SummaryInd$prop_failure>0))

#average proportion of energy going to accessory costs (based on propagules, not seeds) (among individuals that produce seed)
mean(subset(SummaryInd$prop_accessory_seed,SummaryInd$seed_count>0))
mean(subset(SummaryInd$prop_accessory_ee,SummaryInd$seed_count>0))
SummarySpp[["mean"]]$prop_accessory_seed

check <- dplyr::select(SummarySpp[["mean"]],species,prop_accessory_ee,prop_accessory_seed)
check <- dplyr::arrange(check,prop_accessory_ee)
  
#individual with lowest accessory costs
check <- subset(SummaryInd,prop_propagule_ee>.1)
check <- dplyr::select(check,individual,prop_propagule_ee)
max(check$prop_propagule_ee)

#relationship between plant weight and number of ovules initiated - bigger plants produce proportionally fewer buds
mod <- sma(repro_all_count~total_weight,SummaryInd,method="OLS",log="xy",slope=1)
summary(mod)

#there is no relationship between the proportion of energy going to seeds and the total energy for seedcosts
mod <- sma(seed_costs~prop_seed_costs,SummarySpp[["mean"]],method="OLS",log="y")
summary(mod)

#more failure = lower seedset across species - in discussion
mod <- sma(seedset ~ prop_failure, data=subset(SummarySpp[["mean"]],species!="BAER"),method="OLS", log="",slope.test=1)
summary(mod)
plot(seedset ~ prop_failure, SummarySpp[["mean"]],log="",pch=16,col=col.spp(species))

#seed size by propagule investment - all species
mod <- sma(propagule_inv ~ embryo_endo_size, SummarySpp[["mean"]],method="OLS", log="xy",slope.test=1)
summary(mod)
plot(propagule_inv_ee ~ embryo_endo_size, SummarySpp[["mean"]],log="xy",pch=16,col=col.spp(species))

#seed size by propagule investment - without EPMI
mod <- sma(propagule_inv ~ embryo_endo_size, data=subset(SummarySpp[["mean"]],species!="EPMI"),method="OLS", log="xy",slope.test=1)
summary(mod)
plot(propagule_inv ~ embryo_endo_size, data=subset(SummarySpp[["mean"]],species!="EPMI"),log="xy",pch=16,col=col.spp(species))

#seed size by reproductive investment - all species
mod <- sma(repro_inv ~ embryo_endo_size, SummarySpp[["mean"]],method="OLS", log="xy",slope.test=1)
summary(mod)
plot(repro_inv ~ embryo_endo_size, SummarySpp[["mean"]],log="xy",pch=16,col=col.spp(species))

#seed size by reproductive investment - without EPMI
mod <- sma(repro_inv ~ embryo_endo_size, data=subset(SummarySpp[["mean"]],species!="EPMI"),method="OLS", log="xy",slope.test=1)
summary(mod)
plot(repro_inv ~ embryo_endo_size, data=subset(SummarySpp[["mean"]],species!="EPMI"),log="xy",pch=16,col=col.spp(species))

#seed size by total weight - all species
mod <- sma(total_weight_0 ~ embryo_endo_size, SummarySpp[["mean"]],method="OLS", log="xy",slope.test=1)
summary(mod)
plot(total_weight_0 ~ embryo_endo_size, SummarySpp[["mean"]],log="xy",pch=16,col=col.spp(species))

yvar <- "repro_all_count"
xvar <- "repro_inv"
data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], method="OLS", log="xy")
results <- lines(fit$groupsummary)
plot(fit,xlab=xvar,ylab=yvar,pch=16, col=col.spp(fit$groupsummary$group),lty=results$linetype,ylim=c(1,300000),xlim=c(1,30000))
results

yvar <- "repro_all_count"
xvar <- "leaf_area_0"
data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], method="OLS", log="xy",slope.test=1)
results <- lines(fit$groupsummary)
plot(fit,xlab=xvar,ylab=yvar,pch=16, col=col.spp(fit$groupsummary$group),lty=results$linetype,ylim=c(1,300000),xlim=c(1,30000))
results

yvar <- "propagule_inv"
xvar <- "leaf_area_0"
data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], method="OLS", log="xy",slope.test=1)
results <- lines(fit$groupsummary)
plot(fit,xlab=xvar,ylab=yvar,pch=16, col=col.spp(fit$groupsummary$group),lty=results$linetype,ylim=c(1,300000),xlim=c(1,30000))
results

yvar <- "propagule_inv"
xvar <- "leaf_area_0_mature"
data <- subset(SummarySppAge[["mean"]],SummarySppAge[["mean"]][[xvar]]>0&SummarySppAge[["mean"]][[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], method="OLS", log="xy")
results <- lines(fit$groupsummary)
plot(fit,xlab=xvar,ylab=yvar,pch=16, col=col.spp(fit$groupsummary$group),lty=results$linetype,ylim=c(1,300000),xlim=c(1,30000))
results

xvar <- "propagule_inv"
yvar <- "repro_inv"
data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], method="OLS", log="xy",slope.test=1)
results <- lines(fit$groupsummary)
plot(fit,xlab=xvar,ylab=yvar,pch=16, col=col.spp(fit$groupsummary$group),lty=results$linetype,ylim=c(1,300000),xlim=c(1,30000))
results
```

#Table 1 showing accessory cost values for the species
```{r}
acc_costs_spp <- dplyr::select(SummarySpp[["mean"]],species,embryo_endo_size,repro_inv_per_seed,prop_failure,prop_prepollen_vs_RE, prop_dispersal_vs_RE,prop_embryo_endo_vs_RE,seed_costs,prop_prepollen_costs,prop_postpollen_costs)
acc_costs_spp$species <- labels.spp.full()
acc_costs_spp_format <- acc_costs_spp
for (i in c("embryo_endo_size","repro_inv_per_seed","prop_failure","prop_prepollen_vs_RE","prop_dispersal_vs_RE","prop_embryo_endo_vs_RE","seed_costs","prop_prepollen_costs","prop_postpollen_costs")) {
  acc_costs_spp_format[[i]] <- round(acc_costs_spp_format[[i]],digits=3)
}

write.csv(acc_costs_spp_format, file="figs2/Accessory_Costs/Table01_AccCosts_by_Species.csv",row.names=FALSE)
```

#Table 1 OLD showing accessory cost values for the species
```{r}
acc_costs_spp <- dplyr::select(SummarySpp[["mean"]],species,seed_size,embryo_endo_size,accessory_per_seed,prop_accessory_nonzero,seed_costs,prop_success, prepollen_costs,pack_disp_costs,failure_per_seed,prop_failure,prepollen_failure_per_seed,postpollen_aborted_per_seed, seedset)
acc_costs_spp$species <- labels.spp.full()
acc_costs_spp_format <- acc_costs_spp
acc_costs_spp_format$seed_size <- round(acc_costs_spp_format$seed_size,digits=3)
acc_costs_spp_format$embryo_endo_size <- round(acc_costs_spp_format$embryo_endo_size,digits=3)
acc_costs_spp_format$accessory_per_seed2 <- paste(round(acc_costs_spp_format$accessory_per_seed,digits=1)," (",
                                                 round(acc_costs_spp_format$prop_accessory_nonzero,digits=2),")")
acc_costs_spp_format$seed_costs2 <- paste(round(acc_costs_spp_format$seed_costs,digits=2)," (",
                                                 round(acc_costs_spp_format$prop_success,digits=2),")")
acc_costs_spp_format$prepollen_costs <- round(acc_costs_spp_format$prepollen_costs,digits=2)
acc_costs_spp_format$pack_disp_costs <- round(acc_costs_spp_format$pack_disp_costs,digits=2)
acc_costs_spp_format$failure_per_seed <- paste(round(acc_costs_spp_format$failure_per_seed,digits=2)," (",
                                                 round(acc_costs_spp_format$prop_failure,digits=2),")")
acc_costs_spp_format$prepollen_failure_per_seed <- round(acc_costs_spp_format$prepollen_failure_per_seed,digits=2)
acc_costs_spp_format$postpollen_aborted_per_seed <- round(acc_costs_spp_format$postpollen_aborted_per_seed,digits=2)
acc_costs_spp_format$seedset <- round(acc_costs_spp_format$seedset,digits=3)
acc_costs_spp_format <- dplyr::select(acc_costs_spp_format,species,seed_size,embryo_endo_size,accessory_per_seed2,seed_costs2,prepollen_costs,pack_disp_costs ,failure_per_seed,prepollen_failure_per_seed,postpollen_aborted_per_seed,seedset,accessory_per_seed,seedcosts)
acc_costs_spp_format

write.csv(acc_costs_spp_format, file="figs2/Accessory_Costs/Table01_OLD_AccCosts_by_Species.csv",row.names=FALSE)
```

#Figure 3. Ternary diagram showing seed_costs
```{r}
ternary <- dplyr::select(SummarySpp[["mean"]],species,seed_size,prepollen_costs,pack_disp_costs,seed_costs,embryo_endo_size)
ternary$per_poll <-100*ternary$prepollen_costs/ternary$seed_costs
ternary$post_poll <- 100-ternary$per_poll
ternary$per_seed <-100*ternary$embryo_endo_size/ternary$seed_costs
ternary$per_disp <-100*ternary$pack_disp_costs/ternary$seed_costs

mod_poll <- sma(per_poll~seed_costs,ternary,slope.test=0,method="OLS",log="x")
mod_seed <- sma(per_seed~seed_costs,ternary,slope.test=0,method="OLS",log="x")
mod_disp <- sma(per_disp~seed_costs,ternary,slope.test=0,method="OLS",log="x")
mod_post_poll <- sma(post_poll~seed_costs,ternary,slope.test=0,method="OLS",log="x")

costs_per_seed <- as.data.frame("costs for seed (%)")
costs_per_seed <- cbind(costs_per_seed,dplyr::select(mod_seed$groupsummary,r2,pval,Int,Slope,Slope_lowCI,Slope_highCI,Slope_test,Slope_test_p))
names(costs_per_seed) <- c("investment category (mg)","r squared","p value","intercept","slope","slope_lowCI","slope_highCI","slope test","slope test p")

costs_per_seed2 <- as.data.frame("costs for pre-pollination (%)")
costs_per_seed2 <- cbind(costs_per_seed2,dplyr::select(mod_poll$groupsummary,r2,pval,Int,Slope,Slope_lowCI,Slope_highCI,Slope_test,Slope_test_p))
names(costs_per_seed2) <- c("investment category (mg)","r squared","p value","intercept","slope","slope_lowCI","slope_highCI","slope test","slope test p")
costs_per_seed <- rbind(costs_per_seed,costs_per_seed2)

costs_per_seed2 <- as.data.frame("costs for dispersal (%)")
costs_per_seed2 <- cbind(costs_per_seed2,dplyr::select(mod_disp$groupsummary,r2,pval,Int,Slope,Slope_lowCI,Slope_highCI,Slope_test,Slope_test_p))
names(costs_per_seed2) <- c("investment category (mg)","r squared","p value","intercept","slope","slope_lowCI","slope_highCI","slope test","slope test p")
costs_per_seed <- rbind(costs_per_seed,costs_per_seed2)

write.csv(costs_per_seed, file="figs2/Accessory_Costs/Table00_in_text_costs_per_seed.csv",row.names=FALSE)

win.metafile("figs2/Accessory_Costs/FigureXX_seedcost_components.wmf", height=6, width=6)
plot

plot(per_seed~seed_costs,ternary,col="black",log="x",pch=21,cex=2,ylim=c(0,75),ylab="prop of seed_costs")
points(per_poll~seed_costs,ternary,col="red",pch=16,cex=2)
points(per_disp~seed_costs,ternary,col="blue",pch=16,cex=2)

abline(mod_poll$groupsummary["Int"][[1]],mod_poll$groupsummary["Slope"][[1]],col="red",lwd=2)
abline(mod_seed$groupsummary["Int"][[1]],mod_seed$groupsummary["Slope"][[1]],col="black",lty=2,lwd=2)
abline(mod_disp$groupsummary["Int"][[1]],mod_disp$groupsummary["Slope"][[1]],col="blue",lwd=2)
legend("topright",legend=c("seed","prepollen","pack&disp"),col=c("black","red","blue"),pch=16, cex=1.1,bty="n")
v <- sqrt(ternary$seed_costs/500)
ternary$horz <- c(1.8,1.3,1.2,-0.3,0.6,0.6,0.5,-0.2,1.3,1.7,1.4,-0.2,-0.3,-0.3)
ternary$vert <- c(v[1]*-1.7,v[2]*1.1,v[3]*1.2,v[4],v[5]*-2.3,v[6]*4.5,v[7],v[8]*1.6,v[9],v[10]*0.2,v[11],v[12],v[13],v[14])
ternary = ternary[with(ternary, order(-seed_costs)), ]
label <- 20

dev.off()
library(ggtern)
win.metafile("figs2/Accessory_Costs/Figure03_ternary_diagram_seed_costs.wmf", height=5, width=5)
plot

par(mfrow=c(1,1), cex=1, omi=c(2,2,2,2), mai=c(2,2,2,2)) 


ggtern(data=ternary,aes(y=per_seed,x=per_poll,z=per_disp)) +
      geom_point(size=sqrt(ternary$seed_costs/2),shape=20,color=col.spp(ternary$species)) +
      theme_bw() + 
      theme_showarrows() +
      geom_text(label=ternary$species, color="black", hjust=ternary$horz, 
                 vjust=ternary$vert,size=2) +
      ggtitle("Seed cost components")+
      labs(T="embryo+endosperm",L="pre-pollination",R="provisioning")+
      Tarrowlab("embryo + endosperm weight (%)")+
      Larrowlab("pre-pollination costs (%)")+
      Rarrowlab("provisioning costs (%)")+
      theme(plot.title = element_text(size=11,face="bold"))+
      theme(tern.axis.title.T = element_text(size=9,face="plain"))+
      theme(tern.axis.title.L = element_text(size=9,face="plain",hjust=0,vjust=1.7))+
      theme(tern.axis.title.R = element_text(size=9,face="plain",hjust=1,vjust=1.7))+
      theme(tern.axis.arrow.text = element_text(size=9,face="plain"))+
      theme(tern.axis.arrow.start= 0.2)+ 
      theme(tern.axis.arrow.finish=0.8)


dev.off()
```

#Table 2 showing seedcost breakdown into components, by species
```{r}
prop_seed_costs_spp <- dplyr::select(SummarySpp[["mean"]],species,seed_costs,prop_prepollen_costs,prop_dispersal_costs,prop_embryo_endo_costs)
prop_seed_costs_spp$species <- labels.spp.full()

mod_1 <- sma(seed_costs~prop_prepollen_costs,SummarySpp[["mean"]],log="y")
mod_2 <- sma(seed_costs~prop_dispersal_costs,SummarySpp[["mean"]],log="y")
mod_3 <- sma(seed_costs~prop_embryo_endo_costs,SummarySpp[["mean"]],log="y")

row_x <- as.data.frame(0)
row_1 <- as.data.frame("r2")
row_1 <- as.data.frame(dplyr::bind_cols(row_1,row_x,as.data.frame(mod_1$groupsummary[1,3]),as.data.frame(mod_2$groupsummary[1,3]),as.data.frame(mod_3$groupsummary[1,3])))
names(row_1) <- c("species","seed_costs","prop_prepollen_costs","prop_dispersal_costs","prop_embryo_endo_costs")

row_2 <- as.data.frame("p-value")
row_2 <- dplyr::bind_cols(row_2,row_x,as.data.frame(mod_1$groupsummary[1,4]),as.data.frame(mod_2$groupsummary[1,4]),as.data.frame(mod_3$groupsummary[1,4]))
names(row_2) <- c("species","seed_costs","prop_prepollen_costs","prop_dispersal_costs","prop_embryo_endo_costs")

row_3 <- as.data.frame("slope")
row_3 <- dplyr::bind_cols(row_3,row_x,as.data.frame(mod_1$groupsummary[1,5]),as.data.frame(mod_2$groupsummary[1,5]),as.data.frame(mod_3$groupsummary[1,5]))
names(row_3) <- c("species","seed_costs","prop_prepollen_costs","prop_dispersal_costs","prop_embryo_endo_costs")

prop_seed_costs_spp <- dplyr::bind_rows(prop_seed_costs_spp,row_1,row_2,row_3)

write.csv(prop_seed_costs_spp, file="figs2/Accessory_Costs/Table02_Prop_seed_costs_by_Species.csv",row.names=FALSE)
```

#Figure 4. Scaling of accessory costs versus seed size, by species
```{r}
win.metafile("figs2/Accessory_Costs/Figure04_seed_size_acc_cost_correlations.wmf", height=5, width=15)
plot

par(mfcol=c(3,1), cex=1, omi=c(.6,.1,.05,.05), mai=c(.1,.8,.05,.05)) 
options(scipen = 5)

plot(accessory_per_seed ~ seed_size,data=subset(SummarySpp[["mean"]]),col=col.spp(species),pch=16,log="xy", yaxt="n",xaxt="n", ylim=c(.02,20000), xlim=c(.02,20000), ylab="total accessory costs per seed (mg/seed)",xlab="",cex=1.5)
mod <- sma(accessory_per_seed~seed_size,data=subset(SummarySpp[["mean"]],accessory_per_seed>0),log="xy",method="OLS")
y.error.bars(SummarySpp[["mean"]]$seed_size,SummarySpp[["mean"]]$accessory_per_seed,SummarySpp[["se"]]$accessory_per_seed)
sma_abline(mod)
abline(mod$groupsummary["Int"][[1]],1,lty=2)
axis(2, at=c(0.1,10,1000), labels=c(0.1,10,1000),cex.axis=1)
axis(1, at=c(0.1,10,1000), labels=c("","",""),cex.axis=1)

plot(prepollen_costs~seed_size,SummarySpp[["mean"]],col=col.spp(species),pch=16,log="xy", yaxt="n",xaxt="n", ylim=c(.02,20000), xlim=c(.02,20000), ylab="required pollinator attraction costs per seed (mg/seed)",xlab="",cex=1.5)
#y.error.bars(SummarySpp[["mean"]]$seed_size,SummarySpp[["mean"]]$prepollen_costs,SummarySpp[["se"]]$prepollen_costs)
mod <- sma(prepollen_costs~seed_size,SummarySpp[["mean"]],log="xy",method="OLS")
sma_abline(mod)
abline(mod$groupsummary["Int"][[1]],1,lty=2)
axis(2, at=c(0.1,10,1000), labels=c(0.1,10,1000),cex.axis=1)
axis(1, at=c(0.1,10,1000), labels=c("","",""),cex.axis=1)

plot(pack_disp_costs~seed_size,SummarySpp[["mean"]],col=col.spp(species),pch=16,log="xy", yaxt="n",xaxt="n", ylim=c(.02,20000), xlim=c(.02,20000), ylab="required provisioning costs per seed (mg/seed)",xlab="",cex=1.5)
y.error.bars(SummarySpp[["mean"]]$seed_size,SummarySpp[["mean"]]$pack_disp_costs,SummarySpp[["se"]]$pack_disp_costs)
mod <- sma(postpollen_all_per_seed~seed_size,SummarySpp[["mean"]],log="xy",method="OLS")
sma_abline(mod)
abline(mod$groupsummary["Int"][[1]],1,lty=2)
axis(2, at=c(0.1,10,1000), labels=c(0.1,10,1000),cex.axis=1)
axis(1, at=c(0.1,10,1000), labels=c(0.1,10,1000),cex.axis=1)
mtext(text="seed size (mg)",side=1,line=1.5,outer=TRUE)
dev.off()
```

#Figure 4 v2. Scaling of accessory costs versus weight of embryo + endosperm, by species
```{r}
win.metafile("figs2/Accessory_Costs/Figure04_embryo_size_acc_cost_correlations.wmf", height=15, width=5)
plot

par(mfrow=c(2,2), cex=1, omi=c(.6,.1,.05,.05), mai=c(.1,.8,.05,.05)) 
options(scipen = 5)

# plot(accessory_per_seed ~ embryo_endo_size,data=subset(SummarySpp[["mean"]]),col=col.spp(species),pch=16,log="xy", yaxt="n",xaxt="n", ylim=c(.02,20000), xlim=c(.02,20000), ylab="total accessory costs per seed (mg/seed)",xlab="",cex=1.5)
# mod <- sma(accessory_per_seed ~ embryo_endo_size,data=subset(SummarySpp[["mean"]],accessory_per_seed>0),log="xy",method="OLS")
# plot(mod,pch=16,log="xy", yaxt="n",xaxt="n", ylim=c(.02,20000), xlim=c(.02,20000), ylab="total accessory costs per seed (mg/seed)",xlab="",cex=1.5,col="black")
# points(accessory_per_seed ~ embryo_endo_size,data=subset(SummarySpp[["mean"]]),col=col.spp(species),pch=16,cex=1.5)
# y.error.bars.2(SummarySpp[["mean"]]$embryo_endo_size,SummarySpp[["mean"]]$accessory_per_seed,SummarySpp[["se"]]$accessory_per_seed)
# #sma_abline(mod)
# abline(mod$groupsummary["Int"][[1]],1,lty=2)
# axis(2, at=c(0.1,10,1000), labels=c(0.1,10,1000),cex.axis=1)
# axis(1, at=c(0.1,10,1000), labels=c("","",""),cex.axis=1)

plot(seedset~embryo_endo_size,SummarySpp[["mean"]],log="xy",col=col.spp(species),pch=16, xlim=c(.015,60),ylim=c(.01,.6),cex=1.5,xaxt="n",xlab="seed size (mg)",ylab="seed set")
mod <- sma(seedset~embryo_endo_size,SummarySpp[["mean"]],log="xy", method="OLS")
y.error.bars.2(SummarySpp[["mean"]]$embryo_endo_size,SummarySpp[["mean"]]$seedset,SummarySpp[["se"]]$seedset)
text((10^(0.99*(par("usr")[2]-par("usr")[1])+par("usr")[1])),(10^(0.97*(par("usr")[4]-par("usr")[3])+par("usr")[3])),paste("r2 = ",round(sma_sum(mod)[1],2)),adj=1)
line_function_log_xy(SummarySpp[["mean"]]$embryo_endo_size,mod,1)
axis(1, at=c(0.1,1,10), labels=c("","",""),cex.axis=1)

plot((scaled_seed_count)~(embryo_endo_size),SummaryInd,pch=16,log="xy",col=col.spp(species),xlim=c(.015,60),ylim=c(1e-4,1000),yaxt="n",xaxt="n",xlab="embryo + endosperm size (mg)",ylab="count, scaled to plant size")
points(scaled_bud_count~embryo_endo_size,SummaryInd,pch=21,col=col.spp(species))
#points(scaled_failure_count~embryo_endo_size,SummaryInd,pch=2,col=col.spp(species))
axis(2, at=c(0.0001,0.01,1,100), labels=c(0.0001,0.01,1,100),cex.axis=1)
axis(1, at=c(0.1,1,10), labels=c("","",""),cex.axis=1)

mod1 <- sma(scaled_seed_count~embryo_endo_size,data=subset(SummaryInd,scaled_seed_count!=0),log="xy",slope=-1,method="OLS")
mod2 <- sma(scaled_bud_count~embryo_endo_size,data=subset(SummaryInd,scaled_bud_count!=0),log="xy",slope=-1,method="OLS")
mod3 <- sma(scaled_failure_count~embryo_endo_size,data=subset(SummaryInd,scaled_failure_count!=0),log="xy",slope=-1,method="OLS")

line_function_log_xy(SummarySpp[["mean"]]$embryo_endo_size,mod1,1)
line_function_log_xy(SummarySpp[["mean"]]$embryo_endo_size,mod2,2)
legend("topright",legend=c("seed count","initiated ovules count"),col=c("black","black"),pch=c(16,21),bty="n")

plot(prepollen_costs~embryo_endo_size,SummarySpp[["mean"]],col=col.spp(species),pch=16,log="xy", yaxt="n",xaxt="n", ylim=c(.02,20000), xlim=c(.015,60), ylab="pollen attraction costs (mg/seed)",xlab="",cex=1.5)
y.error.bars.2(SummarySpp[["mean"]]$embryo_endo_size,SummarySpp[["mean"]]$prepollen_costs,SummarySpp[["se"]]$prepollen_costs)
mod <- sma(prepollen_costs~embryo_endo_size,SummarySpp[["mean"]],log="xy",method="OLS")
#abline(mod$groupsummary["Int"][[1]],1,lty=2)
axis(2, at=c(0.1,10,1000), labels=c(0.1,10,1000),cex.axis=1)
axis(1, at=c(0.1,1,10), labels=c(0.1,1,10),cex.axis=1)
line_function_log_xy(SummarySpp[["mean"]]$embryo_endo_size,mod,1)
line_function_log_xy_zero(SummarySpp[["mean"]]$embryo_endo_size,mod,1)

plot(postpollen_all_per_seed~embryo_endo_size,SummarySpp[["mean"]],col=col.spp(species),pch=16,log="xy", yaxt="n",xaxt="n", ylim=c(.02,20000), xlim=c(.015,60), ylab="provisioning costs (mg/seed)",xlab="",cex=1.5)
y.error.bars.2(SummarySpp[["mean"]]$embryo_endo_size,SummarySpp[["mean"]]$postpollen_all_per_seed,SummarySpp[["se"]]$prepollen_costs)
mod <- sma(postpollen_all_per_seed~embryo_endo_size,SummarySpp[["mean"]],log="xy",method="OLS")
line_function_log_xy(SummarySpp[["mean"]]$embryo_endo_size,mod,1)
line_function_log_xy_zero(SummarySpp[["mean"]]$embryo_endo_size,mod,1)
axis(2, at=c(0.1,10,1000), labels=c(0.1,10,1000),cex.axis=1)
axis(1, at=c(0.1,1,10), labels=c(0.1,1,10),cex.axis=1)
mtext(text="     seed size (mg)",side=1,line=1.5,outer=TRUE,adj=0.5)

dev.off()
```

#Table 3. Slopes for various seed size by acc cost regressions
#NO LONGER AN EXACT PARALLEL TO To TABLE 3 embryo version - redo if using
```{r}
par(mfrow=c(2,3), cex=1, omi=c(.6,.1,.05,.05), mai=c(.1,.8,.05,.05)) 
options(scipen = 5)

plot(accessory_per_seed ~ seed_size,data=subset(SummarySpp[["mean"]]),col=col.spp(species),pch=16,log="xy", ylim=c(.02,10000), xlim=c(.02,10000), ylab="total per seed accessory costs (mg/seed)",xlab="",cex=1.5)
mod <- lm(log10(accessory_per_seed) ~ log10(seed_size),data=subset(SummarySpp[["mean"]],accessory_per_seed>0))
y.error.bars(SummarySpp[["mean"]]$seed_size,SummarySpp[["mean"]]$accessory_per_seed,SummarySpp[["se"]]$accessory_per_seed)
slopes <- sma(accessory_per_seed ~ seed_size,data=subset(SummarySpp[["mean"]]),slope.test=1,method="OLS", log="xy")
abline(slopes$groupsummary["Int"][[1]],slopes$groupsummary["Slope"][[1]])
abline(slopes$groupsummary["Int"][[1]],1,lty=2)
words.bottom.left.logxy(mod)

acc_by_species <- dplyr::select(slopes$groupsummary,r2,pval,Slope,Slope_lowCI,Slope_highCI,Int,Int_lowCI,Int_highCI,Slope_test_p)

plot(prepollen_costs ~ seed_size,data=subset(SummarySpp[["mean"]]),col=col.spp(species),pch=16,log="xy", ylim=c(.02,10000), ylab="prepollen success costs (mg/seed)",xlab="",cex=1.5)
y.error.bars(SummarySpp[["mean"]]$seed_size,SummarySpp[["mean"]]$prepollen_costs,SummarySpp[["se"]]$prepollen_costs)
mod <- lm(log10(prepollen_costs) ~ log10(seed_size),data=subset(SummarySpp[["mean"]]))
words.bottom.left.logxy(mod)
slopes <- sma(prepollen_costs ~ seed_size,data=subset(SummarySpp[["mean"]]),slope.test=1,method="OLS", log="xy")
abline(slopes$groupsummary["Int"][[1]],slopes$groupsummary["Slope"][[1]])
abline(slopes$groupsummary["Int"][[1]],1,lty=2)
acc_by_species <- dplyr::bind_rows(acc_by_species, dplyr::select(slopes$groupsummary,r2,pval,Slope,Slope_lowCI,Slope_highCI,Int,Int_lowCI,Int_highCI,Slope_test_p))

plot(pack_disp_costs ~ seed_size,data=subset(SummarySpp[["mean"]]),col=col.spp(species),pch=16,log="xy", ylim=c(.02,10000), ylab="dispersal & packaging accessory costs (mg/seed)",xlab="",cex=1.5)
mod <- lm(log10(pack_disp_costs) ~ log10(seed_size),data=subset(SummarySpp[["mean"]]))
words.top.left.logxy(mod)
slopes <- sma(pack_disp_costs ~ seed_size,data=subset(SummarySpp[["mean"]]),slope.test=1, log="xy",method="OLS")
abline(slopes$groupsummary["Int"][[1]],slopes$groupsummary["Slope"][[1]])
abline(slopes$groupsummary["Int"][[1]],1,lty=2)
y.error.bars(SummarySpp[["mean"]]$seed_size,SummarySpp[["mean"]]$pack_disp_costs,SummarySpp[["se"]]$pack_disp_costs)
acc_by_species <- dplyr::bind_rows(acc_by_species, dplyr::select(slopes$groupsummary,r2,pval,Slope,Slope_lowCI,Slope_highCI,Int,Int_lowCI,Int_highCI,Slope_test_p))
mtext(text="seed size (mg)",side=1,line=1.5,outer=TRUE)

plot(failure_per_seed ~ seed_size,data=subset(SummarySpp[["mean"]]),col=col.spp(species),pch=16,log="xy", ylim=c(.02,10000), ylab="prepollen failure costs (mg/seed)",xlab="",cex=1.5)
mod <- lm(log10(failure_per_seed) ~ log10(seed_size),data=subset(SummarySpp[["mean"]]))
words.bottom.left.logxy(mod)
slopes <- sma(failure_per_seed ~ seed_size,data=subset(SummarySpp[["mean"]]),slope.test=1,method="OLS", log="xy")
abline(slopes$groupsummary["Int"][[1]],slopes$groupsummary["Slope"][[1]])
abline(slopes$groupsummary["Int"][[1]],1,lty=2)
y.error.bars(SummarySpp[["mean"]]$seed_size,SummarySpp[["mean"]]$failure_per_seed,SummarySpp[["se"]]$failure_per_seed)
acc_by_species <- dplyr::bind_rows(acc_by_species, dplyr::select(slopes$groupsummary,r2,pval,Slope,Slope_lowCI,Slope_highCI,Int,Int_lowCI,Int_highCI,Slope_test_p))

plot(prepollen_all_per_seed ~ seed_size,data=subset(SummarySpp[["mean"]]),col=col.spp(species),pch=16,log="xy", ylim=c(.02,10000), ylab="prepollen failure costs (mg/seed)",xlab="",cex=1.5)
mod <- lm(log10(prepollen_all_per_seed) ~ log10(seed_size),data=subset(SummarySpp[["mean"]]))
words.bottom.right.logxy(mod)
slopes <- sma(prepollen_all_per_seed ~ seed_size,data=subset(SummarySpp[["mean"]]),slope.test=1,method="OLS", log="xy")
abline(slopes$groupsummary["Int"][[1]],slopes$groupsummary["Slope"][[1]])
abline(slopes$groupsummary["Int"][[1]],1,lty=2)
y.error.bars(SummarySpp[["mean"]]$seed_size,SummarySpp[["mean"]]$prepollen_all_per_seed,SummarySpp[["se"]]$prepollen_all_per_seed)
#acc_by_species <- dplyr::bind_rows(acc_by_species, dplyr::select(slopes$groupsummary,r2,pval,Slope,Slope_lowCI,Slope_highCI,Int,Int_lowCI,Int_highCI,Slope_test_p))

# plot(postpollen_aborted_per_seed ~ seed_size,data=subset(SummarySpp[["mean"]],species!="COER"),col=col.spp(species),pch=16,log="xy", ylim=c(.02,10000), ylab="aborted fruit accessory costs (mg/seed)",xlab="",cex=1.5,xaxt="n")
# mod <- lm(log10(postpollen_aborted_per_seed) ~ log10(seed_size),data=subset(SummarySpp[["mean"]],accessory_per_seed>0&species!="COER"&species!="BAER"))
# words.top.left.logxy(mod)
# y.error.bars(SummarySpp[["mean"]]$seed_size,SummarySpp[["mean"]]$postpollen_aborted_per_seed,SummarySpp[["se"]]$postpollen_aborted_per_seed)
# slopes <- sma(postpollen_aborted_per_seed ~ seed_size,data=subset(SummarySpp[["mean"]],species!="COER"&species!="BAER"),slope.test=1, log="xy",method="OLS")
# abline(slopes$groupsummary["Int"][[1]],slopes$groupsummary["Slope"][[1]])
# abline(slopes$groupsummary["Int"][[1]],1,lty=2)
# acc_by_species <- dplyr::bind_rows(acc_by_species, dplyr::select(slopes$groupsummary,r2,pval,Slope,Slope_lowCI,Slope_highCI,Int,Int_lowCI,Int_highCI,Slope_test_p))


#slopes <- sma(postpollen_all_per_seed ~ seed_size,data=subset(SummarySpp[["mean"]]),slope.test=1, log="xy",method="OLS")
#acc_by_species <- dplyr::bind_rows(acc_by_species, dplyr::select(slopes$groupsummary,r2,pval,Slope,Slope_lowCI,Slope_highCI,Int,Int_lowCI,Int_highCI,Slope_test_p))

acc_by_species$variable = c("total accessory costs","pre-pollination costs","provisioning costs", "failed_tissues")

write.csv(acc_by_species, file="figs2/Accessory_Costs/Table03_acc_cost_seed_size_slopes.csv",row.names=FALSE)
```

#Table 3 v2. Slopes for various embryo size by acc cost regressions
```{r}
par(mfrow=c(2,3), cex=1, omi=c(.6,.1,.05,.05), mai=c(.1,.8,.05,.05)) 
options(scipen = 5)

plot(accessory_per_seed ~ embryo_endo_size,data=subset(SummarySpp[["mean"]]),col=col.spp(species),pch=16,log="xy", ylim=c(.02,10000), xlim=c(.02,10000), ylab="total per seed accessory costs (mg/seed)",xlab="",cex=1.5)
y.error.bars(SummarySpp[["mean"]]$embryo_endo_size,SummarySpp[["mean"]]$accessory_per_seed,SummarySpp[["se"]]$accessory_per_seed)
slopes <- sma(accessory_per_seed ~ embryo_endo_size,data=subset(SummarySpp[["mean"]]),slope.test=1,method="OLS", log="xy")
abline(slopes$groupsummary["Int"][[1]],slopes$groupsummary["Slope"][[1]])
abline(slopes$groupsummary["Int"][[1]],1,lty=2)
words.bottom.left.logxy(mod)

acc_by_species <- dplyr::select(slopes$groupsummary,r2,pval,Slope,Slope_lowCI,Slope_highCI,Int,Int_lowCI,Int_highCI,Slope_test_p)

plot(prepollen_costs ~ embryo_endo_size,data=subset(SummarySpp[["mean"]]),col=col.spp(species),pch=16,log="xy", ylim=c(.02,10000), ylab="prepollen success costs (mg/seed)",xlab="",cex=1.5)
y.error.bars(SummarySpp[["mean"]]$embryo_endo_size,SummarySpp[["mean"]]$prepollen_costs,SummarySpp[["se"]]$prepollen_costs)
slopes <- sma(prepollen_costs ~ embryo_endo_size,data=subset(SummarySpp[["mean"]]),slope.test=1,method="OLS", log="xy")
abline(slopes$groupsummary["Int"][[1]],slopes$groupsummary["Slope"][[1]])
abline(slopes$groupsummary["Int"][[1]],1,lty=2)
acc_by_species <- dplyr::bind_rows(acc_by_species, dplyr::select(slopes$groupsummary,r2,pval,Slope,Slope_lowCI,Slope_highCI,Int,Int_lowCI,Int_highCI,Slope_test_p))

plot(pack_disp_costs ~ embryo_endo_size,data=subset(SummarySpp[["mean"]]),col=col.spp(species),pch=16,log="xy", ylim=c(.02,10000), ylab="dispersal & packaging accessory costs (mg/seed)",xlab="",cex=1.5)
slopes <- sma(pack_disp_costs ~ embryo_endo_size,data=subset(SummarySpp[["mean"]]),slope.test=1, log="xy",method="OLS")
abline(slopes$groupsummary["Int"][[1]],slopes$groupsummary["Slope"][[1]])
abline(slopes$groupsummary["Int"][[1]],1,lty=2)
y.error.bars(SummarySpp[["mean"]]$embryo_endo_size,SummarySpp[["mean"]]$pack_disp_costs,SummarySpp[["se"]]$pack_disp_costs)
acc_by_species <- dplyr::bind_rows(acc_by_species, dplyr::select(slopes$groupsummary,r2,pval,Slope,Slope_lowCI,Slope_highCI,Int,Int_lowCI,Int_highCI,Slope_test_p))
mtext(text="seed size (mg)",side=1,line=1.5,outer=TRUE)

plot(failure_per_seed ~ embryo_endo_size,data=subset(SummarySpp[["mean"]]),col=col.spp(species),pch=16,log="xy", ylim=c(.02,10000), ylab="all failure costs (mg/seed)",xlab="",cex=1.5)
slopes <- sma(failure_per_seed ~ embryo_endo_size,data=subset(SummarySpp[["mean"]]),slope.test=1,method="OLS", log="xy")
abline(slopes$groupsummary["Int"][[1]],slopes$groupsummary["Slope"][[1]])
abline(slopes$groupsummary["Int"][[1]],1,lty=2)
y.error.bars(SummarySpp[["mean"]]$embryo_endo_size,SummarySpp[["mean"]]$failure_per_seed,SummarySpp[["se"]]$failure_per_seed)
acc_by_species <- dplyr::bind_rows(acc_by_species, dplyr::select(slopes$groupsummary,r2,pval,Slope,Slope_lowCI,Slope_highCI,Int,Int_lowCI,Int_highCI,Slope_test_p))

plot(prepollen_failure_per_seed ~ embryo_endo_size,data=subset(SummarySpp[["mean"]]),col=col.spp(species),pch=16,log="xy", ylim=c(.02,10000), ylab="aborted pre-pollination costs (mg/seed)",xlab="",cex=1.5,xaxt="n")
y.error.bars(SummarySpp[["mean"]]$embryo_endo_size,SummarySpp[["mean"]]$prepollen_failure_per_seed,SummarySpp[["se"]]$prepollen_failure_per_seed)
slopes <- sma(prepollen_failure_per_seed ~ embryo_endo_size,data=subset(SummarySpp[["mean"]]),slope.test=1, log="xy",method="OLS")
abline(slopes$groupsummary["Int"][[1]],slopes$groupsummary["Slope"][[1]])
abline(slopes$groupsummary["Int"][[1]],1,lty=2)
acc_by_species <- dplyr::bind_rows(acc_by_species, dplyr::select(slopes$groupsummary,r2,pval,Slope,Slope_lowCI,Slope_highCI,Int,Int_lowCI,Int_highCI,Slope_test_p))

plot(postpollen_aborted_per_seed ~ embryo_endo_size,data=subset(SummarySpp[["mean"]]),col=col.spp(species),pch=16,log="xy", ylim=c(.02,10000), ylab="aborted during provisioning costs (mg/seed)",xlab="",cex=1.5,xaxt="n")
y.error.bars(SummarySpp[["mean"]]$embryo_endo_size,SummarySpp[["mean"]]$postpollen_aborted_per_seed,SummarySpp[["se"]]$postpollen_aborted_per_seed)
slopes <- sma(postpollen_aborted_per_seed ~ embryo_endo_size,data=subset(SummarySpp[["mean"]]),slope.test=1, log="xy",method="OLS")
abline(slopes$groupsummary["Int"][[1]],slopes$groupsummary["Slope"][[1]])
abline(slopes$groupsummary["Int"][[1]],1,lty=2)
acc_by_species <- dplyr::bind_rows(acc_by_species, dplyr::select(slopes$groupsummary,r2,pval,Slope,Slope_lowCI,Slope_highCI,Int,Int_lowCI,Int_highCI,Slope_test_p))

acc_by_species$variable = c("total accessory costs","pre-pollination costs","provisioning costs", "failed tissues costs","failed pre-pollination costs","failed provisioning costs")

acc_by_species$slope2 <- paste(format(acc_by_species$Slope,digits=3)," (",format(acc_by_species$Slope_lowCI,digits=3)," - ",format(acc_by_species$Slope_highCI,digits=3),")",sep="")

acc_by_species$r2 <- format(acc_by_species$r2,digits=2)
acc_by_species$pval <- format(acc_by_species$pval,digits=2)
acc_by_species$Slope_test_p <- format(acc_by_species$Slope_test_p,digits=3)
acc_slopes <- dplyr::select(acc_by_species,variable,r2,pval,slope2,Slope_test_p,Slope,Slope_lowCI)

write.csv(acc_slopes, file="figs2/Accessory_Costs/Table03_acc_cost_embryo_size_slopes.csv",row.names=FALSE)
```

#Figure 5 seed count, scaled to plant size, decreases 1:1 with seed size, while bud count decreases less steeply; indication that seed count is what is actually "programmed in"
```{r}
win.metafile("figs2/Accessory_Costs/Figure05_cost_of_flowers_vs_embryo_endo_size.wmf", height=5, width=15)
plot

par(mfrow=c(1,3), cex=1, omi=c(.1,.1,.1,.05), mai=c(1,1,.1,.05))
options(scipen = 4)

plot(seedset~seed_size,SummarySpp[["mean"]],log="xy",col=col.spp(species),pch=16, xlim=c(.01,1000),ylim=c(.01,.3),cex=1.5,xaxt="n",xlab="seed size (mg)",ylab="seed set")
mod <- sma(seedset~seed_size,SummarySpp[["mean"]],log="xy", method="OLS")
sma_abline(mod)
y.error.bars(SummarySpp[["mean"]]$seed_size,SummarySpp[["mean"]]$seedset,SummarySpp[["se"]]$seedset)
axis(1, at=c(0.01,1,100), labels=c(0.01,1,100),cex.axis=0.9)
legend("bottomleft",legend=labels.spp.genus(),col=col.spp(),pch=16, cex=.9,bty="n",text.font=3)

#species that abort a disprortionate # of buds can do so because the relative cost of buds (relative to seeds, dispersal) is small
plot(prop_prepollen_costs~seedset,SummarySpp[["mean"]],pch=16,log="x",col=col.spp(species),ylim=c(-.2,1),xlim=c(.01,.3),cex=1.5,yaxt="n",ylab="pre-pollination costs (proportion of total seed costs)",xlab="seed set")
mod <- sma(prop_prepollen_costs~seedset,data=subset(SummarySpp[["mean"]]),log="x",slope=1,method="OLS")
y.error.bars(SummarySpp[["mean"]]$seedset,SummarySpp[["mean"]]$prop_prepollen_costs,SummarySpp[["se"]]$prop_prepollen_costs)
sma_abline(mod)
sma_sum(mod)
text(10^((0.99*(par("usr")[2]-par("usr")[1]))+par("usr")[1]),((0.98*(par("usr")[4]-par("usr")[3]))+par("usr")[3]),
     paste("r2 = ",round(sma_sum(mod)[1],2)),adj=1)
axis(2, at=c(-0.2,0,.2,.4,.6,.8,1), labels=c("",0.0,0.2,0.4,0.6,0.8,""),cex.axis=1)

#put together, big-seeded plants produce lots more buds than predicted from 1:1 relationship, but the "correct" number of seeds
plot(scaled_seed_count~seed_size,SummaryInd,pch=16,log="xy",col=col.spp(species),xlim=c(.01,1000),ylim=c(1e-6,10),yaxt="n",xaxt="n",xlab="seed size (mg)",ylab="count, scaled to plant size")
points(scaled_bud_count~seed_size,SummaryInd,pch=21,col=col.spp(species))
#points(scaled_failure_count~seed_size,SummaryInd,pch=2,col=col.spp(species))
axis(2, at=c(0.000001,0.0001,0.01,1), labels=c(0.000001,0.0001,0.01,1),cex.axis=0.9)
axis(1, at=c(0.01,1,100), labels=c(0.01,1,100),cex.axis=0.9)

mod1 <- sma(scaled_seed_count~seed_size,data=subset(SummaryInd,scaled_seed_count!=0),log="xy",slope=-1,method="OLS")
mod2 <- sma(scaled_bud_count~seed_size,data=subset(SummaryInd,scaled_bud_count!=0),log="xy",slope=-1,method="OLS")
mod3 <- sma(scaled_failure_count~seed_size,data=subset(SummaryInd,scaled_failure_count!=0),log="xy",slope=-1,method="OLS")
sma_abline(mod1)
abline(mod2$groupsummary["Int"][[1]],mod2$groupsummary["Slope"][[1]],col="blue")
abline(mod3$groupsummary["Int"][[1]],mod3$groupsummary["Slope"][[1]],col="red")
legend("topright",legend=c("seed count","total bud count","failed flower count"),col=c("black","blue","red"),pch=c(16,21,8),bty="n")

dev.off()
```

#Figure 5, using embryo + endosperm
```{r}

win.metafile("figs2/Accessory_Costs/Figure05_cost_of_flowers_vs_embryo_endo_size.wmf", height=5, width=15)
plot

par(mfrow=c(1,3), cex=1, omi=c(.1,.1,.1,.05), mai=c(1,1,.1,.05))
options(scipen = 4)

plot(seedset~embryo_endo_size,SummarySpp[["mean"]],log="xy",col=col.spp(species),pch=16, xlim=c(.01,100),ylim=c(.004,.3),cex=1.5,xaxt="n",yaxt="n",xlab="embryo + endosperm size (mg)",ylab="seed set")
mod <- sma(seedset~embryo_endo_size,SummarySpp[["mean"]],log="xy", method="OLS")
sma_abline(mod)
y.error.bars(SummarySpp[["mean"]]$embryo_endo_size,SummarySpp[["mean"]]$seedset,SummarySpp[["se"]]$seedset)
text((10^(0.99*(par("usr")[2]-par("usr")[1])+par("usr")[1])),(10^(0.98*(par("usr")[4]-par("usr")[3])+par("usr")[3])),paste("r2 = ",round(sma_sum(mod)[1],2)),adj=1)
axis(1, at=c(0.01,1,100), labels=c(0.01,1,100),cex.axis=0.9)
axis(2, at=c(0.005,0.01,0.02,0.05,.1,.2), labels=c(.005,.01,.02,.05,.1,.2),cex.axis=0.9)
legend("bottomleft",legend=labels.spp.genus(),col=col.spp(),pch=16, cex=0.9,bty="n",text.font=3)
mod

#put together, big-seeded plants produce lots more buds than predicted from 1:1 relationship, but the "correct" number of seeds
plot((scaled_seed_count)~(embryo_endo_size),SummaryInd,pch=16,log="xy",col=col.spp(species),xlim=c(.01,100),ylim=c(1e-4,1000),yaxt="n",xaxt="n",xlab="embryo + endosperm size (mg)",ylab="count, scaled to plant size")
points(scaled_bud_count~embryo_endo_size,SummaryInd,pch=21,col=col.spp(species))
#points(scaled_failure_count~embryo_endo_size,SummaryInd,pch=2,col=col.spp(species))
axis(2, at=c(0.0001,0.01,1,100), labels=c(0.0001,0.01,1,100),cex.axis=0.9)
axis(1, at=c(0.01,1,100), labels=c(0.01,1,100),cex.axis=0.9)

mod1 <- sma(scaled_seed_count~embryo_endo_size,data=subset(SummaryInd,scaled_seed_count!=0),log="xy",slope=-1,method="OLS")
mod2 <- sma(scaled_bud_count~embryo_endo_size,data=subset(SummaryInd,scaled_bud_count!=0),log="xy",slope=-1,method="OLS")
mod3 <- sma(scaled_failure_count~embryo_endo_size,data=subset(SummaryInd,scaled_failure_count!=0),log="xy",slope=-1,method="OLS")
abline(mod1$groupsummary["Int"][[1]],mod1$groupsummary["Slope"][[1]],col="black",lwd=2)
abline(mod2$groupsummary["Int"][[1]],mod2$groupsummary["Slope"][[1]],col="blue",lwd=2)
abline(mod3$groupsummary["Int"][[1]],mod3$groupsummary["Slope"][[1]],col="red",lwd=2)

legend("topright",legend=c("seed count","bud count","failed flower count"),col=c("black","blue","red"),pch=c(16,1,NA),bty="n",lty=c(1,1,1))


#species that abort a disprortionate # of buds can do so because the relative cost of buds (relative to seeds, dispersal) is small
plot(jitter(prop_prepollen_costs)~jitter(seedset),SummarySpp[["mean"]],pch=16,log="x",col=col.spp(species),ylim=c(-.2,1),xlim=c(.004,.3),cex=1.5,yaxt="n",ylab="pre-pollination costs (proportion of total seed costs)",xlab="seed set")
mod <- sma(prop_prepollen_costs~seedset,data=subset(SummarySpp[["mean"]]),log="x",slope=1,method="OLS")
y.error.bars(SummarySpp[["mean"]]$seedset,SummarySpp[["mean"]]$prop_prepollen_costs,SummarySpp[["se"]]$prop_prepollen_costs)
sma_abline(mod)
sma_sum(mod)
text((10^(0.99*(par("usr")[2]-par("usr")[1])+par("usr")[1])),((0.98*(par("usr")[4]-par("usr")[3]))+par("usr")[3]),
 paste("r2 = ",round(sma_sum(mod)[1],2)),adj=1)
axis(2, at=c(-0.2,0,.2,.4,.6,.8,1), labels=c("",0.0,0.2,0.4,0.6,0.8,""),cex.axis=1)

Fig5_data <- dplyr::select(mod1$groupsummary,r2,pval,Slope,Slope_lowCI,Slope_highCI,Int,Int_lowCI,Int_highCI,Slope_test_p)
Fig5_data <- dplyr::bind_rows(Fig5_data,dplyr::select(mod2$groupsummary,r2,pval,Slope,Slope_lowCI,Slope_highCI,Int,Int_lowCI,Int_highCI,Slope_test_p))
Fig5_data <- dplyr::bind_rows(Fig5_data,dplyr::select(mod3$groupsummary,r2,pval,Slope,Slope_lowCI,Slope_highCI,Int,Int_lowCI,Int_highCI,Slope_test_p))
Fig5_data$variable <- c("seed count","bud count","failure count")
write.csv(Fig5_data, file="figs2/Accessory_Costs/Figure05_data_slopes.csv",row.names=FALSE)

dev.off()
```

#Table 4.correlations between seedset and accessory costs by species
```{r}
yvar <- "accessory_per_seed"
xvar <- "seedset"
data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], method="OLS", log="xy",slope=-1)
results <- fit$groupsummary

plot(fit,col=col.spp(fit$groupsummary$group),pch=16,xlab="seedset (seeds:ovule)",ylab="total accessory costs (mg/seed)",lty=results$linetype,xlim=c(.0005,.5),ylim=c(.01,200000))

results$slope2 <- paste(format(results$Slope,digits=3)," (",format(results$Slope_lowCI,digits=3)," - ",format(results$Slope_highCI,digits=3),")",sep="")

results$r2 <- format(results$r2,digits=2)
results$pval <- format(results$pval,digits=2)
results$Slope_test_p <- format(results$Slope_test_p,digits=3)
results$full_name <- labels.spp.full(results$group)
results$seed_size <- SummarySpp[["mean"]]$embryo_endo_size
results <- dplyr::select(results,group,full_name,n, r2,pval,slope2,Slope_test_p,Slope,seed_size)
write.csv(results, file="figs2/Accessory_Costs/Table04_eacc_cost_vs_seedset_by_spp.csv",row.names=FALSE)
```

#Table 5. Higher RE, RA, plant size do not lead to lower accessory costs; age shows mixed results
```{r}
win.metafile("figs2/Accessory_Costs/FigureXX_RE_RA_size_age_patterns.wmf", height=10, width=10)
plot

par(mfrow=c(2,2), cex=1, omi=c(.1,.4,.1,.05), mai=c(.6,.3,.1,.1))
options(scipen = 2)

xvar <- "repro_inv"
yvar <- "accessory_per_seed"
data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], method="OLS", log="xy")
results <- lines(fit$groupsummary)
plot(fit,col=col.spp(fit$groupsummary$group),pch=16,xlab="",ylab=yvar,lty=results$linetype)
mtext(text="reproductive investment (mg) (RE)",side=1,line=2,outer=FALSE)
legend_with_r2(results,"bottomright")

write.csv(results, file="figs2/Accessory_Costs/Table05a_accessory_vs_RE.csv",row.names=FALSE)
 
xvar <- "total_weight_0"
yvar <- "accessory_per_seed"
data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], method="OLS", log="xy")
results <- lines(fit$groupsummary)
plot(fit,col=col.spp(fit$groupsummary$group),pch=16,xlab="",ylab=yvar,lty=results$linetype)
mtext(text="total plant size (mg)",side=1,line=2,outer=FALSE)
legend_with_r2(results,"bottomright")

write.csv(results, file="figs2/Accessory_Costs/Table05b_accessory_vs_total_weight.csv",row.names=FALSE)

xvar <- "age"
yvar <- "accessory_per_seed"
data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], method="OLS", log="xy")
results <- lines(fit$groupsummary)
plot(fit,col=col.spp(fit$groupsummary$group),pch=16,xlab="",ylab="",lty=results$linetype)
mtext(text="age (years)",side=1,line=2,outer=FALSE)
mtext(text="per seed accessory costs (mg/seed)",side=2,line=1,outer=TRUE)
legend_with_r2(results,"topleft")

write.csv(results, file="figs2/Accessory_Costs/Table05c_accessory_vs_age.csv",row.names=FALSE)
dev.off()
```

#Table 6.correlations between repro inv and propagule inv by species
```{r}
yvar <- "repro_inv"
xvar <- "propagule_inv"
data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], method="OLS", log="xy")
results <- fit$groupsummary
results$r2 <- format(results$r2,digits=2)
results$pval <- format(results$pval,digits=3)
acc_slopes <- dplyr::select(results,group,n,r2,pval)

write.csv(results, file="figs2/Accessory_Costs/Table06_propagule_invest_vs_repro_inv.csv",row.names=FALSE)
```

#Table 6.correlations between repro inv and flower inv by species (noted in Discussiong)
```{r}
yvar <- "repro_inv"
xvar <- "flower_inv"
data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], method="OLS", log="xy")
results <- fit$groupsummary
results$r2 <- format(results$r2,digits=2)
results$pval <- format(results$pval,digits=3)
acc_slopes <- dplyr::select(results,group,n,r2,pval)

write.csv(results, file="figs2/Accessory_Costs/Table06extra_flower_invest_vs_repro_inv.csv",row.names=FALSE)
```

#Table 7 extra. correlations with total repro inv
```{r}
results <- as.data.frame(matrix(vector(), 0, 9,
                dimnames=list(c(), c("xvar","variable","r2","pval","Slope","Slope_lowCI","Slope_highCI","Int","Slope_test_p"))),
                stringsAsFactors=F)

for (i in c("total_weight","repro_inv","failure_inv","success_inv","propagule_inv","packaging_dispersal_inv","prepollen_success_inv","fruit_inv","flower_inv")) {
  for (j in c("total_weight","leaf_area_0","diameter_0","repro_inv","propagule_inv")) {
yvar <- i
xvar <- j
data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)
fit <- sma(data[[yvar]] ~ data[[xvar]], method="OLS", log="xy",slope.test=1)
temp <- as.data.frame(c(xvar, yvar,dplyr::select(fit$groupsummary,r2,pval,Slope,Slope_lowCI,Slope_highCI,Int,Slope_test_p,n)))
colnames(temp)[2]<- "variable"
colnames(temp)[1]<- "xvar"
results <- bind_rows(results, temp)
  }
}

write.csv(results, file="figs2/Accessory_Costs/Table07_EXTRA_correlations_with_repro_inv.csv",row.names=FALSE)
```

#Table 7. correlations with total repro inv
```{r}
results <- as.data.frame(matrix(vector(), 0, 9,
                dimnames=list(c(), c("xvar","variable","r2","pval","Slope","Slope_lowCI","Slope_highCI","Int","Slope_test_p"))),
                stringsAsFactors=F)

for (i in c("total_weight","failure_inv","success_inv","propagule_inv","packaging_dispersal_inv","prepollen_success_inv","fruit_inv","flower_inv")) {
  for (j in c("repro_inv")) {
yvar <- i
xvar <- j
data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)
fit <- sma(data[[yvar]] ~ data[[xvar]], method="OLS", log="xy",slope.test=1)
temp <- as.data.frame(c(xvar, yvar,dplyr::select(fit$groupsummary,r2,pval,Slope,Slope_lowCI,Slope_highCI,Int,Slope_test_p,n)))
colnames(temp)[2]<- "variable"
colnames(temp)[1]<- "xvar"
results <- bind_rows(results, temp)
  }
}

results$slope2 <- paste(format(results$Slope,digits=3)," (",format(results$Slope_lowCI,digits=3)," - ",format(results$Slope_highCI,digits=3),")",sep="")

results$r2 <- format(results$r2,digits=3)
results$pval <- format(results$pval,digits=3)
results$Slope_test_p <- format(results$Slope_test_p,digits=3)
results  <- dplyr::select(results,variable,n,r2,pval,slope2,Slope_test_p)

write.csv(results, file="figs2/Accessory_Costs/Table07_correlations_with_repro_inv.csv",row.names=FALSE)
```


#Figure 6. Correlations of various reproductive investment categories against plant weight
```{r}
library(smatr)
win.metafile("figs2/Accessory_Costs/Figure06_correlations_with_plant_weight.wmf", height=5, width=10)
plot

par(mfrow=c(1,2), cex=1, omi=c(.1,.6,.1,.05), mai=c(.8,.1,.1,.05))
options(scipen = 4)

xvar <- "total_weight_0"
yvar <- "repro_inv"
data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], method="OLS", log="xy")
results <- lines(fit$groupsummary)
#plot(fit,col=col.spp(fit$groupsummary$group),log="xy",ylim=c(1,300000),xlim=c(1,10000000),xlab="",ylab="",lty=results$linetype,pch=16)
mod <- sma(total_weight_0~repro_inv,data=subset(SummaryInd,repro_inv>0),log="xy",method="OLS")
#abline(0,1)
#words.top.left.logxy(mod)
#mtext(text="total reproductive investment (mg)",side=2,line=2,outer=TRUE)
#mtext(text="total plant weight (mg)",side=1,line=2,outer=FALSE)

yvar <- "repro_inv"
xvar <- "propagule_inv"
data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], method="OLS", log="xy")
results <- lines(fit$groupsummary)
plot(fit,col=col.spp(fit$groupsummary$group),log="xy",ylim=c(1,300000),xlim=c(1,300000), xlab="",ylab="",lty=results$linetype,pch=16)
abline(0,1)
mod <- sma(propagule_inv~repro_inv,data=subset(SummaryInd,propagule_inv>0),log="xy",method="OLS")
mtext(text="investment in propagules (mg)",side=1,line=2,outer=FALSE)
mtext(text="total reproductive investment (mg)",side=2,line=2,outer=TRUE)
#legend("bottomright",legend=labels.spp.genus(),col=col.spp(),pch=16, cex=0.9,bty="n",text.font=3)

xvar <- "repro_all_count"
yvar <- "repro_inv"
data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], method="OLS", log="xy",slope.test=1)
results <- lines(fit$groupsummary)
#plot(fit,xlab="",ylab="",pch=16, col=col.spp(fit$groupsummary$group),lty=results$linetype,ylim=c(1,300000),xlim=c(1,30000))
#mtext(text="buds initiated",side=1,line=2,outer=FALSE)

xvar <- "flower_inv"
yvar <- "repro_inv"
data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], method="OLS", log="xy",slope.test=1)
results <- lines(fit$groupsummary)
plot(fit,xlab="",ylab="",pch=16, col=col.spp(fit$groupsummary$group),lty=results$linetype,ylim=c(1,300000),xlim=c(1,300000),yaxt="n")
axis(2, at=c(1,100,10000),labels=c("","",""))
abline(0,1)
mtext(text="flower weight * bud count (mg)",side=1,line=2,outer=FALSE)

dev.off()

xvar <- "diameter_0"
yvar <- "repro_all_count"
data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], method="OLS", log="xy",slope.test=1)
results <- lines(fit$groupsummary)
plot(fit,xlab="",ylab="",pch=16, col=col.spp(fit$groupsummary$group),lty=results$linetype,yaxt="n")
points((repro_inv)~(diameter_0),SummarySpp[["mean"]],cex=2,col=col.spp(species),pch=16)

abline(0,1)
#mtext(text="total plant weight (mg)",side=1,line=2,outer=FALSE)

xvar <- "diameter_0"
yvar <- "propagule_inv"
data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], method="OLS", log="xy",slope.test=1)
results <- lines(fit$groupsummary)
plot(fit,xlab="",ylab="",pch=16, col=col.spp(fit$groupsummary$group),lty=results$linetype,yaxt="n")
points((propagule_inv)~(diameter_0),SummarySpp[["mean"]],cex=2,col=col.spp(species),pch=16)

abline(0,1)
mtext(text="total plant weight (mg)",side=1,line=2,outer=FALSE)
```

###GOOD VISUALS - not currently in manuscript
```{r}
xvar <- "leaf_area_0"
yvar <- "flower_inv"
data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], method="OLS", log="xy")
results <- lines(fit$groupsummary)
plot(fit,col=col.spp(fit$groupsummary$group),log="xy",ylim=c(1,300000),xlim=c(1,10000000),xlab="",ylab="",lty=results$linetype,pch=16)
results

plot(seed_size~total_weight_0,SummaryInd,log="xy",pch=16,col=col.spp(species))
plot(seed_size~total_weight_0,SummarySpp[["mean"]],log="xy",pch=16,col=col.spp(species))

plot(seedset~prop_failure,data=subset(SummarySpp[["mean"]],species!="BAER"&species!="PEPU"),log="xy",pch=16,col=col.spp(species))
mod <- sma(seed_size~total_weight_0,data=subset(SummarySpp[["mean"]]),log="xy",method="OLS")
summary(mod)
```


```{r}
Cairo("figs2/Accessory_Costs/FigureXX_seedcount_reprocount.svg", height=5, width=5,type="svg",pointsize=10,units="in")
#win.metafile("figs2/Accessory_Costs/FigureXX_seedcount_reprocount.wmf", height=5, width=5)

plot

par(mfrow=c(1,1), cex=1, omi=c(.1,.1,.1,0.05), mai=c(.8,.8,.1,0.1))
options(scipen = 2)

xvar <- "repro_all_count"
yvar <- "seed_count"
data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], method="OLS", log="xy",slope=1)
results <- lines(fit$groupsummary)
plot(fit,col=col.spp(fit$groupsummary$group),pch=16,xlab="buds initiated (count)",ylab="seed count",lty=results$linetype,xlim=c(0.9,20000),ylim=c(0.9,20000))

dplyr::select(results,group,n,r2,pval,Slope,Slope_test_p)
abline(0,1,lwd=2)
abline(-2,1,lwd=2)

legend_with_r2(results,"topleft")

dev.off()
```

#Although very little energy goes into propagules (or embryos) a notable amount of energy is required for successful seeds to form
```{r}
win.metafile("figs2/Accessory_Costs/FigureXX_success_vs_failure.wmf", height=6, width=8)
plot

par(mfrow=c(1,2), cex=1, omi=c(.8,.1,.1,.1), mai=c(.1,.8,.1,.1)) 

xvar <- "repro_inv"
yvar <- "prop_propagule"

data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], method="OLS", log="xy")
results <- lines(fit$groupsummary)
plot(fit,col=col.spp(fit$groupsummary$group),pch=16,lty=results$linetype,ylim=c(.001,1),xlab="",ylab="prop repro energy to propagules")
abline(-0.30103,0,lwd=2)
abline(-1,0,lwd=2)

xvar <- "repro_inv"
yvar <- "prop_success"

data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], method="OLS", log="xy")
results <- lines(fit$groupsummary)
plot(fit,col=col.spp(fit$groupsummary$group),pch=16,lty=results$linetype,ylim=c(.001,1),xlab="",ylab="prop repro energy to success")
abline(-0.30103,0,lwd=2)
abline(-1,0,lwd=2)
mtext(text="reproductive investment (mg)",side=1,line=2,outer=TRUE)

dev.off()
```

#Neither within nor across species, does the proportion of reproductive energy spent on "success" correlate with total reproductive investment
```{r}
par(mfrow=c(1,1), cex=1, omi=c(.1,.1,.1,.05), mai=c(1.2,1.2,.1,.05))

xvar <- "repro_inv"
yvar <- "prop_success"
data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], log="x",method="OLS")
results <- lines(fit$groupsummary)
plot(fit,col=col.spp(fit$groupsummary$group),xlab=xvar,ylab=yvar,lty=results$linetype,pch=16,log="x")
```

#when reproductive investment is scaled by plant size there is no significant difference by seed size - so increase in repro inv with seed size simply because species with bigger seeds are bigger plants  
```{r}
plot(scaled_repro_inv~seed_size,SummaryInd, col=col.spp(species),pch=16,log="xy")
points(scaled_repro_inv~seed_size,SummarySpp[["mean"]], cex=2, col=col.spp(species),pch=16)
mod <-sma(scaled_repro_inv~seed_size,SummarySpp[["mean"]],log="xy",method="OLS")
summary(mod)
```

#This effect is true across species, since larger-seeded species produce fewer seeds and have higher per seed accessory costs and true within species, since absolute accessory investment is a function of plant size not seedset
```{r}
win.metafile("figs2/Accessory_Costs/FigureXX_EXTRA_acc_cost_by_seed_count.wmf", height=5, width=5)
plot

par(mfrow=c(1,1), cex=1, omi=c(.1,.1,.1,.1), mai=c(1,1,.5,.5)) 

xvar <- "seed_count"
yvar <- "accessory_per_seed"
data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], method="OLS", log="xy")
results <- lines(fit$groupsummary)
plot(fit,col=col.spp(fit$groupsummary$group),pch=16,xlab=xvar,ylab=yvar,lty=results$linetype)

points(accessory_per_seed~seed_count,data=subset(SummarySpp[["mean"]],accessory_per_seed>0&seed_count>0),col="black",pch=16,cex=2.5)
points(accessory_per_seed~seed_count,data=subset(SummarySpp[["mean"]],accessory_per_seed>0&seed_count>0),col=col.spp(species),pch=16,cex=2)
mod <- sma(accessory_per_seed~seed_count,data=subset(SummarySpp[["mean"]]),method="OLS", log="xy")
#words.top.right.logxy(mod)
legend_with_r2(results,"bottomleft")

write.csv(results, file="figs2/Accessory_Costs/TableXX_seedcount_vs_accessory.csv",row.names=FALSE)

dev.off()
```