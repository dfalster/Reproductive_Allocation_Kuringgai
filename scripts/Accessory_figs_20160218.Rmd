plot(pack_disp_gross_costs ~pack_disp_early_costs, SummaryInd,log="xy",col=col.spp(species),pch=16)


#ideas in progress
``` {r}
plot(prop_prepollen_all~seed_size,SummarySpp[["mean"]],pch=16,log="x",col=col.spp(species))
mod <- sma(propagule_inv~seed_size,data=subset(SummarySpp[["mean"]],species!="EPMI"), log="xy",slope=1, method="OLS")
summary(mod)

par(mfrow=c(1,2), cex=1, omi=c(.6,.1,.05,.05), mai=c(.1,.8,.05,.05)) 
options(scipen = 5)
plot(repro_all_count~total_weight,SummaryInd,pch=16,log="xy",col=col.spp(species))
mod <- sma(repro_all_count~total_weight,data=subset(SummaryInd,species!="EPMI"), log="xy",slope=1, method="OLS")
summary(mod)

plot(prop_prepollen_success~age,SummaryInd,pch=16,log="xy",col=col.spp(species))

yvar <- "accessory_per_seed"
xvar <- "age"
data <- subset(SummaryInd,SummaryInd[[xvar]]>2&SummaryInd[[yvar]]>0&SummaryInd[[yvar]]<40000)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], method="OLS", log="xy",slope=1)
results <- lines(fit$groupsummary)
results
plot(fit,col=col.spp(fit$groupsummary$group),log="xy",lty=results$linetype,pch=16,xlab=xvar,ylab=yvar)

mod <- lm(log10(total_weight_0)~log10(repro_inv),data=subset(SummaryInd,repro_inv>0))
abline(0,1)

SummaryInd$flower_seed_inv <- SummaryInd$propagule_inv + SummaryInd$flower_inv
SummaryInd$prop_post <- SummaryInd$prop_packaging_dispersal + SummaryInd$prop_propagule
plot(flower_seed_inv~repro_inv,SummaryInd,pch=16,log="xy",col=col.spp(species))
mod <- lm(log(flower_inv)~log(repro_inv),subset(SummaryInd,flower_seed_inv>0))
summary(mod)

plot(propagule_inv~leaf_area_0,SummaryInd,pch=16,log="xy",col=col.spp(species))

plot(prop_failure~seedset,data=subset(SummarySpp[["mean"]],species!="BAER"&species!="PEPU"),pch=16,log="",col=col.spp(species))
mod <- lm(prop_failure~seedset,data=subset(SummarySpp[["mean"]],species!="BAER"&species!="PEPU"))
summary(mod)
```

#Discussion or Appendix: proportion energy to prepollen tissues decreases with plant age
```{r}
yvar <- "accessory_per_seed"
xvar <- "age"
data <- subset(SummaryInd,SummaryInd[[xvar]]>2&SummaryInd[[yvar]]>0&SummaryInd[[yvar]]<1)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], method="OLS", log="x",slope=1)
results <- lines(fit$groupsummary)
results
plot(fit,col=col.spp(fit$groupsummary$group),log="x",lty=results$linetype,pch=16,xlab=xvar,ylab=yvar)
````

#Data 0. means, counts to include in manuscript
```{r}
count(SummaryInd)
count(subset(SummaryInd,seed_count>0))
count(subset(SummaryInd,repro_inv>0))
mean(subset(SummaryInd$prop_failure,SummaryInd$prop_failure>0))
mean(subset(SummaryInd$prop_accessory,SummaryInd$seed_count>0))

mod <- sma(repro_all_count~total_weight,SummaryInd,method="OLS",log="xy",slope=1)
summary(mod)

mod <- lm(log10(seed_costs) ~prop_seed_costs,SummarySpp[["mean"]])
summary(mod)

mod <- lm(log10(seed_costs) ~prop_prepollen_costs,SummarySpp[["mean"]])
summary(mod)

mod <- lm(log10(seed_costs) ~prop_dispersalcosts,SummarySpp[["mean"]])
summary(mod)

#seed size by propagule investment - all species
mod <- sma(propagule_inv ~ seed_size, SummarySpp[["mean"]],method="OLS", log="xy",slope.test=1)
summary(mod)
plot(propagule_inv ~ seed_size, SummarySpp[["mean"]],log="xy",pch=16,col=col.spp(species))

#seed size by propagule investment - without EPMI
mod <- sma(propagule_inv ~ seed_size, data=subset(SummarySpp[["mean"]],species!="EPMI"),method="OLS", log="xy",slope.test=1)
summary(mod)
plot(propagule_inv ~ seed_size, data=subset(SummarySpp[["mean"]],species!="EPMI"),log="xy",pch=16,col=col.spp(species))

#seed size by reproductive investment - all species
mod <- sma(repro_inv ~ seed_size, SummarySpp[["mean"]],method="OLS", log="xy",slope.test=1)
summary(mod)
plot(repro_inv ~ seed_size, SummarySpp[["mean"]],log="xy",pch=16,col=col.spp(species))

#seed size by reproductive investment - without EPMI
mod <- sma(repro_inv ~ seed_size, data=subset(SummarySpp[["mean"]],species!="EPMI"),method="OLS", log="xy",slope.test=1)
summary(mod)
plot(repro_inv ~ seed_size, data=subset(SummarySpp[["mean"]],species!="EPMI"),log="xy",pch=16,col=col.spp(species))

#seed size by reproductive investment - all species
mod <- sma(total_weight_0 ~ seed_size, SummarySpp[["mean"]],method="OLS", log="xy",slope.test=1)
summary(mod)
plot(total_weight_0 ~ seed_size, SummarySpp[["mean"]],log="xy",pch=16,col=col.spp(species))

yvar <- "repro_all_count"
xvar <- "repro_inv"
data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], method="OLS", log="xy",slope.test=1)
results <- lines(fit$groupsummary)
plot(fit,xlab="",ylab="",pch=16, col=col.spp(fit$groupsummary$group),lty=results$linetype,ylim=c(1,300000),xlim=c(1,30000))
results

yvar <- "repro_all_count"
xvar <- "leaf_area_0"
data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], method="OLS", log="xy",slope.test=1)
results <- lines(fit$groupsummary)
plot(fit,xlab="",ylab="",pch=16, col=col.spp(fit$groupsummary$group),lty=results$linetype,ylim=c(1,300000),xlim=c(1,30000))
results

yvar <- "propagule_inv"
xvar <- "leaf_area_0"
data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], method="OLS", log="xy",slope.test=1)
results <- lines(fit$groupsummary)
plot(fit,xlab="",ylab="",pch=16, col=col.spp(fit$groupsummary$group),lty=results$linetype,ylim=c(1,300000),xlim=c(1,30000))
results

yvar <- "propagule_inv"
xvar <- "leaf_area_0_mature"
data <- subset(SummarySppAge[["mean"]],SummarySppAge[["mean"]][[xvar]]>0&SummarySppAge[["mean"]][[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], method="OLS", log="xy")
results <- lines(fit$groupsummary)
plot(fit,xlab="",ylab="",pch=16, col=col.spp(fit$groupsummary$group),lty=results$linetype,ylim=c(1,300000),xlim=c(1,30000))
results


mod <- lm(log10(leaf_area_0)~log10(propagule_inv),data=subset(SummaryInd,leaf_area_0>0&propagule_inv>0))
summary(mod)
mod <- lm(log10(leaf_area_0)~log10(propagule_inv),SummarySpp[["mean"]])
summary(mod)

plot(leaf_area_0_mature~propagule_inv,SummarySppAge[["mean"]],log="xy",cex=1.5,pch=16,col=col.spp(species))
points(leaf_area~propagule_inv,SummaryInd,pch=16,col=col.spp(species))
mod <- lm(log10(leaf_area_0_mature)~log10(propagule_inv),SummarySppAge[["mean"]])
summary(mod)
mod <- lm(log10(leaf_area_0_mature)~log10(propagule_inv),data=subset(SummaryInd,propagule_inv>0&leaf_area>0))
summary(mod)

plot(leaf_area_0_mature~propagule_inv,SummarySppAge[["mean"]],log="xy",cex=1.5,pch=16,col=col.spp(species))

plot(repro_inv~propagule_inv,SummaryInd,pch=16,col=col.spp(species),log="xy")
mod <- lm(log10(repro_inv_mature)~log10(propagule_inv),SummarySppAge[["mean"]])
summary(mod)
mod <- lm(log10(repro_inv_mature)~log10(propagule_inv),data=subset(SummaryInd,propagule_inv>0&repro_inv>0))
summary(mod)

plot(repro_all_count_mature~seed_count,SummarySppAge[["mean"]],log="xy",cex=1.5,pch=16,col=col.spp(species))
mod <- lm(log10(total_weight)~log10(seedset),SummarySppAge[["mean"]])

mod <- lm(log10(leaf_area_0_mature)~log10(propagule_inv),SummarySpp[["mean"]])
summary(mod)
mod <- lm(log10(repro_inv_mature)~log10(propagule_inv),SummarySpp[["mean"]])
summary(mod)
```

#Table 1 showing accessory cost values for the species
```{r}
acc_costs_spp <- dplyr::select(SummarySpp[["mean"]],species,seed_size,accessory_per_seed,prop_accessory_nonzero,seed_costs,prop_success, prepollen_costs,pack_disp_costs,failure_per_seed,prop_failure,prepollen_failure_per_seed,postpollen_aborted_per_seed, seedset)
acc_costs_spp$species <- labels.spp.full()
acc_costs_spp <- format(acc_costs_spp, digit=2)

write.csv(acc_costs_spp, file="figs2/Accessory_Costs/Table01_AccCosts_by_Species.csv",row.names=FALSE)
```

#Figure 2. Ternary diagram showing seed_costs
```{r}
ternary <- select(SummarySpp[["mean"]],species,seed_size,prepollen_costs,pack_disp_costs,seed_costs)
ternary$seed_costs = ternary$seed_size + ternary$prepollen_costs + ternary$pack_disp_costs

ternary$per_poll <-100*ternary$prepollen_costs/ternary$seed_costs
ternary$post_poll <- 100-ternary$per_poll
ternary$per_seed <-100*ternary$seed_size/ternary$seed_costs
ternary$per_disp <-100*ternary$pack_disp_costs/ternary$seed_costs

mod_poll <- sma(per_poll~seed_costs,ternary,slope.test=0,method="OLS",log="x")
mod_seed <- sma(per_seed~seed_costs,ternary,slope.test=0,method="OLS",log="x")
mod_disp <- sma(per_disp~seed_costs,ternary,slope.test=0,method="OLS",log="x")
mod_post_poll <- sma(post_poll~seed_costs,ternary,slope.test=0,method="OLS",log="x")

costs_per_seed <- as.data.frame("costs for seed (%)")
costs_per_seed <- cbind(costs_per_seed,select(mod_seed$groupsummary,r2,pval,Int,Slope,Slope_lowCI,Slope_highCI,Slope_test,Slope_test_p))
names(costs_per_seed) <- c("investment category (mg)","r squared","p value","intercept","slope","slope_lowCI","slope_highCI","slope test","slope test p")

costs_per_seed2 <- as.data.frame("costs for pre-pollination (%)")
costs_per_seed2 <- cbind(costs_per_seed2,select(mod_poll$groupsummary,r2,pval,Int,Slope,Slope_lowCI,Slope_highCI,Slope_test,Slope_test_p))
names(costs_per_seed2) <- c("investment category (mg)","r squared","p value","intercept","slope","slope_lowCI","slope_highCI","slope test","slope test p")
costs_per_seed <- rbind(costs_per_seed,costs_per_seed2)

costs_per_seed2 <- as.data.frame("costs for dispersal (%)")
costs_per_seed2 <- cbind(costs_per_seed2,select(mod_disp$groupsummary,r2,pval,Int,Slope,Slope_lowCI,Slope_highCI,Slope_test,Slope_test_p))
names(costs_per_seed2) <- c("investment category (mg)","r squared","p value","intercept","slope","slope_lowCI","slope_highCI","slope test","slope test p")
costs_per_seed <- rbind(costs_per_seed,costs_per_seed2)

write.csv(costs_per_seed, file="figs2/Accessory_Costs/Table00_in_text_costs_per_seed.csv",row.names=FALSE)

win.metafile("figs2/Accessory_Costs/FigureXX_seedcost_components.wmf", height=6, width=6)
plot

plot(per_seed~seed_costs,ternary,col="black",log="x",pch=21,cex=2,ylim=c(0,75),ylab="prop of seed_costs")
points(per_poll~seed_costs,ternary,col="red",pch=16,cex=2)
points(per_disp~seed_costs,ternary,col="blue",pch=16,cex=2)

abline(mod_poll$groupsummary["Int"][[1]],mod_poll$groupsummary["Slope"][[1]],col="red",lwd=2)
abline(mod_seed$groupsummary["Int"][[1]],mod_seed$groupsummary["Slope"][[1]],col="black",lty=2,lwd=2)
abline(mod_disp$groupsummary["Int"][[1]],mod_disp$groupsummary["Slope"][[1]],col="blue",lwd=2)
legend("topleft",legend=c("seed","prepollen","pack&disp"),col=c("black","red","blue"),pch=16, cex=1.1,bty="n")
dev.off()

win.metafile("figs2/Accessory_Costs/FigureXX_prepoll_vs_postpoll.wmf", height=6, width=6)
plot

plot(per_poll~seed_costs,ternary,col="black",log="x",pch=16,cex=2,ylim=c(0,100),ylab="prop of seed_costs")
points(post_poll~seed_costs,ternary,col="red",pch=16,cex=2)
abline(mod_poll$groupsummary["Int"][[1]],mod_poll$groupsummary["Slope"][[1]],col="black",lwd=2)
abline(mod_post_poll$groupsummary["Int"][[1]],mod_post_poll$groupsummary["Slope"][[1]],col="red",lwd=2)
summary(mod_post_poll)

abline(mod_poll$groupsummary["Int"][[1]],mod_poll$groupsummary["Slope"][[1]],col="red",lwd=2)
abline(mod_seed$groupsummary["Int"][[1]],mod_seed$groupsummary["Slope"][[1]],col="black",lty=2,lwd=2)
abline(mod_disp$groupsummary["Int"][[1]],mod_disp$groupsummary["Slope"][[1]],col="blue",lwd=2)
legend("topleft",legend=c("seed","prepollen","pack&disp"),col=c("black","red","blue"),pch=16, cex=1.1,bty="n")
dev.off()
```

#Figure 2 continued
```{r}
win.metafile("figs2/Accessory_Costs/Figure03_ternary_diagram_seed_costs.wmf", height=5, width=5)
plot

par(mfrow=c(1,1), cex=1, omi=c(1,1,1,1), mai=c(.1,.1,.1,.1)) 

ggtern(data=ternary,aes(y=per_seed,x=per_poll,z=per_disp)) +
  labs(y = "seed",
       x = "pre-poll",
       z = "pack&disp",
       Tarrow = "seed weight (%)",
       Larrow = "pre-pollination costs (%)",
       Rarrow = "packaging & dispersal costs (%)",
       title = "Seed cost components",
       size = 3) +
  geom_point(size=sqrt(ternary$seed_costs/2),shape=20,color=col.spp()) +
   theme_bw() + 
  theme_showarrows() +
  geom_text(label=ternary$species, color="black", hjust=-.3, vjust=sqrt(ternary$seed_costs/500),size=2)

dev.off()
```

#Table 2 showing seedcost breakdown into components, by species
```{r}
prop_seed_costs_spp <- dplyr::select(SummarySpp[["mean"]],species,seed_costs,prop_prepollen_costs,prop_dispersalcosts,prop_seed_costs)
prop_seed_costs_spp$species <- labels.spp.full()
prop_seed_costs_spp <- format(prop_seed_costs_spp, digit=2)
write.csv(prop_seed_costs_spp, file="figs2/Accessory_Costs/Table04_Prop_seed_costs_by_Species.csv",row.names=FALSE)
```

#Figure 4. Scaling of accessory costs versus seed size, by species
```{r}
win.metafile("figs2/Accessory_Costs/Figure04_seed_size_acc_cost_correlations.wmf", height=5, width=15)
plot

par(mfrow=c(1,3), cex=1, omi=c(.6,.1,.05,.05), mai=c(.1,.8,.05,.05)) 
options(scipen = 5)

plot(accessory_per_seed ~ seed_size,data=subset(SummarySpp[["mean"]]),col=col.spp(species),pch=16,log="xy", yaxt="n",xaxt="n", ylim=c(.02,20000), xlim=c(.02,20000), ylab="total accessory costs per seed (mg/seed)",xlab="",cex=1.5)
mod <- lm(log10(accessory_per_seed) ~ log10(seed_size),data=subset(SummarySpp[["mean"]],accessory_per_seed>0))
y.error.bars(SummarySpp[["mean"]]$seed_size,SummarySpp[["mean"]]$accessory_per_seed,SummarySpp[["se"]]$accessory_per_seed)
abline(coef(mod)[1],coef(mod)[2])
abline(coef(mod)[1],1,col="red")
axis(2, at=c(0.1,10,1000), labels=c(0.1,10,1000),cex.axis=1)
axis(1, at=c(0.1,10,1000), labels=c(0.1,10,1000),cex.axis=1)

plot(prepollen_costs~seed_size,SummarySpp[["mean"]],col=col.spp(species),pch=16,log="xy", yaxt="n",xaxt="n", ylim=c(.02,20000), xlim=c(.02,20000), ylab="required pollinator attraction costs per seed (mg/seed)",xlab="",cex=1.5)
#y.error.bars(SummarySpp[["mean"]]$seed_size,SummarySpp[["mean"]]$prepollen_costs,SummarySpp[["se"]]$prepollen_costs)
mod <- lm(log10(prepollen_costs)~log10(seed_size),SummarySpp[["mean"]])
abline(coef(mod)[1],coef(mod)[2])
abline(coef(mod)[1],1,col="red")
axis(2, at=c(0.1,10,1000), labels=c(0.1,10,1000),cex.axis=1)
axis(1, at=c(0.1,10,1000), labels=c(0.1,10,1000),cex.axis=1)

plot(pack_disp_costs~seed_size,SummarySpp[["mean"]],col=col.spp(species),pch=16,log="xy", yaxt="n",xaxt="n", ylim=c(.02,20000), xlim=c(.02,20000), ylab="required provisioning costs per seed (mg/seed)",xlab="",cex=1.5)
#y.error.bars(SummarySpp[["mean"]]$seed_size,SummarySpp[["mean"]]$pack_disp_costs,SummarySpp[["se"]]$prepollen_costs)
mod <- lm(log10(postpollen_all_per_seed)~log10(seed_size),SummarySpp[["mean"]])
abline(coef(mod)[1],coef(mod)[2])
abline(coef(mod)[1],1,col="red")
axis(2, at=c(0.1,10,1000), labels=c(0.1,10,1000),cex.axis=1)
axis(1, at=c(0.1,10,1000), labels=c(0.1,10,1000),cex.axis=1)
mtext(text="seed size (mg)",side=1,line=1.5,outer=TRUE)
dev.off()
```

#Figure 4 v2. Scaling of accessory costs versus weight of embryo + endosperm, by species
```{r}
win.metafile("figs2/Accessory_Costs/Figure04_embryo_size_acc_cost_correlations.wmf", height=5, width=15)
plot

par(mfrow=c(1,3), cex=1, omi=c(.6,.1,.05,.05), mai=c(.1,.8,.05,.05)) 
options(scipen = 5)

plot(accessory_per_seed ~ embryo_endo_size,data=subset(SummarySpp[["mean"]]),col=col.spp(species),pch=16,log="xy", yaxt="n",xaxt="n", ylim=c(.02,20000), xlim=c(.02,20000), ylab="total accessory costs per seed (mg/seed)",xlab="",cex=1.5)
mod <- lm(log10(accessory_per_seed) ~ log10(embryo_endo_size),data=subset(SummarySpp[["mean"]],accessory_per_seed>0))
words.top.left.logxy(mod)
y.error.bars(SummarySpp[["mean"]]$embryo_endo_size,SummarySpp[["mean"]]$accessory_per_seed,SummarySpp[["se"]]$accessory_per_seed)
abline(coef(mod)[1],coef(mod)[2])
abline(coef(mod)[1],1,col="red")
axis(2, at=c(0.1,10,1000), labels=c(0.1,10,1000),cex.axis=1)
axis(1, at=c(0.1,10,1000), labels=c(0.1,10,1000),cex.axis=1)

plot(prepollen_costs~embryo_endo_size,SummarySpp[["mean"]],col=col.spp(species),pch=16,log="xy", yaxt="n",xaxt="n", ylim=c(.02,20000), xlim=c(.02,20000), ylab="required pollinator attraction costs per seed (mg/seed)",xlab="",cex=1.5)
y.error.bars(SummarySpp[["mean"]]$embryo_endo_size,SummarySpp[["mean"]]$prepollen_costs,SummarySpp[["se"]]$prepollen_costs)
mod <- lm(log10(prepollen_costs)~log10(embryo_endo_size),SummarySpp[["mean"]])
words.top.left.logxy(mod)
abline(coef(mod)[1],coef(mod)[2])
abline(coef(mod)[1],1,col="red")
axis(2, at=c(0.1,10,1000), labels=c(0.1,10,1000),cex.axis=1)
axis(1, at=c(0.1,10,1000), labels=c(0.1,10,1000),cex.axis=1)

plot(postpollen_all_per_seed~embryo_endo_size,SummarySpp[["mean"]],col=col.spp(species),pch=16,log="xy", yaxt="n",xaxt="n", ylim=c(.02,20000), xlim=c(.02,20000), ylab="required provisioning costs per seed (mg/seed)",xlab="",cex=1.5)
y.error.bars(SummarySpp[["mean"]]$embryo_endo_size,SummarySpp[["mean"]]$postpollen_all_per_seed,SummarySpp[["se"]]$prepollen_costs)
mod <- lm(log10(postpollen_all_per_seed)~log10(embryo_endo_size),SummarySpp[["mean"]])
words.top.left.logxy(mod)
abline(coef(mod)[1],coef(mod)[2])
abline(coef(mod)[1],1,col="red")
axis(2, at=c(0.1,10,1000), labels=c(0.1,10,1000),cex.axis=1)
axis(1, at=c(0.1,10,1000), labels=c(0.1,10,1000),cex.axis=1)
mtext(text="embryo + endosperm (mg)",side=1,line=1.5,outer=TRUE)

dev.off()
```

#Table 3. Slopes for various seed size by acc cost regressions
```{r}
par(mfrow=c(2,3), cex=1, omi=c(.6,.1,.05,.05), mai=c(.1,.8,.05,.05)) 
options(scipen = 5)

plot(accessory_per_seed ~ seed_size,data=subset(SummarySpp[["mean"]]),col=col.spp(species),pch=16,log="xy", ylim=c(.02,10000), xlim=c(.02,10000), ylab="total per seed accessory costs (mg/seed)",xlab="",cex=1.5)
mod <- lm(log10(accessory_per_seed) ~ log10(seed_size),data=subset(SummarySpp[["mean"]],accessory_per_seed>0))
y.error.bars(SummarySpp[["mean"]]$seed_size,SummarySpp[["mean"]]$accessory_per_seed,SummarySpp[["se"]]$accessory_per_seed)
slopes <- sma(accessory_per_seed ~ seed_size,data=subset(SummarySpp[["mean"]]),slope.test=1,method="OLS", log="xy")
abline(slopes$groupsummary["Int"][[1]],slopes$groupsummary["Slope"][[1]])
abline(slopes$groupsummary["Int"][[1]],1,col="red")
words.bottom.left.logxy(mod)

acc_by_species <- select(slopes$groupsummary,r2,pval,Slope,Slope_lowCI,Slope_highCI,Int,Int_lowCI,Int_highCI,Slope_test_p)

plot(prepollen_costs ~ seed_size,data=subset(SummarySpp[["mean"]]),col=col.spp(species),pch=16,log="xy", ylim=c(.02,10000), ylab="prepollen success costs (mg/seed)",xlab="",cex=1.5)
y.error.bars(SummarySpp[["mean"]]$seed_size,SummarySpp[["mean"]]$prepollen_costs,SummarySpp[["se"]]$prepollen_costs)
mod <- lm(log10(prepollen_costs) ~ log10(seed_size),data=subset(SummarySpp[["mean"]]))
words.bottom.left.logxy(mod)
slopes <- sma(prepollen_costs ~ seed_size,data=subset(SummarySpp[["mean"]]),slope.test=1,method="OLS", log="xy")
abline(slopes$groupsummary["Int"][[1]],slopes$groupsummary["Slope"][[1]])
abline(slopes$groupsummary["Int"][[1]],1,col="red")
acc_by_species <- dplyr::bind_rows(acc_by_species, select(slopes$groupsummary,r2,pval,Slope,Slope_lowCI,Slope_highCI,Int,Int_lowCI,Int_highCI,Slope_test_p))

plot(failure_per_seed ~ seed_size,data=subset(SummarySpp[["mean"]]),col=col.spp(species),pch=16,log="xy", ylim=c(.02,10000), ylab="prepollen failure costs (mg/seed)",xlab="",cex=1.5)
mod <- lm(log10(failure_per_seed) ~ log10(seed_size),data=subset(SummarySpp[["mean"]]))
words.bottom.left.logxy(mod)
slopes <- sma(failure_per_seed ~ seed_size,data=subset(SummarySpp[["mean"]]),slope.test=1,method="OLS", log="xy")
abline(slopes$groupsummary["Int"][[1]],slopes$groupsummary["Slope"][[1]])
abline(slopes$groupsummary["Int"][[1]],1,col="red")
y.error.bars(SummarySpp[["mean"]]$seed_size,SummarySpp[["mean"]]$failure_per_seed,SummarySpp[["se"]]$failure_per_seed)
acc_by_species <- dplyr::bind_rows(acc_by_species, select(slopes$groupsummary,r2,pval,Slope,Slope_lowCI,Slope_highCI,Int,Int_lowCI,Int_highCI,Slope_test_p))

plot(prepollen_all_per_seed ~ seed_size,data=subset(SummarySpp[["mean"]]),col=col.spp(species),pch=16,log="xy", ylim=c(.02,10000), ylab="prepollen failure costs (mg/seed)",xlab="",cex=1.5)
mod <- lm(log10(prepollen_all_per_seed) ~ log10(seed_size),data=subset(SummarySpp[["mean"]]))
words.bottom.right.logxy(mod)
slopes <- sma(prepollen_all_per_seed ~ seed_size,data=subset(SummarySpp[["mean"]]),slope.test=1,method="OLS", log="xy")
abline(slopes$groupsummary["Int"][[1]],slopes$groupsummary["Slope"][[1]])
abline(slopes$groupsummary["Int"][[1]],1,col="red")
y.error.bars(SummarySpp[["mean"]]$seed_size,SummarySpp[["mean"]]$prepollen_all_per_seed,SummarySpp[["se"]]$prepollen_all_per_seed)
acc_by_species <- dplyr::bind_rows(acc_by_species, select(slopes$groupsummary,r2,pval,Slope,Slope_lowCI,Slope_highCI,Int,Int_lowCI,Int_highCI,Slope_test_p))

# plot(postpollen_aborted_per_seed ~ seed_size,data=subset(SummarySpp[["mean"]],species!="COER"),col=col.spp(species),pch=16,log="xy", ylim=c(.02,10000), ylab="aborted fruit accessory costs (mg/seed)",xlab="",cex=1.5,xaxt="n")
# mod <- lm(log10(postpollen_aborted_per_seed) ~ log10(seed_size),data=subset(SummarySpp[["mean"]],accessory_per_seed>0&species!="COER"&species!="BAER"))
# words.top.left.logxy(mod)
# y.error.bars(SummarySpp[["mean"]]$seed_size,SummarySpp[["mean"]]$postpollen_aborted_per_seed,SummarySpp[["se"]]$postpollen_aborted_per_seed)
# slopes <- sma(postpollen_aborted_per_seed ~ seed_size,data=subset(SummarySpp[["mean"]],species!="COER"&species!="BAER"),slope.test=1, log="xy",method="OLS")
# abline(slopes$groupsummary["Int"][[1]],slopes$groupsummary["Slope"][[1]])
# abline(slopes$groupsummary["Int"][[1]],1,col="red")
# acc_by_species <- dplyr::bind_rows(acc_by_species, select(slopes$groupsummary,r2,pval,Slope,Slope_lowCI,Slope_highCI,Int,Int_lowCI,Int_highCI,Slope_test_p))

plot(pack_disp_costs ~ seed_size,data=subset(SummarySpp[["mean"]]),col=col.spp(species),pch=16,log="xy", ylim=c(.02,10000), ylab="dispersal & packaging accessory costs (mg/seed)",xlab="",cex=1.5)
mod <- lm(log10(pack_disp_costs) ~ log10(seed_size),data=subset(SummarySpp[["mean"]]))
words.top.left.logxy(mod)
slopes <- sma(pack_disp_costs ~ seed_size,data=subset(SummarySpp[["mean"]]),slope.test=1, log="xy",method="OLS")
abline(slopes$groupsummary["Int"][[1]],slopes$groupsummary["Slope"][[1]])
abline(slopes$groupsummary["Int"][[1]],1,col="red")
y.error.bars(SummarySpp[["mean"]]$seed_size,SummarySpp[["mean"]]$pack_disp_costs,SummarySpp[["se"]]$pack_disp_costs)
acc_by_species <- dplyr::bind_rows(acc_by_species, select(slopes$groupsummary,r2,pval,Slope,Slope_lowCI,Slope_highCI,Int,Int_lowCI,Int_highCI,Slope_test_p))
mtext(text="seed size (mg)",side=1,line=1.5,outer=TRUE)

slopes <- sma(postpollen_all_per_seed ~ seed_size,data=subset(SummarySpp[["mean"]]),slope.test=1, log="xy",method="OLS")
acc_by_species <- dplyr::bind_rows(acc_by_species, select(slopes$groupsummary,r2,pval,Slope,Slope_lowCI,Slope_highCI,Int,Int_lowCI,Int_highCI,Slope_test_p))

acc_by_species$variable = c("total accessory costs","prepollen_success","failed_tissues","total prepollen","dispersal","total postpollen")

write.csv(acc_by_species, file="figs2/Accessory_Costs/Table03_acc_cost_seed_size_slopes.csv",row.names=FALSE)
```

#Table 3 v2. Slopes for various embryo size by acc cost regressions
```{r}
par(mfrow=c(2,3), cex=1, omi=c(.6,.1,.05,.05), mai=c(.1,.8,.05,.05)) 
options(scipen = 5)

plot(accessory_per_seed ~ embryo_endo_size,data=subset(SummarySpp[["mean"]]),col=col.spp(species),pch=16,log="xy", ylim=c(.02,10000), xlim=c(.02,10000), ylab="total per seed accessory costs (mg/seed)",xlab="",cex=1.5)
mod <- lm(log10(accessory_per_seed) ~ log10(embryo_endo_size),data=subset(SummarySpp[["mean"]],accessory_per_seed>0))
y.error.bars(SummarySpp[["mean"]]$embryo_endo_size,SummarySpp[["mean"]]$accessory_per_seed,SummarySpp[["se"]]$accessory_per_seed)
slopes <- sma(accessory_per_seed ~ embryo_endo_size,data=subset(SummarySpp[["mean"]]),slope.test=1,method="OLS", log="xy")
abline(slopes$groupsummary["Int"][[1]],slopes$groupsummary["Slope"][[1]])
abline(slopes$groupsummary["Int"][[1]],1,col="red")
words.bottom.left.logxy(mod)

acc_by_species <- select(slopes$groupsummary,r2,pval,Slope,Slope_lowCI,Slope_highCI,Int,Int_lowCI,Int_highCI,Slope_test_p)

plot(prepollen_costs ~ embryo_endo_size,data=subset(SummarySpp[["mean"]]),col=col.spp(species),pch=16,log="xy", ylim=c(.02,10000), ylab="prepollen success costs (mg/seed)",xlab="",cex=1.5)
y.error.bars(SummarySpp[["mean"]]$embryo_endo_size,SummarySpp[["mean"]]$prepollen_costs,SummarySpp[["se"]]$prepollen_costs)
mod <- lm(log10(prepollen_costs) ~ log10(embryo_endo_size),data=subset(SummarySpp[["mean"]]))
words.bottom.left.logxy(mod)
slopes <- sma(prepollen_costs ~ embryo_endo_size,data=subset(SummarySpp[["mean"]]),slope.test=1,method="OLS", log="xy")
abline(slopes$groupsummary["Int"][[1]],slopes$groupsummary["Slope"][[1]])
abline(slopes$groupsummary["Int"][[1]],1,col="red")
acc_by_species <- dplyr::bind_rows(acc_by_species, select(slopes$groupsummary,r2,pval,Slope,Slope_lowCI,Slope_highCI,Int,Int_lowCI,Int_highCI,Slope_test_p))

plot(failure_per_seed ~ embryo_endo_size,data=subset(SummarySpp[["mean"]]),col=col.spp(species),pch=16,log="xy", ylim=c(.02,10000), ylab="prepollen failure costs (mg/seed)",xlab="",cex=1.5)
mod <- lm(log10(failure_per_seed) ~ log10(embryo_endo_size),data=subset(SummarySpp[["mean"]]))
words.bottom.left.logxy(mod)
slopes <- sma(failure_per_seed ~ embryo_endo_size,data=subset(SummarySpp[["mean"]]),slope.test=1,method="OLS", log="xy")
abline(slopes$groupsummary["Int"][[1]],slopes$groupsummary["Slope"][[1]])
abline(slopes$groupsummary["Int"][[1]],1,col="red")
y.error.bars(SummarySpp[["mean"]]$embryo_endo_size,SummarySpp[["mean"]]$failure_per_seed,SummarySpp[["se"]]$failure_per_seed)
acc_by_species <- dplyr::bind_rows(acc_by_species, select(slopes$groupsummary,r2,pval,Slope,Slope_lowCI,Slope_highCI,Int,Int_lowCI,Int_highCI,Slope_test_p))

plot(prepollen_all_per_seed ~ embryo_endo_size,data=subset(SummarySpp[["mean"]]),col=col.spp(species),pch=16,log="xy", ylim=c(.02,10000), ylab="prepollen failure costs (mg/seed)",xlab="",cex=1.5)
mod <- lm(log10(prepollen_all_per_seed) ~ log10(embryo_endo_size),data=subset(SummarySpp[["mean"]]))
words.bottom.right.logxy(mod)
slopes <- sma(prepollen_all_per_seed ~ embryo_endo_size,data=subset(SummarySpp[["mean"]]),slope.test=1,method="OLS", log="xy")
abline(slopes$groupsummary["Int"][[1]],slopes$groupsummary["Slope"][[1]])
abline(slopes$groupsummary["Int"][[1]],1,col="red")
y.error.bars(SummarySpp[["mean"]]$embryo_endo_size,SummarySpp[["mean"]]$prepollen_all_per_seed,SummarySpp[["se"]]$prepollen_all_per_seed)
acc_by_species <- dplyr::bind_rows(acc_by_species, select(slopes$groupsummary,r2,pval,Slope,Slope_lowCI,Slope_highCI,Int,Int_lowCI,Int_highCI,Slope_test_p))

plot(pack_disp_costs ~ embryo_endo_size,data=subset(SummarySpp[["mean"]]),col=col.spp(species),pch=16,log="xy", ylim=c(.02,10000), ylab="dispersal & packaging accessory costs (mg/seed)",xlab="",cex=1.5)
mod <- lm(log10(pack_disp_costs) ~ log10(embryo_endo_size),data=subset(SummarySpp[["mean"]]))
words.top.left.logxy(mod)
slopes <- sma(pack_disp_costs ~ embryo_endo_size,data=subset(SummarySpp[["mean"]]),slope.test=1, log="xy",method="OLS")
abline(slopes$groupsummary["Int"][[1]],slopes$groupsummary["Slope"][[1]])
abline(slopes$groupsummary["Int"][[1]],1,col="red")
y.error.bars(SummarySpp[["mean"]]$embryo_endo_size,SummarySpp[["mean"]]$pack_disp_costs,SummarySpp[["se"]]$pack_disp_costs)
acc_by_species <- dplyr::bind_rows(acc_by_species, select(slopes$groupsummary,r2,pval,Slope,Slope_lowCI,Slope_highCI,Int,Int_lowCI,Int_highCI,Slope_test_p))
mtext(text="embryo + endosperm size (mg)",side=1,line=1.5,outer=TRUE)

slopes <- sma(postpollen_all_per_seed ~ embryo_endo_size,data=subset(SummarySpp[["mean"]]),slope.test=1, log="xy",method="OLS")
acc_by_species <- dplyr::bind_rows(acc_by_species, select(slopes$groupsummary,r2,pval,Slope,Slope_lowCI,Slope_highCI,Int,Int_lowCI,Int_highCI,Slope_test_p))

acc_by_species$variable = c("total accessory costs","prepollen_success","failed_tissues","total prepollen","dispersal","total postpollen")

write.csv(acc_by_species, file="figs2/Accessory_Costs/Table03_acc_cost_embryo_endo_size_slopes.csv",row.names=FALSE)
```

#Figure 5 seed count, scaled to plant size, decreases 1:1 with seed size, while bud count decreases less steeply; indication that seed count is what is actually "programmed in"
```{r}
win.metafile("figs2/Accessory_Costs/Figure05_cost_of_flowers_vs_seed_size.wmf", height=5, width=15)
plot

par(mfrow=c(1,3), cex=1, omi=c(.1,.1,.1,.05), mai=c(1,1,.1,.05))
options(scipen = 4)

plot(seedset~seed_size,SummarySpp[["mean"]],log="xy",col=col.spp(species),pch=16, xlim=c(.01,1000),ylim=c(.01,.3),cex=1.5,xaxt="n",xlab="seed size (mg)",ylab="seed set")
mod <- sma(seedset~seed_size,SummarySpp[["mean"]],log="xy", method="OLS")
sma_abline(mod)
y.error.bars(SummarySpp[["mean"]]$seed_size,SummarySpp[["mean"]]$seedset,SummarySpp[["se"]]$seedset)
axis(1, at=c(0.01,1,100), labels=c(0.01,1,100),cex.axis=0.9)
legend("bottomleft",legend=labels.spp(),col=col.spp(),pch=16, cex=.9,bty="n")

#species that abort a disprortionate # of buds can do so because the relative cost of buds (relative to seeds, dispersal) is small
plot(prop_prepollen_costs~seedset,SummarySpp[["mean"]],pch=16,log="x",col=col.spp(species),ylim=c(-.2,1),xlim=c(.01,.3),cex=1.5,yaxt="n",ylab="pre-pollination costs (proportion of total seed costs)",xlab="seed set")
mod <- sma(prop_prepollen_costs~seedset,data=subset(SummarySpp[["mean"]]),log="x",slope=1,method="OLS")
y.error.bars(SummarySpp[["mean"]]$seedset,SummarySpp[["mean"]]$prop_prepollen_costs,SummarySpp[["se"]]$prop_prepollen_costs)
sma_abline(mod)
sma_sum(mod)
text(10^((0.99*(par("usr")[2]-par("usr")[1]))+par("usr")[1]),((0.98*(par("usr")[4]-par("usr")[3]))+par("usr")[3]),
     paste("r2 = ",round(sma_sum(mod)[1],2)),adj=1)
axis(2, at=c(-0.2,0,.2,.4,.6,.8,1), labels=c("",0.0,0.2,0.4,0.6,0.8,""),cex.axis=1)

#put together, big-seeded plants produce lots more buds than predicted from 1:1 relationship, but the "correct" number of seeds
plot(scaled_seed_count~seed_size,SummaryInd,pch=16,log="xy",col=col.spp(species),xlim=c(.01,1000),ylim=c(1e-6,10),yaxt="n",xaxt="n",xlab="seed size (mg)",ylab="count, scaled to plant size")
points(scaled_bud_count~seed_size,SummaryInd,pch=21,col=col.spp(species))
#points(scaled_failure_count~seed_size,SummaryInd,pch=2,col=col.spp(species))
axis(2, at=c(0.000001,0.0001,0.01,1), labels=c(0.000001,0.0001,0.01,1),cex.axis=0.9)
axis(1, at=c(0.01,1,100), labels=c(0.01,1,100),cex.axis=0.9)

mod1 <- sma(scaled_seed_count~seed_size,data=subset(SummaryInd,scaled_seed_count!=0),log="xy",slope=-1,method="OLS")
mod2 <- sma(scaled_bud_count~seed_size,data=subset(SummaryInd,scaled_bud_count!=0),log="xy",slope=-1,method="OLS")
mod3 <- sma(scaled_failure_count~seed_size,data=subset(SummaryInd,scaled_failure_count!=0),log="xy",slope=-1,method="OLS")
sma_abline(mod1)
abline(mod2$coef[[1]][1,1],mod2$coef[[1]][2,1],col="blue")
abline(mod3$coef[[1]][1,1],mod3$coef[[1]][2,1],col="red")
legend("topright",legend=c("seed count","total bud count","failed flower count"),col=c("black","blue","red"),pch=c(16,21,8),bty="n")

dev.off()
```

#Figure 5, using embryo + endosperm
```{r}

win.metafile("figs2/Accessory_Costs/Figure05_cost_of_flowers_vs_embryo_endo_size.wmf", height=5, width=15)
plot

par(mfrow=c(1,3), cex=1, omi=c(.1,.1,.1,.05), mai=c(1,1,.1,.05))
options(scipen = 4)

plot(seedset~embryo_endo_size,SummarySpp[["mean"]],log="xy",col=col.spp(species),pch=16, xlim=c(.01,100),ylim=c(.01,.3),cex=1.5,xaxt="n",xlab="embryo + endosperm size (mg)",ylab="seed set")
mod <- sma(seedset~embryo_endo_size,SummarySpp[["mean"]],log="xy", method="OLS")
sma_abline(mod)
y.error.bars(SummarySpp[["mean"]]$embryo_endo_size,SummarySpp[["mean"]]$seedset,SummarySpp[["se"]]$seedset)
text((10^(0.99*(par("usr")[2]-par("usr")[1]))+par("usr")[1]),(10^(0.98*(par("usr")[4]-par("usr")[3]))+par("usr")[3]),
     paste("r2 = ",round(sma_sum(mod)[1],2)),adj=1)
axis(1, at=c(0.01,1,100), labels=c(0.01,1,100),cex.axis=0.9)
legend("bottomleft",legend=labels.spp(),col=col.spp(),pch=16, cex=.9,bty="n")

#species that abort a disprortionate # of buds can do so because the relative cost of buds (relative to seeds, dispersal) is small
plot(prop_prepollen_costs~seedset,SummarySpp[["mean"]],pch=16,log="x",col=col.spp(species),ylim=c(-.2,1),xlim=c(.01,.3),cex=1.5,yaxt="n",ylab="pre-pollination costs (proportion of total seed costs)",xlab="seed set")
mod <- sma(prop_prepollen_costs~seedset,data=subset(SummarySpp[["mean"]]),log="x",slope=1,method="OLS")
y.error.bars(SummarySpp[["mean"]]$seedset,SummarySpp[["mean"]]$prop_prepollen_costs,SummarySpp[["se"]]$prop_prepollen_costs)
sma_abline(mod)
sma_sum(mod)
text(10^((0.99*(par("usr")[2]-par("usr")[1]))+par("usr")[1]),((0.98*(par("usr")[4]-par("usr")[3]))+par("usr")[3]),
     paste("r2 = ",round(sma_sum(mod)[1],2)),adj=1)
axis(2, at=c(-0.2,0,.2,.4,.6,.8,1), labels=c("",0.0,0.2,0.4,0.6,0.8,""),cex.axis=1)

#put together, big-seeded plants produce lots more buds than predicted from 1:1 relationship, but the "correct" number of seeds
plot(scaled_seed_count~embryo_endo_size,SummaryInd,pch=16,log="xy",col=col.spp(species),xlim=c(.01,100),ylim=c(1e-6,10),yaxt="n",xaxt="n",xlab="embryo + endosperm size (mg)",ylab="count, scaled to plant size")
points(scaled_bud_count~embryo_endo_size,SummaryInd,pch=21,col=col.spp(species))
#points(scaled_failure_count~embryo_endo_size,SummaryInd,pch=2,col=col.spp(species))
axis(2, at=c(0.000001,0.0001,0.01,1), labels=c(0.000001,0.0001,0.01,1),cex.axis=0.9)
axis(1, at=c(0.01,1,100), labels=c(0.01,1,100),cex.axis=0.9)

mod1 <- sma(scaled_seed_count~embryo_endo_size,data=subset(SummaryInd,scaled_seed_count!=0),log="xy",slope=-1,method="OLS")
mod2 <- sma(scaled_bud_count~embryo_endo_size,data=subset(SummaryInd,scaled_bud_count!=0),log="xy",slope=-1,method="OLS")
mod3 <- sma(scaled_failure_count~embryo_endo_size,data=subset(SummaryInd,scaled_failure_count!=0),log="xy",slope=-1,method="OLS")
sma_abline(mod1)
abline(mod2$coef[[1]][1,1],mod2$coef[[1]][2,1],col="blue")
abline(mod3$coef[[1]][1,1],mod3$coef[[1]][2,1],col="red")
legend("topright",legend=c("seed count","total bud count","failed flower count"),col=c("black","blue","red"),pch=c(16,21,8),bty="n")

dev.off()
```

#Table 4.correlations between seedset and accessory costs by species
```{r}
yvar <- "accessory_per_seed"
xvar <- "seedset"
data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], method="OLS", log="xy",slope=-1)
results <- fit$groupsummary

plot(fit,col=col.spp(fit$groupsummary$group),pch=16,xlab="seedset (seeds:ovule)",ylab="total accessory costs (mg/seed)",lty=results$linetype,xlim=c(.0005,.5),ylim=c(.01,200000))

write.csv(results, file="figs2/Accessory_Costs/Table06_eacc_cost_vs_seedset_by_spp.csv",row.names=FALSE)
```

#Table 5. Higher RE, RA, plant size do not lead to lower accessory costs; age shows mixed results
```{r}
win.metafile("figs2/Accessory_Costs/FigureXX_RE_RA_size_age_patterns.wmf", height=10, width=10)
plot

par(mfrow=c(2,2), cex=1, omi=c(.1,.4,.1,.05), mai=c(.6,.3,.1,.1))
options(scipen = 2)

xvar <- "repro_inv"
yvar <- "accessory_per_seed"
data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], method="OLS", log="xy")
results <- lines(fit$groupsummary)
plot(fit,col=col.spp(fit$groupsummary$group),pch=16,xlab="",ylab=yvar,lty=results$linetype)
mtext(text="reproductive investment (mg) (RE)",side=1,line=2,outer=FALSE)
legend_with_r2(results,"bottomright")

write.csv(results, file="figs2/Accessory_Costs/Table07a_accessory_vs_RE.csv",row.names=FALSE)
 
xvar <- "total_weight_0"
yvar <- "accessory_per_seed"
data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], method="OLS", log="xy")
results <- lines(fit$groupsummary)
plot(fit,col=col.spp(fit$groupsummary$group),pch=16,xlab="",ylab=yvar,lty=results$linetype)
mtext(text="total plant size (mg)",side=1,line=2,outer=FALSE)
legend_with_r2(results,"bottomright")

write.csv(results, file="figs2/Accessory_Costs/Table07b_accessory_vs_total_weight.csv",row.names=FALSE)

xvar <- "age"
yvar <- "accessory_per_seed"
data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], method="OLS", log="xy")
results <- lines(fit$groupsummary)
plot(fit,col=col.spp(fit$groupsummary$group),pch=16,xlab="",ylab="",lty=results$linetype)
mtext(text="age (years)",side=1,line=2,outer=FALSE)
mtext(text="per seed accessory costs (mg/seed)",side=2,line=1,outer=TRUE)
legend_with_r2(results,"topleft")

write.csv(results, file="figs2/Accessory_Costs/Table07c_accessory_vs_age.csv",row.names=FALSE)
dev.off()
```

#Table 6.correlations between repro inv and propagule inv by species
```{r}
yvar <- "repro_inv"
xvar <- "propagule_inv"
data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], method="OLS", log="xy")
results <- fit$groupsummary

write.csv(results, file="figs2/Accessory_Costs/Table01_extra_propagule_invest_vs_repro_inv.csv",row.names=FALSE)
```

#Table 7. correlations with total repro inv
```{r}
results <- as.data.frame(matrix(vector(), 0, 9,
                dimnames=list(c(), c("xvar","variable","r2","pval","Slope","Slope_lowCI","Slope_highCI","Int","Slope_test_p"))),
                stringsAsFactors=F)

for (i in c("total_weight","repro_inv","failure_inv","success_inv","propagule_inv","packaging_dispersal_inv","prepollen_success_inv","fruit_inv","flower_inv")) {
  for (j in c("total_weight","leaf_area_0","diameter_0","repro_inv","propagule_inv")) {
yvar <- i
xvar <- j
data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)
fit <- sma(data[[yvar]] ~ data[[xvar]], method="OLS", log="xy",slope.test=1)
temp <- as.data.frame(c(xvar, yvar,select(fit$groupsummary,r2,pval,Slope,Slope_lowCI,Slope_highCI,Int,Slope_test_p,n)))
colnames(temp)[2]<- "variable"
colnames(temp)[1]<- "xvar"
results <- bind_rows(results, temp)
  }
}

write.csv(results, file="figs2/Accessory_Costs/Table07_correlations_with_repro_inv.csv",row.names=FALSE)
```

#Figure 5. Correlations of various reproductive investment categories against plant weight
```{r}
win.metafile("figs2/Accessory_Costs/Figure02_correlations_with_plant_weight.wmf", height=5, width=10)
plot

par(mfrow=c(1,2), cex=1, omi=c(.1,.6,.1,.05), mai=c(.8,.1,.1,.05))
options(scipen = 4)

xvar <- "total_weight_0"
yvar <- "repro_inv"
data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], method="OLS", log="xy")
results <- lines(fit$groupsummary)
#plot(fit,col=col.spp(fit$groupsummary$group),log="xy",ylim=c(1,300000),xlim=c(1,10000000),xlab="",ylab="",lty=results$linetype,pch=16)
mod <- lm(log10(total_weight_0)~log10(repro_inv),data=subset(SummaryInd,repro_inv>0))
abline(0,1)
#words.top.left.logxy(mod)
#mtext(text="total reproductive investment (mg)",side=2,line=2,outer=TRUE)
#mtext(text="total plant weight (mg)",side=1,line=2,outer=FALSE)

yvar <- "repro_inv"
xvar <- "propagule_inv"
data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], method="OLS", log="xy")
results <- lines(fit$groupsummary)
plot(fit,col=col.spp(fit$groupsummary$group),log="xy",ylim=c(1,300000),xlim=c(1,300000), xlab="",ylab="",lty=results$linetype,pch=16)
abline(0,1)
mod <- lm(log10(propagule_inv)~log10(repro_inv),data=subset(SummaryInd,propagule_inv>0))
mtext(text="investment in propagules (mg)",side=1,line=2,outer=FALSE)
mtext(text="total reproductive investment (mg)",side=2,line=2,outer=TRUE)

xvar <- "repro_all_count"
yvar <- "repro_inv"
data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], method="OLS", log="xy",slope.test=1)
results <- lines(fit$groupsummary)
#plot(fit,xlab="",ylab="",pch=16, col=col.spp(fit$groupsummary$group),lty=results$linetype,ylim=c(1,300000),xlim=c(1,30000))
#mtext(text="buds initiated",side=1,line=2,outer=FALSE)

xvar <- "flower_inv"
yvar <- "repro_inv"
data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], method="OLS", log="xy",slope.test=1)
results <- lines(fit$groupsummary)
plot(fit,xlab="",ylab="",pch=16, col=col.spp(fit$groupsummary$group),lty=results$linetype,ylim=c(1,300000),xlim=c(1,300000),yaxt="n")
legend("bottomright",legend=labels.spp(),col=col.spp(),pch=16, cex=.8,bty="n")
abline(0,1)
mtext(text="flower weight * bud count (mg)",side=1,line=2,outer=FALSE)

dev.off()

xvar <- "diameter_0"
yvar <- "repro_all_count"
data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], method="OLS", log="xy",slope.test=1)
results <- lines(fit$groupsummary)
plot(fit,xlab="",ylab="",pch=16, col=col.spp(fit$groupsummary$group),lty=results$linetype,yaxt="n")
points((repro_inv)~(diameter_0),SummarySpp[["mean"]],cex=2,col=col.spp(species),pch=16)

abline(0,1)
#mtext(text="total plant weight (mg)",side=1,line=2,outer=FALSE)

xvar <- "diameter_0"
yvar <- "seed_inv"
data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], method="OLS", log="xy",slope.test=1)
results <- lines(fit$groupsummary)
plot(fit,xlab="",ylab="",pch=16, col=col.spp(fit$groupsummary$group),lty=results$linetype,yaxt="n")
points((repro_inv)~(diameter_0),SummarySpp[["mean"]],cex=2,col=col.spp(species),pch=16)

abline(0,1)
mtext(text="total plant weight (mg)",side=1,line=2,outer=FALSE)
```

###GOOD VISUALS - not currently in manuscript
```{r}
xvar <- "leaf_area_0"
yvar <- "flower_inv"
data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], method="OLS", log="xy")
results <- lines(fit$groupsummary)
plot(fit,col=col.spp(fit$groupsummary$group),log="xy",ylim=c(1,300000),xlim=c(1,10000000),xlab="",ylab="",lty=results$linetype,pch=16)
results

plot(seed_size~total_weight_0,SummaryInd,log="xy",pch=16,col=col.spp(species))
plot(seed_size~total_weight_0,SummarySpp[["mean"]],log="xy",pch=16,col=col.spp(species))

plot(seedset~prop_failure,data=subset(SummarySpp[["mean"]],species!="BAER"&species!="PEPU"),log="xy",pch=16,col=col.spp(species))
mod <- lm(log10(seed_size)~log10(total_weight_0),data=subset(SummarySpp[["mean"]]))
summary(mod)
```

```{r}
win.metafile("figs2/Accessory_Costs/FigureXX_seedcount_reprocount.wmf", height=5, width=5)
plot

par(mfrow=c(1,1), cex=1, omi=c(.1,.1,.1,0.05), mai=c(.8,.8,.1,0.1))
options(scipen = 2)

xvar <- "prepollen_all_count"
yvar <- "seed_count"
data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], method="OLS", log="xy")
results <- lines(fit$groupsummary)
plot(fit,col=col.spp(fit$groupsummary$group),pch=16,xlab="buds initiated (count)",ylab="seed count",lty=results$linetype,xlim=c(0.9,20000),ylim=c(0.9,20000))

abline(0,1,lwd=2)
abline(-2,1,lwd=2)

legend_with_r2(results,"topleft")

dev.off()
```

```{r}
win.metafile("figs2/Accessory_Costs/FigureXX_success_vs_failure.wmf", height=6, width=8)
plot

par(mfrow=c(1,2), cex=1, omi=c(.8,.1,.1,.1), mai=c(.1,.8,.1,.1)) 

xvar <- "repro_inv"
yvar <- "prop_propagule"

data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], method="OLS", log="xy")
results <- lines(fit$groupsummary)
plot(fit,col=col.spp(fit$groupsummary$group),pch=16,lty=results$linetype,ylim=c(.001,1),xlab="",ylab="prop repro energy to propagules")
abline(-0.30103,0,lwd=2)
abline(-1,0,lwd=2)

xvar <- "repro_inv"
yvar <- "prop_success"

data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], method="OLS", log="xy")
results <- lines(fit$groupsummary)
plot(fit,col=col.spp(fit$groupsummary$group),pch=16,lty=results$linetype,ylim=c(.001,1),xlab="",ylab="prop repro energy to success")
abline(-0.30103,0,lwd=2)
abline(-1,0,lwd=2)
mtext(text="reproductive investment (mg)",side=1,line=2,outer=TRUE)

dev.off()
```

#EXTRAS - not in manuscript
#Neither within nor across species, does the proportion of reproductive energy spent on "success" correlate with total reproductive investment
```{r}
par(mfrow=c(1,1), cex=1, omi=c(.1,.1,.1,.05), mai=c(.8,.8,.1,.05))

xvar <- "repro_inv"
yvar <- "prop_success"
data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], log="x",method="OLS")
results <- lines(fit$groupsummary)
plot(fit,col=col.spp(fit$groupsummary$group),xlab="",ylab="",lty=results$linetype,pch=16,log="x")
```

#when reproductive investment is scaled by leaf area there is no significant difference by seed size - so increase in repro inv with seed size simply because species with bigger seeds are bigger plants  
```{r}
plot(scaled_repro_inv~seed_size,SummaryInd, col=col.spp(species),pch=16,log="xy")
points(scaled_repro_inv~seed_size,SummarySpp[["mean"]], cex=2, col=col.spp(species),pch=16)
mod <-sma(scaled_repro_inv~seed_size,SummarySpp[["mean"]],log="xy",method="OLS")
summary(mod)
```

#Consider how accessory cost components shift in terms of costs per seed, and cost as fraction total reproductive investment
```{r}
par(mfrow=c(1,1), cex=1, omi=c(.1,.1,.1,.05), mai=c(.8,.8,.1,.1))

plot(repro_inv~seed_size,SummarySpp[["mean"]],log="xy",col=col.spp(species),pch=16)
mod <- lm(log10(repro_inv)~log10(seed_size),SummarySpp[["mean"]])
abline(mod$coeff[1],mod$coeff[2])
words.top.left.logxy(mod)
y.error.bars(SummarySpp[["mean"]]$seed_size,SummarySpp[["mean"]]$repro_inv,SummarySpp[["se"]]$repro_inv)

par(mfrow=c(1,1), cex=1, omi=c(.1,.1,.1,.05), mai=c(.8,.8,.1,.1))
plot(seedset~embryo_endo_size,SummarySpp[["mean"]],log="xy",col=col.spp(species),pch=16)
mod <- lm(log10(seedset)~log10(embryo_endo_size),SummarySpp[["mean"]])
abline(mod$coeff[1],mod$coeff[2])
words.bottom.left.logxy(mod)
y.error.bars(SummarySpp[["mean"]]$embryo_endo_size,SummarySpp[["mean"]]$seedset,SummarySpp[["se"]]$seedset)
```

#This effect is true across species, since larger-seeded species produce fewer seeds and have higher per seed accessory costs and true within species, since absolute accessory investment is a function of plant size not seedset
```{r}
win.metafile("figs2/Accessory_Costs/FigureXX_EXTRA_acc_cost_by_seed_count.wmf", height=5, width=5)
plot

par(mfrow=c(1,1), cex=1, omi=c(1,1,.1,.1), mai=c(1,1,.5,.5)) 

xvar <- "seed_count"
yvar <- "accessory_per_seed"
data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], method="OLS", log="xy")
results <- lines(fit$groupsummary)
plot(fit,col=col.spp(fit$groupsummary$group),pch=16,xlab=xvar,ylab=yvar,lty=results$linetype)

points(accessory_per_seed~seed_count,data=subset(SummarySpp[["mean"]],accessory_per_seed>0&seed_count>0),col="black",pch=16,cex=2.5)
points(accessory_per_seed~seed_count,data=subset(SummarySpp[["mean"]],accessory_per_seed>0&seed_count>0),col=col.spp(species),pch=16,cex=2)
mod <- lm(log10(accessory_per_seed)~log10(seed_count),data=subset(SummarySpp[["mean"]]))
words.top.right.logxy(mod)
legend_with_r2(results,"bottomleft")

write.csv(results, file="figs2/Accessory_Costs/TableXX_seedcount_vs_accessory.csv",row.names=FALSE)

dev.off()
```

#propagule investment instead of seed_count. Could also replace with seedset
```{r}
win.metafile("figs2/Accessory_Costs/FigureXX_acc_cost_by_seedset.wmf", height=9, width=9)
plot

par(mfrow=c(2,2), cex=1, omi=c(.5,.1,.1,.1), mai=c(.1,1,.3,.1)) 

xvar <- "seedset"
yvar <- "accessory_per_seed"
data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], method="OLS", log="xy")
results <- lines(fit$groupsummary)
plot(fit,col=col.spp(fit$groupsummary$group),pch=16,xlab="",ylab="total accessory costs (mg/seed)",lty=results$linetype,xlim=c(.0005,.5),ylim=c(.01,200000),xaxt="n")
legend_with_r2(results,"bottomleft")

write.csv(results, file="figs2/Accessory_Costs/TableXX_seedset_vs_accessory.csv",row.names=FALSE)

xvar <- "seedset"
yvar <- "prepollen_all_per_seed"
data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], method="OLS", log="xy")
results <- lines(fit$groupsummary)
plot(fit,col=col.spp(results$group),pch=16,xlab="",ylab="pre-pollination costs (mg/seed)",lty=results$linetype,xlim=c(.0005,.5),ylim=c(.01,200000),xaxt="n")
legend_with_r2(results,"bottomleft")

write.csv(results, file="figs2/Accessory_Costs/TableXX_prepollen_all_per_seed_vs_seedset.csv",row.names=FALSE)

xvar <- "seedset"
yvar <- "postpollen_aborted_per_seed"
data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], method="OLS", log="xy") 
results <- lines(fit$groupsummary)
plot(fit,col=col.spp(results$group),pch=16,xlab="",ylab="aborted post pollination costs (mg/seed)",lty=results$linetype,xlim=c(.0005,.5),ylim=c(.01,200000))
legend_with_r2(results,"bottomleft")

write.csv(results, file="figs2/Accessory_Costs/TableXX_postpollen_aborted_per_seed_vs_seedset.csv",row.names=FALSE)

xvar <- "seedset"
yvar <- "pack_disp_costs"
data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], method="OLS", log="xy")
results <- lines(fit$groupsummary)
plot(fit,col=col.spp(results$group),pch=16,xlab="",ylab=yvar,lty=results$linetype,xlim=c(.0005,.5),ylim=c(.01,200000))
legend_with_r2(results,"bottomleft")
mtext(text="seedset",side=1,line=1.5,outer=TRUE)

dev.off()
```

```{r}
xvar <- "seedset"
yvar <- "pack_disp_costs"
data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], method="OLS", log="xy")
results <- lines(fit$groupsummary)

results <- select(results,group,r2,Slope)
names(results) <- c("species","r2","slope")

results$ovules_per_fruit <- c(60,4,1,1,2,2,2,4,1,1,40,2,1,2)
max_seedset <- select(SummarySpp[["max"]],species,seedset) 
min_seedset <- select(SummarySpp[["min"]],species,seedset) 
results <- merge(results, max_seedset, by=c("species"), all=TRUE)
results <- merge(results, min_seedset, by=c("species"), all=TRUE)
names(results)=c("species","r2","slope","ovules_per_fruit","max_seedset","min_seedset")

win.metafile("figs2/Accessory_Costs/FigureXX_dispcosts_vs_ovules.wmf", height=6, width=6)
plot

par(mfrow=c(1,1), cex=1, omi=c(.4,.4,.1,.1), mai=c(.8,.8,.2,.2)) 
plot(ovules_per_fruit~r2,data=subset(results),log="y",col=col.spp(species),pch=16,cex=2,ylab="ovules per flower",xlab="slope between dispersal costs and seedset")
mod <- lm(log10(ovules_per_fruit)~r2,data=subset(results,species!="PELA"))
abline(mod$coeff[1],mod$coeff[2])
words.top.left.logy(mod)
dev.off()

write.csv(results, file="figs2/Accessory_Costs/TableXX_dispersal_vs_seedset.csv",row.names=FALSE)
```

#looking at how the slopes of the relationship between accessory investment and propagule investment shift across species 
##slopes only statistically different from 1 in 2 species
##intercepts quite variable - means that the "baseline" accessory investment, before you get any propagules varies
```{r}
par(mfrow=c(1,1), cex=1, omi=c(.2,.2,.1,.1), mai=c(1,1,.1,.1)) 
plot(propagule_inv~accessory_inv,data=subset(SummaryInd,accessory_inv>0&propagule_inv>0),col=col.spp(species),pch=16,log="xy",xlab="total accessory investment (mg)",ylab="total propagule investment (mg)")
slope_check <- sma(log10(propagule_inv)~ log10(accessory_inv),data=subset(SummaryInd,propagule_inv>0))
summary(slope_check)

data <- select(SummaryInd,species,propagule_inv,accessory_inv)
data <- subset(data,propagule_inv>0)
data <- split(data, data$species)

for(i in 1:14) {
slope_check <- sma(log10(propagule_inv)~ log10(accessory_inv),data[[i]],slope.test=1)
summary(slope_check)
}

xvar <- "accessory_inv"
yvar <- "propagule_inv"

data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], method="OLS", log="xy")
results <- lines(fit$groupsummary)
plot(fit,col=col.spp(fit$groupsummary$group),pch=16,xlab=xvar,ylab=yvar,lty=results$linetype)
```