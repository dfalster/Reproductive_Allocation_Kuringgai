pdf("figs2/Accessory_Costs/scaled_ovule count.pdf", height=6, width=6)
plot

par(mfrow=c(1,2), cex=1, omi=c(.1,.1,.05,.05), mai=c(.8,.8,.1,.05)) 
options(scipen = 5)

mod1 <- sma(scaled_ovule_count ~ prepollen_costs, data=subset(SummarySpp[["mean"]],species!="PEPU"),method="OLS", log="xy",slope.test=-1)
mod2 <- sma(scaled_seed_count ~ embryo_endo_size, data=subset(SummarySpp[["mean"]]),method="OLS", log="xy",slope.test=-1)
plot(scaled_ovule_count ~ prepollen_costs, SummarySpp[["mean"]],log="xy",pch=1,col=col.spp(species),xlab="cost to make a unit: dashed =ovule; solid=seed",ylim=c(.001,200),ylab="scaled count",xlim=c(.01,100),cex=1.5)
points(scaled_seed_count ~ embryo_endo_size, SummarySpp[["mean"]],cex=1.5,pch=16,col=col.spp(species))
line_function_log_xy(SummarySpp[["mean"]]$prepollen_costs,mod1,3)
line_function_log_xy(SummarySpp[["mean"]]$embryo_endo_size,mod2,1)
#points(scaled_seed_count ~ seed_costs, SummarySpp[["mean"]],pch=12,col=col.spp(species))
arrows(SummarySpp[["mean"]]$embryo_endo_size,SummarySpp[["mean"]]$scaled_seed_count,SummarySpp[["mean"]]$prepollen_costs,SummarySpp[["mean"]]$scaled_ovule_count,col=col.spp(SummarySpp[["mean"]]$species),code=0)

#mod <- sma(scaled_seed_count ~ embryo_endo_size, data=subset(SummarySpp[["mean"]]),method="OLS", log="xy",slope.test=-1)
summary(mod1)
plot(success_inv ~ prepollen_success_inv, SummarySpp[["mean"]],log="xy",pch=16,col=col.spp(species),xlim=c(10,100000),ylim=c(10,100000))
mod <- sma(success_inv ~ prepollen_success_inv, data=subset(SummarySpp[["mean"]]),method="OLS", log="xy",slope.test=1)
line_function_log_xy(SummarySpp[["mean"]]$prepollen_success_inv,mod,1)
line_function_log_xy_zero(SummarySpp[["mean"]]$prepollen_success_inv,mod,1)

SummaryInd$ovule_ratio <- SummaryInd$prepollen_costs/SummaryInd$embryo_endo_size

SummarySpp[["mean"]]$pre_pollen_all_inv_scaled <- SummarySpp[["mean"]]$prepollen_all_inv /SummarySpp[["mean"]]$leaf_area

plot(leaf_area~prepollen_all_inv,SummarySpp[["mean"]],log="xy",col=col.spp(species),pch=16)
mod <- sma(leaf_area~prepollen_all_inv,SummarySpp[["mean"]],log="xy",slope=1, method="OLS")
summary(mod)

plot(pre_pollen_all_inv_scaled~embryo_endo_size,SummarySpp[["mean"]],log="xy",col=col.spp(species),pch=16)
mod <- sma(pre_pollen_all_inv_scaled~embryo_endo_size,SummarySpp[["mean"]],log="xy",slope=1, method="OLS")

dev.off()

#Data 0. means, counts to include in manuscript
```{r}
#number of plants in study
count(subset(SummaryInd,age>1))

#number of reproducing individuals in study
count(subset(SummaryInd,repro_inv>0))

#number of individuals in study that produce seed
count(subset(SummaryInd,seed_count>0))

#average proportion energy going to failed tissues (among reproducing individuals)
mean(subset(SummaryInd$prop_failure,SummaryInd$prop_failure>0))

#average proportion of energy going to accessory costs (based on propagules, not seeds) (among individuals that produce seed)
mean(subset(SummaryInd$prop_accessory_seed,SummaryInd$seed_count>0))
mean(subset(SummaryInd$prop_accessory_ee,SummaryInd$seed_count>0))
SummarySpp[["mean"]]$prop_accessory_seed

check <- dplyr::select(SummarySpp[["mean"]],species,prop_accessory_ee,prop_accessory_seed)
check <- dplyr::arrange(check,prop_accessory_ee)
  
#individual with lowest accessory costs
check <- subset(SummaryInd,prop_propagule_ee>.1)
check <- dplyr::select(check,individual,prop_propagule_ee)
max(check$prop_propagule_ee)

#relationship between plant weight and number of ovules initiated - bigger plants produce proportionally fewer buds
mod <- sma(repro_all_count~total_weight,SummaryInd,method="OLS",log="xy",slope=1)
summary(mod)

#there is no relationship between the proportion of energy going to seeds and the total energy for seedcosts
mod <- sma(seed_costs~prop_seed_costs,SummarySpp[["mean"]],method="OLS",log="y")
summary(mod)



#RE per seed unrelated to seedsize
mod <- sma(repro_inv_per_seed ~ embryo_endo_size, SummarySpp[["mean"]],method="OLS", log="xy",slope.test=1)
summary(mod)
plot(repro_inv_per_seed ~ embryo_endo_size, SummarySpp[["mean"]],log="xy",pch=16,col=col.spp(species))

#energy invested in accessory tissues unrelated to seedsize
mod <- sma(accessory_per_seed_using_ee ~ embryo_endo_size, data=subset(SummarySpp[["mean"]]),method="OLS", log="xy",slope.test=1)
summary(mod)
plot(accessory_per_seed_using_ee ~ embryo_endo_size, SummarySpp[["mean"]],log="xy",pch=16,col=col.spp(species))

#total seed costs unrelated to seedsize
mod <- sma(seed_costs ~ embryo_endo_size, SummarySpp[["mean"]],method="OLS", log="xy",slope.test=1)
summary(mod)
plot(seed_costs ~ embryo_endo_size, SummarySpp[["mean"]],log="xy",pch=16,col=col.spp(species))

#failure per seed unrelated to seedsize
mod <- sma(failure_per_seed ~ embryo_endo_size, data=subset(SummarySpp[["mean"]]),method="OLS", log="xy",slope.test=1)
summary(mod)
plot(failure_per_seed ~ embryo_endo_size, SummarySpp[["mean"]],log="xy",pch=16,col=col.spp(species))



mod <- sma(prop_prepollen_costs ~ seedset, data=subset(SummarySpp[["mean"]]),method="OLS", log="x",slope.test=1)
summary(mod)
plot(prop_prepollen_costs ~ seedset, SummarySpp[["mean"]],log="",pch=16,col=col.spp(species))



mod <- sma(scaled_ovule_count ~ prepollen_costs, data=subset(SummarySpp[["mean"]]),method="OLS", log="xy",slope.test=-1)
summary(mod)
plot(scaled_ovule_count ~ prepollen_costs, SummarySpp[["mean"]],log="xy",pch=16,col=col.spp(species))


mod <- sma(scaled_seed_count ~ embryo_endo_size, data=subset(SummarySpp[["mean"]]),method="OLS", log="xy",slope.test=-1)
summary(mod)
plot(scaled_seed_count ~ embryo_endo_size, SummarySpp[["mean"]],log="xy",pch=16,col=col.spp(species))



mod <- sma(scaled_seed_count ~ provisioning_costs, data=subset(SummarySpp[["mean"]]),method="OLS", log="xy",slope.test=-1)
summary(mod)
plot(scaled_seed_count ~ provisioning_costs, SummarySpp[["mean"]],log="xy",pch=16,col=col.spp(species))

mod <- sma(scaled_seed_count ~ seed_costs, data=subset(SummarySpp[["mean"]]),method="OLS", log="xy",slope.test=-1)
summary(mod)
plot(scaled_seed_count ~ seed_costs, SummarySpp[["mean"]],log="xy",pch=16,col=col.spp(species))


mod <- sma(prepollen_all_per_seed ~ embryo_endo_size, data=subset(SummarySpp[["mean"]]),method="OLS", log="xy",slope.test=1)
summary(mod)
plot(prepollen_failure_per_seed ~ embryo_endo_size, SummarySpp[["mean"]],log="xy",pch=16,col=col.spp(species),ylim=c(.02,10000))
points(prepollen_costs~ embryo_endo_size, SummarySpp[["mean"]],log="xy",pch=1,col=col.spp(species))

#more failure = lower seedset across species - in discussion
mod <- sma(seedset ~ prop_failure, data=subset(SummarySpp[["mean"]],species!="BAER"),method="OLS", log="",slope.test=1)
summary(mod)
plot(seedset ~ prop_failure, SummarySpp[["mean"]],log="",pch=16,col=col.spp(species))

#seed size by propagule investment - all species
mod <- sma(propagule_inv ~ embryo_endo_size, SummarySpp[["mean"]],method="OLS", log="xy",slope.test=1)
summary(mod)
plot(propagule_inv_ee ~ embryo_endo_size, SummarySpp[["mean"]],log="xy",pch=16,col=col.spp(species))

#seed size by propagule investment - without EPMI
mod <- sma(propagule_inv ~ embryo_endo_size, data=subset(SummarySpp[["mean"]],species!="EPMI"),method="OLS", log="xy",slope.test=1)
summary(mod)
plot(propagule_inv ~ embryo_endo_size, data=subset(SummarySpp[["mean"]],species!="EPMI"),log="xy",pch=16,col=col.spp(species))

#seed size by reproductive investment - all species
mod <- sma(repro_inv ~ embryo_endo_size, SummarySpp[["mean"]],method="OLS", log="xy",slope.test=1)
summary(mod)
plot(repro_inv ~ embryo_endo_size, SummarySpp[["mean"]],log="xy",pch=16,col=col.spp(species))

#seed size by reproductive investment - without EPMI
mod <- sma(repro_inv ~ embryo_endo_size, data=subset(SummarySpp[["mean"]],species!="EPMI"),method="OLS", log="xy",slope.test=1)
summary(mod)
plot(repro_inv ~ embryo_endo_size, data=subset(SummarySpp[["mean"]],species!="EPMI"),log="xy",pch=16,col=col.spp(species))

#seedset by pollen attraction
mod <- sma(prop_prepollen_costs~seedset,data=subset(SummarySpp[["mean"]]),log="x",slope=1,method="OLS")
summary(mod)


#seed size by total weight - all species
mod <- sma(total_weight_0 ~ embryo_endo_size, SummarySpp[["mean"]],method="OLS", log="xy",slope.test=1)
summary(mod)
plot(total_weight_0 ~ embryo_endo_size, SummarySpp[["mean"]],log="xy",pch=16,col=col.spp(species))


#scaled ovule production vs prop pollen attraction  - all species
mod <- sma(prop_prepollen_costs~scaled_ovule_count,data=subset(SummarySpp[["mean"]]),log="x",slope=1,method="OLS")
summary(mod)
plot(prop_prepollen_costs ~ scaled_ovule_count, SummarySpp[["mean"]],log="xy",pch=16,col=col.spp(species))


yvar <- "repro_all_count"
xvar <- "repro_inv"
data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], method="OLS", log="xy")
results <- lines(fit$groupsummary)
plot(fit,xlab=xvar,ylab=yvar,pch=16, col=col.spp(fit$groupsummary$group),lty=results$linetype,ylim=c(1,300000),xlim=c(1,30000))
results

yvar <- "repro_all_count"
xvar <- "leaf_area_0"
data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], method="OLS", log="xy",slope.test=1)
results <- lines(fit$groupsummary)
plot(fit,xlab=xvar,ylab=yvar,pch=16, col=col.spp(fit$groupsummary$group),lty=results$linetype,ylim=c(1,300000),xlim=c(1,30000))
results

yvar <- "propagule_inv"
xvar <- "leaf_area_0"
data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], method="OLS", log="xy",slope.test=1)
results <- lines(fit$groupsummary)
plot(fit,xlab=xvar,ylab=yvar,pch=16, col=col.spp(fit$groupsummary$group),lty=results$linetype,ylim=c(1,300000),xlim=c(1,30000))
results

yvar <- "propagule_inv"
xvar <- "leaf_area_0_mature"
data <- subset(SummarySppAge[["mean"]],SummarySppAge[["mean"]][[xvar]]>0&SummarySppAge[["mean"]][[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], method="OLS", log="xy")
results <- lines(fit$groupsummary)
plot(fit,xlab=xvar,ylab=yvar,pch=16, col=col.spp(fit$groupsummary$group),lty=results$linetype,ylim=c(1,300000),xlim=c(1,30000))
results

xvar <- "propagule_inv"
yvar <- "repro_inv"
data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], method="OLS", log="xy",slope.test=1)
results <- lines(fit$groupsummary)
plot(fit,xlab=xvar,ylab=yvar,pch=16, col=col.spp(fit$groupsummary$group),lty=results$linetype,ylim=c(1,300000),xlim=c(1,30000))
results
```

#Table 1 showing accessory cost values for the species
```{r}
acc_costs_spp <- dplyr::select(SummarySpp[["mean"]],species,embryo_endo_size,seedset,repro_inv_per_seed,prop_failure,prop_prepollen_vs_RE, prop_dispersal_vs_RE,prop_embryo_endo_vs_RE,seed_costs,prop_prepollen_costs,prop_postpollen_costs,embryo_endo_size,pack_disp_costs,prepollen_costs,failure_inv,repro_inv,seed_count)
acc_costs_spp$species <- labels.spp.full()
acc_costs_spp_format <- acc_costs_spp
for (i in c("embryo_endo_size","seedset","repro_inv_per_seed","prop_failure","prop_prepollen_vs_RE","prop_dispersal_vs_RE","prop_embryo_endo_vs_RE","seed_costs","prop_prepollen_costs","prop_postpollen_costs")) {
  acc_costs_spp_format[[i]] <- round(acc_costs_spp_format[[i]],digits=3)
}

for (i in c("prop_failure","prop_prepollen_vs_RE","prop_dispersal_vs_RE","prop_embryo_endo_vs_RE","prop_prepollen_costs","prop_postpollen_costs")) {
  acc_costs_spp_format[[i]] <- round(100*acc_costs_spp_format[[i]],digits=1)
}

write.csv(acc_costs_spp_format, file="figs2/Accessory_Costs/Table01_AccCosts_by_Species.csv",row.names=FALSE)
```

#Table 1. color dots
```{r}
win.metafile("figs2/Accessory_Costs/Table01_dots.wmf", height=3, width=.2)
plot

par(mfrow=c(1,1), cex=1, omi=c(.01,.01,.01,.01), mai=c(.01,.01,.01,.01)) 
dots <- dplyr::select(SummarySpp[["mean"]],species)
dots$x <- c(1,1,1,1,1,1,1,1,1,1,1,1,1,1)
dots$y <- c(28,26,24,22,20,18,16,14,12,10,8,6,4,2)
plot(y~x,dots,cex=1.5,pch=16,xlab="",ylab="",xaxt="n",yaxt="n",col=col.spp(dots$species),bty="n",xlim=c(0.8,1.2),ylim=c(1.8,28.2))

dev.off()
```

#Table 2. Slopes for various embryo size by acc cost regressions
```{r}
par(mfrow=c(2,3), cex=1, omi=c(.6,.1,.05,.05), mai=c(.1,.8,.05,.05)) 
options(scipen = 5)

library(smatr)

plot(accessory_per_seed ~ embryo_endo_size,data=subset(SummarySpp[["mean"]]),col=col.spp(species),pch=16,log="xy", ylim=c(.02,10000), xlim=c(.02,10000), ylab="total per seed accessory costs (mg/seed)",xlab="",cex=1.5)
y.error.bars(SummarySpp[["mean"]]$embryo_endo_size,SummarySpp[["mean"]]$accessory_per_seed,SummarySpp[["se"]]$accessory_per_seed)
slopes <- sma(accessory_per_seed ~ embryo_endo_size,data=subset(SummarySpp[["mean"]]),slope.test=1,method="OLS", log="xy")
abline(slopes$groupsummary["Int"][[1]],slopes$groupsummary["Slope"][[1]])
abline(slopes$groupsummary["Int"][[1]],1,lty=2)
words.bottom.left.logxy(mod)

acc_by_species <- dplyr::select(slopes$groupsummary,r2,pval,Slope,Slope_lowCI,Slope_highCI,Int,Int_lowCI,Int_highCI,Slope_test_p)

plot(seed_costs ~ embryo_endo_size,data=subset(SummarySpp[["mean"]]),col=col.spp(species),pch=16,log="xy", ylim=c(.02,10000), ylab="seed costs (mg/seed)",xlab="",cex=1.5)
y.error.bars(SummarySpp[["mean"]]$embryo_endo_size,SummarySpp[["mean"]]$seed_costs,SummarySpp[["se"]]$seed_costs)
slopes <- sma(seed_costs ~ embryo_endo_size,data=subset(SummarySpp[["mean"]]),slope.test=1,method="OLS", log="xy")
abline(slopes$groupsummary["Int"][[1]],slopes$groupsummary["Slope"][[1]])
abline(slopes$groupsummary["Int"][[1]],1,lty=2)
acc_by_species <- dplyr::bind_rows(acc_by_species, dplyr::select(slopes$groupsummary,r2,pval,Slope,Slope_lowCI,Slope_highCI,Int,Int_lowCI,Int_highCI,Slope_test_p))

plot(prepollen_costs ~ embryo_endo_size,data=subset(SummarySpp[["mean"]]),col=col.spp(species),pch=16,log="xy", ylim=c(.02,10000), ylab="prepollen success costs (mg/seed)",xlab="",cex=1.5)
y.error.bars(SummarySpp[["mean"]]$embryo_endo_size,SummarySpp[["mean"]]$prepollen_costs,SummarySpp[["se"]]$prepollen_costs)
slopes <- sma(prepollen_costs ~ embryo_endo_size,data=subset(SummarySpp[["mean"]]),slope.test=1,method="OLS", log="xy")
abline(slopes$groupsummary["Int"][[1]],slopes$groupsummary["Slope"][[1]])
abline(slopes$groupsummary["Int"][[1]],1,lty=2)
acc_by_species <- dplyr::bind_rows(acc_by_species, dplyr::select(slopes$groupsummary,r2,pval,Slope,Slope_lowCI,Slope_highCI,Int,Int_lowCI,Int_highCI,Slope_test_p))

plot(provisioning_costs ~ embryo_endo_size,data=subset(SummarySpp[["mean"]]),col=col.spp(species),pch=16,log="xy", ylim=c(.02,10000), ylab="dispersal & packaging accessory costs (mg/seed)",xlab="",cex=1.5)
slopes <- sma(provisioning_costs ~ embryo_endo_size,data=subset(SummarySpp[["mean"]]),slope.test=1, log="xy",method="OLS")
abline(slopes$groupsummary["Int"][[1]],slopes$groupsummary["Slope"][[1]])
abline(slopes$groupsummary["Int"][[1]],1,lty=2)
y.error.bars(SummarySpp[["mean"]]$embryo_endo_size,SummarySpp[["mean"]]$provisioning_costs,SummarySpp[["se"]]$provisioning_costs)
acc_by_species <- dplyr::bind_rows(acc_by_species, dplyr::select(slopes$groupsummary,r2,pval,Slope,Slope_lowCI,Slope_highCI,Int,Int_lowCI,Int_highCI,Slope_test_p))
mtext(text="seed size (mg)",side=1,line=1.5,outer=TRUE)

plot(failure_per_seed ~ embryo_endo_size,data=subset(SummarySpp[["mean"]]),col=col.spp(species),pch=16,log="xy", ylim=c(.02,10000), ylab="all failure costs (mg/seed)",xlab="",cex=1.5)
slopes <- sma(failure_per_seed ~ embryo_endo_size,data=subset(SummarySpp[["mean"]]),slope.test=1,method="OLS", log="xy")
abline(slopes$groupsummary["Int"][[1]],slopes$groupsummary["Slope"][[1]])
abline(slopes$groupsummary["Int"][[1]],1,lty=2)
y.error.bars(SummarySpp[["mean"]]$embryo_endo_size,SummarySpp[["mean"]]$failure_per_seed,SummarySpp[["se"]]$failure_per_seed)
acc_by_species <- dplyr::bind_rows(acc_by_species, dplyr::select(slopes$groupsummary,r2,pval,Slope,Slope_lowCI,Slope_highCI,Int,Int_lowCI,Int_highCI,Slope_test_p))

plot(prepollen_all_per_seed ~ embryo_endo_size,data=subset(SummarySpp[["mean"]]),col=col.spp(species),pch=16,log="xy", ylim=c(.02,10000), ylab="all pre-pollination costs (mg/seed)",xlab="",cex=1.5,xaxt="n")
y.error.bars(SummarySpp[["mean"]]$embryo_endo_size,SummarySpp[["mean"]]$prepollen_all_per_seed,SummarySpp[["se"]]$prepollen_all_per_seed)
slopes <- sma(prepollen_all_per_seed ~ embryo_endo_size,data=subset(SummarySpp[["mean"]]),slope.test=1, log="xy",method="OLS")
abline(slopes$groupsummary["Int"][[1]],slopes$groupsummary["Slope"][[1]])
abline(slopes$groupsummary["Int"][[1]],1,lty=2)
acc_by_species <- dplyr::bind_rows(acc_by_species, dplyr::select(slopes$groupsummary,r2,pval,Slope,Slope_lowCI,Slope_highCI,Int,Int_lowCI,Int_highCI,Slope_test_p))

plot(prepollen_failure_per_seed ~ embryo_endo_size,data=subset(SummarySpp[["mean"]]),col=col.spp(species),pch=16,log="xy", ylim=c(.02,10000), ylab="aborted pre-pollination costs (mg/seed)",xlab="",cex=1.5,xaxt="n")
y.error.bars(SummarySpp[["mean"]]$embryo_endo_size,SummarySpp[["mean"]]$prepollen_failure_per_seed,SummarySpp[["se"]]$prepollen_failure_per_seed)
slopes <- sma(prepollen_failure_per_seed ~ embryo_endo_size,data=subset(SummarySpp[["mean"]]),slope.test=1, log="xy",method="OLS")
abline(slopes$groupsummary["Int"][[1]],slopes$groupsummary["Slope"][[1]])
abline(slopes$groupsummary["Int"][[1]],1,lty=2)
acc_by_species <- dplyr::bind_rows(acc_by_species, dplyr::select(slopes$groupsummary,r2,pval,Slope,Slope_lowCI,Slope_highCI,Int,Int_lowCI,Int_highCI,Slope_test_p))

plot(postpollen_aborted_per_seed ~ embryo_endo_size,data=subset(SummarySpp[["mean"]]),col=col.spp(species),pch=16,log="xy", ylim=c(.02,10000), ylab="aborted during provisioning costs (mg/seed)",xlab="",cex=1.5,xaxt="n")
y.error.bars(SummarySpp[["mean"]]$embryo_endo_size,SummarySpp[["mean"]]$postpollen_aborted_per_seed,SummarySpp[["se"]]$postpollen_aborted_per_seed)
slopes <- sma(postpollen_aborted_per_seed ~ embryo_endo_size,data=subset(SummarySpp[["mean"]]),slope.test=1, log="xy",method="OLS")
abline(slopes$groupsummary["Int"][[1]],slopes$groupsummary["Slope"][[1]])
abline(slopes$groupsummary["Int"][[1]],1,lty=2)
acc_by_species <- dplyr::bind_rows(acc_by_species, dplyr::select(slopes$groupsummary,r2,pval,Slope,Slope_lowCI,Slope_highCI,Int,Int_lowCI,Int_highCI,Slope_test_p))

acc_by_species$variable = c("total accessory costs","seed costs","pollen attraction costs","provisioning costs", "failed tissues costs","all pre-pollen costs per seed","failed pre-pollination costs","failed provisioning costs")

acc_by_species$slope2 <- paste(format(acc_by_species$Slope,digits=3)," (",format(acc_by_species$Slope_lowCI,digits=3)," - ",format(acc_by_species$Slope_highCI,digits=3),")",sep="")

acc_by_species$r2 <- format(acc_by_species$r2,digits=2)
acc_by_species$pval <- format(acc_by_species$pval,digits=2)
acc_by_species$Slope_test_p <- format(acc_by_species$Slope_test_p,digits=3)
acc_slopes <- dplyr::select(acc_by_species,variable,r2,slope2,Slope_test_p)

write.csv(acc_slopes, file="figs2/Accessory_Costs/Table02_acc_cost_embryo_size_slopes.csv",row.names=FALSE)
```

#Table Supplementary.correlations between repro inv and propagule inv by species
```{r}
yvar <- "repro_inv"
xvar <- "propagule_inv"
data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], method="OLS", log="xy")
results <- fit$groupsummary
results$r2 <- format(results$r2,digits=2)
results$pval <- format(results$pval,digits=3)
acc_slopes <- dplyr::select(results,group,n,r2,pval)
names(acc_slopes) <- c("species","n_propagule","r2_propagule","p_propagule")

yvar <- "repro_inv"
xvar <- "flower_inv"
data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], method="OLS", log="xy")
results <- fit$groupsummary
results$r2 <- format(results$r2,digits=2)
results$pval <- format(results$pval,digits=3)
acc_slopes2 <- dplyr::select(results,group,n,r2,pval)
names(acc_slopes2) <- c("species","n_flower","r2_flower","p_flower")
acc_slopes <- dplyr::left_join(acc_slopes, acc_slopes2, by ="species")

write.csv(acc_slopes, file="figs2/Accessory_Costs/Table_S3_propagule_invest_vs_repro_inv.csv",row.names=FALSE)
```

#Table 3. correlations with total repro inv
```{r}
results <- as.data.frame(matrix(vector(), 0, 9,
                dimnames=list(c(), c("xvar","variable","r2","pval","Slope","Slope_lowCI","Slope_highCI","Int","Slope_test_p"))),
                stringsAsFactors=F)

for (i in c("total_weight","failure_inv","success_inv","propagule_inv","packaging_dispersal_inv","prepollen_success_inv","fruit_inv","flower_inv")) {
  for (j in c("repro_inv")) {
yvar <- i
xvar <- j
data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)
fit <- sma(data[[yvar]] ~ data[[xvar]], method="OLS", log="xy",slope.test=1)
temp <- as.data.frame(c(xvar, yvar,dplyr::select(fit$groupsummary,r2,pval,Slope,Slope_lowCI,Slope_highCI,Int,Slope_test_p,n)))
colnames(temp)[2]<- "variable"
colnames(temp)[1]<- "xvar"
results <- bind_rows(results, temp)
  }
}

results$slope2 <- paste(format(results$Slope,digits=3)," (",format(results$Slope_lowCI,digits=3)," - ",format(results$Slope_highCI,digits=3),")",sep="")

results$r2 <- format(results$r2,digits=3)
results$pval <- format(results$pval,digits=3)
results$Slope_test_p <- format(results$Slope_test_p,digits=3)
#results  <- dplyr::select(results,variable,n,r2,pval,slope2,Slope_test_p)
results  <- dplyr::select(results,variable,n,r2,pval)

write.csv(results, file="figs2/Accessory_Costs/Table03_correlations_with_repro_inv.csv",row.names=FALSE)
```


plot(scaled_seed_count~prop_prepollen_costs,SummarySpp[["mean"]],pch=16,log="y",col=col.spp(species))
points(scaled_ovule_count~prop_prepollen_costs,SummarySpp[["mean"]],pch=21,col=col.spp(species))
#points(scaled_failure_count~embryo_endo_size,SummaryInd,pch=2,col=col.spp(species))
axis(2, at=c(0.0001,0.01,1,100), labels=c(0.0001,0.01,1,100),cex.axis=1)
axis(1, at=c(0.01,1,100), labels=c("","",""),cex.axis=1)
mtext("count, scaled to plant size",2,line=2.3)
mod1 <- sma(scaled_seed_count~prop_prepollen_costs,data=subset(SummarySpp[["mean"]],scaled_seed_count!=0),log="y",slope=-1,method="OLS")
mod2 <- sma(scaled_ovule_count~prepollen_costs,data=subset(SummarySpp[["mean"]],scaled_ovule_count!=0),log="xy",slope=3.23,method="OLS")
mod3 <- sma(scaled_failure_count~embryo_endo_size,data=subset(SummaryInd,scaled_failure_count!=0),log="xy",slope=-1,method="OLS")

line_function_log_xy(SummarySpp[["mean"]]$embryo_endo_size,mod1,1)
line_function_log_xy(SummarySpp[["mean"]]$embryo_endo_size,mod2,2)
legend("topright",legend=c("seed count","initiated ovules count"),col=c("black","black"),pch=c(16,21),bty="n")

summary(mod1)
summary(mod2)
extra.top.left.logxy("a",2,1.2)

#Figure 2. Scaling of accessory costs versus weight of embryo + endosperm, by species
```{r}
win.metafile("figs2/Accessory_Costs/Figure02_embryo_size_acc_cost_correlations.wmf", height=9, width=10)
plot

par(mfrow=c(2,2), cex=1, omi=c(1,.1,.05,.05), mai=c(.2,.8,.1,.05)) 
options(scipen = 5)

plot((scaled_seed_count)~(embryo_endo_size),SummaryInd,pch=16,log="xy",col=col.spp(species),xlim=c(.002,500),ylim=c(1e-4,1000),yaxt="n",xaxt="n",ylab="")
points(scaled_ovule_count~embryo_endo_size,SummaryInd,pch=21,col=col.spp(species))
#points(scaled_failure_count~embryo_endo_size,SummaryInd,pch=2,col=col.spp(species))
axis(2, at=c(0.0001,0.01,1,100), labels=c(0.0001,0.01,1,100),cex.axis=1)
axis(1, at=c(0.01,1,100), labels=c("","",""),cex.axis=1)
mtext("count, scaled to plant size",2,line=2.3)
mod1 <- sma(scaled_seed_count~embryo_endo_size,data=subset(SummaryInd,scaled_seed_count!=0),log="xy",slope=-1,method="OLS")
mod2 <- sma(scaled_ovule_count~embryo_endo_size,data=subset(SummaryInd,scaled_ovule_count!=0),log="xy",slope=-1,method="OLS")
mod3 <- sma(scaled_failure_count~embryo_endo_size,data=subset(SummaryInd,scaled_failure_count!=0),log="xy",slope=-1,method="OLS")

line_function_log_xy(SummarySpp[["mean"]]$embryo_endo_size,mod1,1)
line_function_log_xy(SummarySpp[["mean"]]$embryo_endo_size,mod2,2)
legend("topright",legend=c("seed count","initiated ovules count"),col=c("black","black"),pch=c(16,21),bty="n")

extra.top.left.logxy("a",2,1.2)

plot(seedset~embryo_endo_size,SummarySpp[["mean"]],log="xy",col=col.spp(species),pch=16, xlim=c(.002,500),ylim=c(.004,.6),cex=1.5,xaxt="n",xlab="",ylab="")
mod <- sma(seedset~embryo_endo_size,SummarySpp[["mean"]],log="xy", method="OLS")
y.error.bars.2(SummarySpp[["mean"]]$embryo_endo_size,SummarySpp[["mean"]]$seedset,SummarySpp[["se"]]$seedset)
#text((10^(0.99*(par("usr")[2]-par("usr")[1])+par("usr")[1])),(10^(0.97*(par("usr")[4]-par("usr")[3])+par("usr")[3])),paste("r2 = ",round(sma_sum(mod)[1],2)),adj=1)
line_function_log_xy(SummarySpp[["mean"]]$embryo_endo_size,mod,1)
axis(1, at=c(0.01,1,100), labels=c("","",""),cex.axis=1)
mtext("seed set",2,line=2.3)
extra.top.left.logxy("b",2,1.2)

plot(prepollen_costs~embryo_endo_size,SummarySpp[["mean"]],col=col.spp(species),pch=16,log="xy", yaxt="n",xaxt="n", ylim=c(.02,5000), xlim=c(.002,500), ylab="",xlab="",cex=1.5)
y.error.bars.2(SummarySpp[["mean"]]$embryo_endo_size,SummarySpp[["mean"]]$prepollen_costs,SummarySpp[["se"]]$prepollen_costs)
mod <- sma(prepollen_costs~embryo_endo_size,SummarySpp[["mean"]],log="xy",method="OLS")
#abline(mod$groupsummary["Int"][[1]],1,lty=2)
axis(2, at=c(0.1,10,1000), labels=c(0.1,10,1000),cex.axis=1)
axis(1, at=c(0.01,1,100), labels=c(0.01,1,100),cex.axis=1)
mtext("pollen attraction costs (mg/seed)",2,line=2.3)
line_function_log_xy(SummarySpp[["mean"]]$embryo_endo_size,mod,1)
line_function_log_xy_zero(SummarySpp[["mean"]]$embryo_endo_size,mod,1)
extra.top.left.logxy("c",2,1.2)

plot(postpollen_all_per_seed~embryo_endo_size,SummarySpp[["mean"]],col=col.spp(species),pch=16,log="xy", yaxt="n",xaxt="n", ylim=c(.02,5000), xlim=c(.002,500), ylab="",xlab="",cex=1.5)
y.error.bars.2(SummarySpp[["mean"]]$embryo_endo_size,SummarySpp[["mean"]]$postpollen_all_per_seed,SummarySpp[["se"]]$prepollen_costs)
mod <- sma(postpollen_all_per_seed~embryo_endo_size,SummarySpp[["mean"]],log="xy",method="OLS")
line_function_log_xy(SummarySpp[["mean"]]$embryo_endo_size,mod,1)
line_function_log_xy_zero(SummarySpp[["mean"]]$embryo_endo_size,mod,1)
axis(2, at=c(0.1,10,1000), labels=c(0.1,10,1000),cex.axis=1)
axis(1, at=c(0.01,1,100), labels=c(0.01,1,100),cex.axis=1)
mtext("provisioning costs (mg/seed)",2,line=2.3)
extra.top.left.logxy("d",2,1.2)

mtext(text="     seed size (mg)",side=1,line=1.5,outer=TRUE,adj=0.5)
mtext(text="                     parental pessimist",line=3,side=1,adj=0,outer=TRUE,font=3)
mtext(text="parental optimist    ",line=3,side=1,adj=1,outer=TRUE,font=3)

dev.off()
```

#Figure 3. Correlations of various reproductive investment categories against plant weight
```{r}
win.metafile("figs2/Accessory_Costs/Figure03_correlations_with_plant_weight.wmf", height=5, width=10)
plot

par(mfrow=c(1,2), cex=1, omi=c(.1,.6,.1,.05), mai=c(.8,.1,.1,.05))
options(scipen = 4)

library(smatr)

yvar <- "repro_inv"
xvar <- "propagule_inv"
data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], method="OLS", log="xy")
results <- lines(fit$groupsummary)
plot(fit,col=col.spp(fit$groupsummary$group),log="xy",ylim=c(1,300000),xlim=c(1,300000), xlab="",ylab="",lty=results$linetype,pch=16)
abline(0,1)
mod <- sma(propagule_inv~repro_inv,data=subset(SummaryInd,propagule_inv>0),log="xy",method="OLS")
mtext(text="total propagule investment (mg)",side=1,line=2.2,outer=FALSE)
mtext(text="total reproductive investment (mg)",side=2,line=2,outer=TRUE)
extra.top.left.logxy("a",2,1.2)

xvar <- "flower_inv"
yvar <- "repro_inv"
data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], method="OLS", log="xy",slope.test=1)
results <- lines(fit$groupsummary)
plot(fit,xlab="",ylab="",pch=16, col=col.spp(fit$groupsummary$group),lty=results$linetype,ylim=c(1,300000),xlim=c(1,300000),yaxt="n")
axis(2, at=c(1,100,10000),labels=c("","",""))
abline(0,1)
mtext(text="flower weight * bud count (mg)",side=1,line=2.2,outer=FALSE)
extra.top.left.logxy("b",2,1.2)

dev.off()
```

#Supplementary Table. Higher RE, RA, plant size do not lead to lower accessory costs; age shows mixed results
```{r}
win.metafile("figs2/Accessory_Costs/Figure_SXX_RE_RA_size_age_patterns.wmf", height=10, width=10)
plot

par(mfrow=c(2,2), cex=1, omi=c(.1,.4,.1,.05), mai=c(.6,.3,.1,.1))
options(scipen = 2)

xvar <- "repro_inv"
yvar <- "accessory_per_seed"
data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], method="OLS", log="xy")
results <- lines(fit$groupsummary)
plot(fit,col=col.spp(fit$groupsummary$group),pch=16,xlab="",ylab=yvar,lty=results$linetype)
mtext(text="reproductive investment (mg) (RE)",side=1,line=2,outer=FALSE)
legend_with_r2(results,"bottomright")

write.csv(results, file="figs2/Accessory_Costs/Table05a_accessory_vs_RE.csv",row.names=FALSE)
 
xvar <- "total_weight_0"
yvar <- "accessory_per_seed"
data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], method="OLS", log="xy")
results <- lines(fit$groupsummary)
plot(fit,col=col.spp(fit$groupsummary$group),pch=16,xlab="",ylab=yvar,lty=results$linetype)
mtext(text="total plant size (mg)",side=1,line=2,outer=FALSE)
legend_with_r2(results,"bottomright")

write.csv(results, file="figs2/Accessory_Costs/Table05b_accessory_vs_total_weight.csv",row.names=FALSE)

xvar <- "age"
yvar <- "accessory_per_seed"
data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], method="OLS", log="xy")
results <- lines(fit$groupsummary)
plot(fit,col=col.spp(fit$groupsummary$group),pch=16,xlab="",ylab="",lty=results$linetype)
mtext(text="age (years)",side=1,line=2,outer=FALSE)
mtext(text="per seed accessory costs (mg/seed)",side=2,line=1,outer=TRUE)
legend_with_r2(results,"topleft")

write.csv(results, file="figs2/Accessory_Costs/Table05c_accessory_vs_age.csv",row.names=FALSE)
dev.off()
```


#Table X.correlations between repro inv and flower inv by species (noted in Discussiong)
```{r}
yvar <- "repro_inv"
xvar <- "flower_inv"
data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], method="OLS", log="xy")
results <- fit$groupsummary
results$r2 <- format(results$r2,digits=2)
results$pval <- format(results$pval,digits=3)
acc_slopes <- dplyr::select(results,group,n,r2,pval)

write.csv(results, file="figs2/Accessory_Costs/Table06extra_flower_invest_vs_repro_inv.csv",row.names=FALSE)
```

#Table 7 extra. correlations with total repro inv
```{r}
results <- as.data.frame(matrix(vector(), 0, 9,
                dimnames=list(c(), c("xvar","variable","r2","pval","Slope","Slope_lowCI","Slope_highCI","Int","Slope_test_p"))),
                stringsAsFactors=F)

for (i in c("total_weight","repro_inv","failure_inv","success_inv","propagule_inv","packaging_dispersal_inv","prepollen_success_inv","fruit_inv","flower_inv")) {
  for (j in c("total_weight","leaf_area_0","diameter_0","repro_inv","propagule_inv")) {
yvar <- i
xvar <- j
data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)
fit <- sma(data[[yvar]] ~ data[[xvar]], method="OLS", log="xy",slope.test=1)
temp <- as.data.frame(c(xvar, yvar,dplyr::select(fit$groupsummary,r2,pval,Slope,Slope_lowCI,Slope_highCI,Int,Slope_test_p,n)))
colnames(temp)[2]<- "variable"
colnames(temp)[1]<- "xvar"
results <- bind_rows(results, temp)
  }
}

write.csv(results, file="figs2/Accessory_Costs/Table07_EXTRA_correlations_with_repro_inv.csv",row.names=FALSE)
```

###GOOD VISUALS - not currently in manuscript
```{r}
xvar <- "leaf_area_0"
yvar <- "flower_inv"
data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], method="OLS", log="xy")
results <- lines(fit$groupsummary)
plot(fit,col=col.spp(fit$groupsummary$group),log="xy",ylim=c(1,300000),xlim=c(1,10000000),xlab="",ylab="",lty=results$linetype,pch=16)
results

plot(seed_size~total_weight_0,SummaryInd,log="xy",pch=16,col=col.spp(species))
plot(seed_size~total_weight_0,SummarySpp[["mean"]],log="xy",pch=16,col=col.spp(species))

plot(seedset~prop_failure,data=subset(SummarySpp[["mean"]],species!="BAER"&species!="PEPU"),log="xy",pch=16,col=col.spp(species))
mod <- sma(seed_size~total_weight_0,data=subset(SummarySpp[["mean"]]),log="xy",method="OLS")
summary(mod)
```


```{r}
Cairo("figs2/Accessory_Costs/FigureXX_seedcount_reprocount.svg", height=5, width=5,type="svg",pointsize=10,units="in")
#win.metafile("figs2/Accessory_Costs/FigureXX_seedcount_reprocount.wmf", height=5, width=5)

plot

par(mfrow=c(1,1), cex=1, omi=c(.1,.1,.1,0.05), mai=c(.8,.8,.1,0.1))
options(scipen = 2)

xvar <- "repro_all_count"
yvar <- "seed_count"
data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], method="OLS", log="xy",slope=1)
results <- lines(fit$groupsummary)
plot(fit,col=col.spp(fit$groupsummary$group),pch=16,xlab="buds initiated (count)",ylab="seed count",lty=results$linetype,xlim=c(0.9,20000),ylim=c(0.9,20000))

dplyr::select(results,group,n,r2,pval,Slope,Slope_test_p)
abline(0,1,lwd=2)
abline(-2,1,lwd=2)

legend_with_r2(results,"topleft")

dev.off()
```

#Although very little energy goes into propagules (or embryos) a notable amount of energy is required for successful seeds to form
```{r}
win.metafile("figs2/Accessory_Costs/FigureXX_success_vs_failure.wmf", height=6, width=8)
plot

par(mfrow=c(1,2), cex=1, omi=c(.8,.1,.1,.1), mai=c(.1,.8,.1,.1)) 

xvar <- "repro_inv"
yvar <- "prop_propagule"

data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], method="OLS", log="xy")
results <- lines(fit$groupsummary)
plot(fit,col=col.spp(fit$groupsummary$group),pch=16,lty=results$linetype,ylim=c(.001,1),xlab="",ylab="prop repro energy to propagules")
abline(-0.30103,0,lwd=2)
abline(-1,0,lwd=2)

xvar <- "repro_inv"
yvar <- "prop_success"

data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], method="OLS", log="xy")
results <- lines(fit$groupsummary)
plot(fit,col=col.spp(fit$groupsummary$group),pch=16,lty=results$linetype,ylim=c(.001,1),xlab="",ylab="prop repro energy to success")
abline(-0.30103,0,lwd=2)
abline(-1,0,lwd=2)
mtext(text="reproductive investment (mg)",side=1,line=2,outer=TRUE)

dev.off()
```

#Neither within nor across species, does the proportion of reproductive energy spent on "success" correlate with total reproductive investment
```{r}
par(mfrow=c(1,1), cex=1, omi=c(.1,.1,.1,.05), mai=c(1.2,1.2,.1,.05))

xvar <- "repro_inv"
yvar <- "prop_success"
data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], log="x",method="OLS")
results <- lines(fit$groupsummary)
plot(fit,col=col.spp(fit$groupsummary$group),xlab=xvar,ylab=yvar,lty=results$linetype,pch=16,log="x")
```

#when reproductive investment is scaled by plant size there is no significant difference by seed size - so increase in repro inv with seed size simply because species with bigger seeds are bigger plants  
```{r}
plot(scaled_repro_inv~seed_size,SummaryInd, col=col.spp(species),pch=16,log="xy")
points(scaled_repro_inv~seed_size,SummarySpp[["mean"]], cex=2, col=col.spp(species),pch=16)
mod <-sma(scaled_repro_inv~seed_size,SummarySpp[["mean"]],log="xy",method="OLS")
summary(mod)
```

#This effect is true across species, since larger-seeded species produce fewer seeds and have higher per seed accessory costs and true within species, since absolute accessory investment is a function of plant size not seedset
```{r}
win.metafile("figs2/Accessory_Costs/FigureXX_EXTRA_acc_cost_by_seed_count.wmf", height=5, width=5)
plot

par(mfrow=c(1,1), cex=1, omi=c(.1,.1,.1,.1), mai=c(1,1,.5,.5)) 

xvar <- "seed_count"
yvar <- "accessory_per_seed"
data <- subset(SummaryInd,SummaryInd[[xvar]]>0&SummaryInd[[yvar]]>0)

fit <- sma(data[[yvar]] ~ data[[xvar]]*data[["species"]], method="OLS", log="xy")
results <- lines(fit$groupsummary)
plot(fit,col=col.spp(fit$groupsummary$group),pch=16,xlab=xvar,ylab=yvar,lty=results$linetype)

points(accessory_per_seed~seed_count,data=subset(SummarySpp[["mean"]],accessory_per_seed>0&seed_count>0),col="black",pch=16,cex=2.5)
points(accessory_per_seed~seed_count,data=subset(SummarySpp[["mean"]],accessory_per_seed>0&seed_count>0),col=col.spp(species),pch=16,cex=2)
mod <- sma(accessory_per_seed~seed_count,data=subset(SummarySpp[["mean"]]),method="OLS", log="xy")
#words.top.right.logxy(mod)
legend_with_r2(results,"bottomleft")

write.csv(results, file="figs2/Accessory_Costs/TableXX_seedcount_vs_accessory.csv",row.names=FALSE)

dev.off()
```