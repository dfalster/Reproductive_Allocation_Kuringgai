```{r, echo=FALSE,results='hide', message=FALSE}
library(remake)
create_bindings()

source("scripts/summary_dataframes.R")
source("scripts/functions.R")
```
#Growth data, general patterns
- proportion of maxH matters more for some species than others. 
    1. The 4 "canopy" species all tend to have high correlations between "prop maxH" and growth and reproductive investment (both relative and absolute)  (HATE, BAER, PELA, PEPU)
    2. The lower-growing species are more variable, with "prop maxH"" mattering more for some than others - not surprising since some species like BOLE, PILI show inconsistent increases in H with increasing age, due to breakage, shedding

- For almost all species there is a strong negative relationship between RGR and RA - more reproduction = less growth  
    1. As expected, a cost of reproduction is reduced growth
    2. Meanwhile there is the strong positive relationship between growth investment and reproductive investment, because bigger plants grow and reproduce more.  
    3. It is good to have a big enough data set to capture both trends across a single dataset - and to capture them consistently across many species

- Many plants have a clear upturn in RA and corresponding downturn in RGR at a specific prop maxH  
    1. e.g. see EPMI for distinct pattern
    2. More robust curve-fitting techniques are required to better illustrate this pattern (**CURVE FITTING**)


#Comparing different measures of growth and how these measures shift with age

###Weight vs. height
- No surprises here , but need to fit proper lines to the data (**CURVE FITTING**)
- Plants asymptote in weight as they reach their maximum height. This is true for all species, although some species, like BOLE and GRBU, have a much messier scatter than others  
- The follow on of course is to look at growth measures vs. height   
- NOTE: The variable "prop_maxH" is "current height/maximum species height (across all sites)", hence varying from 0-1. This lets data from all species to be plotted together  
```{r, echo=FALSE, message=FALSE, fig.width=7, fig.height=7}
par(mfrow=c(1,1), cex=1, omi=c(.1,.1,.1,.1), mai=c(1.1,1.1,.6,0.2))
plot((total_weight~prop_maxH), SummaryInd, col=col.spp[as.factor(species)],pch=16,log="y")
legend("topleft",legend=names(labels.spp),col=col.spp,pch=16, cex=.8,bty="n")
```

```{r, echo=FALSE, message=FALSE, fig.width=21, fig.height=28}
par(mfrow=c(4,4), cex=1, omi=c(.7,.7,.1,.1), mai=c(.7,.9,.4,0.2)) 
yvar <- "total_weight"
xvar <- "prop_maxH"

data <- SummaryInd
data <- split(data, data$species)
lmfits <- lapply(data, function(x) lm(log(x[[yvar]]) ~  (x[[xvar]])))
results <- summarise_all_fits(lmfits)

results$r.squared <- round(results$r.squared,digits=3)
results$p.value <- round(results$p.value,digits=3)
results$a <- round(results$a,digits=2)
results$b <- round(results$b,digits=2)

results

for(spp in names(data)) {
  plot_yvar_vs_xvar(data[[spp]], yvar, xvar,log="y",
                    main=spp, xlab="", ylab="")
  abline(lmfits[[spp]])
}

mtext("proportion Hmax", 1, outer=TRUE,cex=1.2)
mtext("Total weight", 2, outer=TRUE,cex=1.2)
```

```{r, echo=FALSE, message=FALSE, fig.width=21, fig.height=28}
par(mfrow=c(4,4), cex=1, omi=c(.7,.7,.1,.1), mai=c(.7,.9,.4,0.2)) 
yvar <- "growth_stem_area"
xvar <- "RA"

data <- subset(SummaryInd,RA>0)
data <- split(data, data$species)
lmfits <- lapply(data, function(x) lm(log(x[[yvar]]) ~  (x[[xvar]])))
results <- summarise_all_fits(lmfits)

results$r.squared <- round(results$r.squared,digits=3)
results$p.value <- round(results$p.value,digits=3)
results$a <- round(results$a,digits=2)
results$b <- round(results$b,digits=2)

results

for(spp in names(data)) {
  plot_yvar_vs_xvar(data[[spp]], yvar, xvar,log="y",
                    main=spp)
  abline(lmfits[[spp]])
}

```

###Growth Investment versus proportion max H
- For the canopy species, PELA, HATE, PEPU, BAER, investment in growth plateaus (i.e. growth relative to size decreases) at ~40% maxH
- I think this suggests that relative height is a good predictor of growth investment in these species, but not in some of the lower-growing species
- For the shorter and shorter-lived species there is much less of a relationship, or a complete lack of relationship (i.e. BOLE, PHPH)  
- Quite interesting, there is a distinctly negative relationship for GRBU; its absolute growth investment actually declines as it increases in size  
- For many of the species with a good relationship, it seems that there are two breakpoints in the curve - wondering what these mean with respect to reproductive onset and RA  
 
```{r, echo=FALSE,message=FALSE,fig.width=14, fig.height=7}
par(mfrow=c(1,2), cex=1, omi=c(.8,0.3,.5,0.2), mai=c(.7,1,.1,0.2))
plot((GrowthInv~prop_maxH), SummaryInd, log="y", col=col.spp[as.factor(species)],pch=16,xlab="")
legend("topleft",legend=names(labels.spp),col=col.spp,pch=16, cex=.8,bty="n")

plot(GrowthInv~prop_maxH, SummaryInd, log="y", col=col.age[as.factor(age)],pch=16,ylab="",xlab="")
legend("topleft",legend=names(labels.age),col=col.age,pch=16, cex=.8,bty="n")
mtext("proportion Hmax", 1, outer=TRUE,cex=1.2)
```

### Growth investment by Proportion Hmax
```{r, echo=FALSE, message=FALSE, fig.width=21, fig.height=21}
par(mfrow=c(4,4), cex=1, omi=c(.7,.7,.1,.1), mai=c(.7,.9,.4,0.2)) 
yvar <- "GrowthInv"
xvar <- "prop_maxH"
data <- SummaryInd
data <- split(data, data$species)

for(spp in names(data)) {
  plot_yvar_vs_xvar(data[[spp]], yvar, xvar, log="y",
                    main=spp, xlab="",ylab="")
}

mtext("proportion Hmax", 1, outer=TRUE,cex=1.2)
mtext("Growth investment", 2, outer=TRUE,cex=1.2)

data <- SummaryInd
data <- split(data, data$species)
lmfits <- lapply(data, function(x) lm((x[[yvar]]) ~  (x[[xvar]])))
results <- summarise_all_fits(lmfits)

results$r.squared <- round(results$r.squared,digits=3)
results$p.value <- round(results$p.value,digits=3)
results$a <- round(results$a,digits=2)
results$b <- round(results$b,digits=2)

results
```

### RGR by proportion Hmax
- Ignoring a few outliers, RGR declines with increasing height is 12 species  
- Only in HEPU and PILI is there no significant trend  
- The species with a poorer correlation are mostly shorter ones that are presumably often broken off   
- These are continued ways to look at the question of how important is height (relative to the species maxH) in understanding its growth and reproduction  

```{r, echo=FALSE, message=FALSE, fig.width=7, fig.height=7}
par(mfrow=c(1,1), cex=1, omi=c(.1,.1,.1,.1), mai=c(1.1,1.1,1,0.6)) 
plot(RGR~prop_maxH,SummaryInd,col=col.spp[as.factor(species)],pch=16)
legend("topright",legend=names(labels.spp),col=col.spp,pch=16, cex=.8,bty="n")
```

```{r, echo=FALSE, message=FALSE, fig.width=21, fig.height=35}
par(mfrow=c(4,4), cex=1, omi=c(.7,.7,.1,.1), mai=c(.7,.7,.5,0.2)) 
yvar <- "RGR"
xvar <- "prop_maxH"
data <- SummaryInd
data <- split(data, data$species)

for(spp in names(data)) {
  plot_yvar_vs_xvar(data[[spp]], yvar, xvar,
                    main=spp, xlab="",ylab="")
}

mtext("proportion Hmax", 1, outer=TRUE,cex=1.2)
mtext("RGR", 2, outer=TRUE,cex=1.2)

data <- SummaryInd
data <- split(data, data$species)
lmfits <- lapply(data, function(x) lm((x[[yvar]]) ~  (x[[xvar]])))
results <- summarise_all_fits(lmfits)

results$r.squared <- round(results$r.squared,digits=3)
results$p.value <- round(results$p.value,digits=3)
results$a <- round(results$a,digits=2)
results$b <- round(results$b,digits=2)

results
```

#Comparing growth of whole plant vs. leader

###Correlations between different growth measures
- Increased cross-sectional area of a leader and the entire plant are fairly correlated and uneffected by age (once not seedlings)  
- however, some species, such as BAER are much branchier and lower correlation
TO DO: species should be a random effect for these stats- I want to know the effect of age on the relationship once the effect of species has been accounted for    


```{r, echo=FALSE,message=FALSE, fig.width=14, fig.height=7}
par(mfrow=c(1,1), cex=1, omi=c(.1,.1,.1,.1), mai=c(1.1,1.1,1,0.6)) 
plot(growth_shoot_area~growth_stem_area,data=subset(SummaryInd), log="xy",col=col.spp[as.factor(species)], pch=16, cex=.8,xlab="change in basal stem area",ylab="change in shoot area")
legend("bottomright",col=col.spp, legend=names(labels.spp), pch=16, cex=1,bty="n")

mod <- lm(growth_shoot_area~species*age*growth_stem_area,SummaryInd)
anova(mod)
``` 

###Shifts in leafiness with age  
- Individual shoots looked decidedly "less leafy" in many older plants  
- This led me to wonder how leaf lifespan - or some other variable - was shifting with age   
- The number of leaves along a leader is overall uneffected by age  
- However, looking at individual species: BAER, BOLE, GRBU, GRSP, HEPU, PUTU have declining leaf counts along a shoot with age (omitting youngest cohort only)
- And PELA, PEPU show a significant increase in leaf counts along a single shoot with age, probably because they have very few leaves when young and are slow to "start growing"

```{r, echo=FALSE,message=FALSE, fig.width=7, fig.height=7}
par(mfrow=c(1,1), cex=1, omi=c(.1,.1,.1,.1), mai=c(1.1,1.1,1,0.6)) 
plot(lvs_end_total~age,data=subset(SummaryInd,age>2),log="xy", xlab="age",ylab="final leaf count along shoot",col=col.spp[as.factor(species)])
legend("bottomright",col=col.spp, legend=names(labels.spp), pch=16, cex=1,bty="n")

yvar <- "lvs_end_total"
xvar <- "age"

data <- subset(SummaryInd,age>2)
data <- split(data, data$species)
lmfits <- lapply(data, function(x) lm((x[[yvar]]) ~  log(x[[xvar]])))
results <- summarise_all_fits(lmfits)

results$r.squared <- round(results$r.squared,digits=3)
results$p.value <- round(results$p.value,digits=3)
results$a <- round(results$a,digits=2)
results$b <- round(results$b,digits=2)

results
```

###Leaf weight (relative to total weight) also declines with age  
- These numbers are currently incomplete - waiting for full set of "leaf weight" numbers to finalize this  

```{r, echo=FALSE,message=FALSE,, fig.width=7, fig.height=7}
par(mfrow=c(1,1), cex=1, omi=c(.1,.1,.1,.1), mai=c(1.1,1.1,1,0.6)) 
plot(leaf_weight~total_weight,SummaryInd, log="xy",col=col.spp[as.factor(species)], pch=16, cex=0.8)
legend("bottomright",col=col.spp, legend=names(labels.spp), pch=16, cex=.8, bty="n")
```

###Shifts in shoot extension with age
- This is a weak effect - probably not worth pursuing
- The decrease in leaf number along a shoot is largely caused by declining shoot extension, not shifts in leaf lifespan  
- For many of these species, the shift is between the "sapling" and "adult" stages - i.e. when they begin reproducing  
- PELA, PEPU stands out by showing increasing shoot extension with age - because it grows so slowly in the beginning; regression for these two species becomes highly significant when seedlings are included
- this decline in shoot extension only appears when plotted against age, not prop maxH, emphasizing that it is not a very robust finding
- I am surprised there isn't more of an effect, because the plants look so much less leafy when larger/older

```{r, echo=FALSE,message=FALSE,, fig.width=14, fig.height=7}
par(mfrow=c(1,2), cex=1, omi=c(.1,.1,.1,.1), mai=c(1.1,1.1,1,0.6)) 
mod <- lm(prop_maxH~new_length,data=subset(SummaryInd,age>2))
plot(new_length~prop_maxH,data=subset(SummaryInd,age>2),log="y", ylab="shoot extension (mm)",col=col.spp[as.factor(species)],pch=16)
legend(12,200,col=col.spp, legend=names(labels.spp), pch=16, cex=.8,bty="n")
words.bottom.right.logy(mod)

mod <- lm(age~species*new_length,data=subset(SummaryInd,age>2))
plot(new_length~age,data=subset(SummaryInd,age>2),log="xy", ylab="shoot extension (mm)",col=col.spp[as.factor(species)],pch=16)
words.bottom.right.logxy(mod)
anova(mod)

yvar <- "new_length"
xvar <- "age"

data <- subset(SummaryInd, age>2)
data <- split(data, data$species)
lmfits <- lapply(data, function(x) lm((x[[yvar]]) ~  log(x[[xvar]])))
results <- summarise_all_fits(lmfits)

results$r.squared <- round(results$r.squared,digits=3)
results$p.value <- round(results$p.value,digits=3)
results$a <- round(results$a,digits=2)
results$b <- round(results$b,digits=2)

results
```

```{r, echo=FALSE, message=FALSE, fig.width=21, fig.height=35}
par(mfrow=c(4,4), cex=1, omi=c(.7,.7,.1,.1), mai=c(.7,.7,.5,0.2)) 
yvar <- "new_length"
xvar <- "age"
data <- subset(SummaryInd, age>2)
data <- split(data, data$species)

for(spp in names(data)) {
  plot_yvar_vs_xvar(data[[spp]], yvar, xvar,log="xy",
                    main=spp, xlab="",ylab="")
}

mtext("age", 1, outer=TRUE,cex=1.2)
mtext("shoot extension (mm)", 2, outer=TRUE,cex=1.2)
```

###Diameter increase in shoots vs. whole plant
- The slope of the relationship lessens with age  
- There is quite a bit of noise in the relationship  
- However, in many cases, older plants show less of a change in shoot diameter for a given change in basal diameter; the opposite pattern as is predicted if ever fewer shoots are sustaining growth  
- Instead, each shoot matters ever less to the overall increase in basal area in larger plants
- NOTE: Plots not correct right now - wrong number of points in some and definitely wrong coloring by age
```{r, echo=FALSE,message=FALSE}
par(mfrow=c(1,2), cex=1, omi=c(.1,.1,.1,.1), mai=c(1.1,1.1,1,0.6)) 
mod <- lm (growth_shoot_area ~ growth_stem_area*species*age,data=subset(SummaryInd, age>1.4))
plot((growth_shoot_area/10000) ~ growth_stem_area,data=subset(SummaryInd, age>1.4), log="xy",col=col.age2[as.factor(age)], pch=16)
abline(0,1)
words.bottom.right.logxy(mod)
legend("topleft",col=col.age, labels.age, pch=16, cex=1, bty="n")
anova(mod)
```

* For all species except BAER and HATE, growth in shoot (leader) area and basal stem area well correlated  
* there two species obviously much-branched, and the number of growing shoots probably matters more than what the leader is doing
```{r, echo=FALSE,message=FALSE}
yvar <- "growth_shoot_area"
xvar <- "growth_stem_area"

data <- subset(SummaryInd)
data <- split(data, data$species)
lmfits <- lapply(data, function(x) lm(log(x[[yvar]]) ~  log(x[[xvar]])))
results <- summarise_all_fits(lmfits)

results$r.squared <- round(results$r.squared,digits=3)
results$p.value <- round(results$p.value,digits=3)
results$a <- round(results$a,digits=2)
results$b <- round(results$b,digits=2)

results
```

* results by species  
* trying to color points by age, but can't get it to work correctly with loop. age stored as data$spp$age, but can't figure out syntax to call this within col  
```{r, echo=FALSE, message=FALSE, fig.width=21, fig.height=35}
par(mfrow=c(4,4), cex=1, omi=c(.7,.7,.1,.1), mai=c(.7,.9,.5,0.2)) 
yvar <- "growth_shoot_area"
xvar <- "growth_stem_area"

data <- subset(SummaryInd,age>2)
data <- split(data, data$species)

for(spp in names(data)) {
  plot_yvar_vs_xvar(data[[spp]], yvar, xvar, log="xy",
                    main=spp, xlab="", ylab="")
  }

legend("topleft",col=col.age2, labels.age2, pch=16, cex=1, bty="n")
mtext("growth in basal stem area", 1, outer=TRUE,cex=1.2)
mtext("growth in leader stem area", 2, outer=TRUE,cex=1.2)
```

### Leaf area versus plant size and height
```{r, echo=FALSE, message=FALSE, fig.width=14, fig.height=14}
par(mfrow=c(2,2), cex=1, omi=c(.1,.2,.1,.1), mai=c(1,1,.5,0.2)) 
plot(leaf_area~total_weight, SummaryInd,log="xy",col=col.age[as.factor(age)], pch=16)
mod <- lm(log(total_weight)~log(leaf_area), SummaryInd)
words.bottom.right.logxy(mod)

plot(leaf_area~prop_maxH, SummaryInd,log="y",col=col.age[as.factor(age)], pch=16)

plot(leaf_area~total_weight, SummaryInd,log="xy",col=col.spp[as.factor(species)], pch=16)
words.bottom.right.logxy(mod)

plot(leaf_area~prop_maxH, SummaryInd,log="y",col=col.spp[as.factor(species)], pch=16)
```

### Leaf weight versus plant size and height
* One of the things I find most interesting here is how different clusters of species follow different trajectories (4th graph)  
* BAER, HATE, PELA, and PEPU have similar curves to one another; then comes a band with GRBU and GRSP, followed by all other species except PILI  
* oldest plants (&PILI) fall below the main line of points  
```{r, echo=FALSE, message=FALSE, fig.width=14, fig.height=14}
par(mfrow=c(2,2), cex=1, omi=c(.1,.2,.1,.1), mai=c(1,1,.5,0.2)) 
plot(leaf_weight~total_weight, SummaryInd,log="xy",col=col.age[as.factor(age)], pch=16)
mod <- lm(log(total_weight)~log(leaf_weight), SummaryInd)
words.bottom.right.logxy(mod)

plot(leaf_weight~prop_maxH, SummaryInd,log="y",col=col.age[as.factor(age)], pch=16)

plot(leaf_weight~total_weight, SummaryInd,log="xy",col=col.spp[as.factor(species)], pch=16)
words.bottom.right.logxy(mod)

plot(leaf_weight~prop_maxH, SummaryInd,log="y",col=col.spp[as.factor(species)], pch=16)
```


###changes in leaf growth and area over time
* different species have different leaf area/growth to stem weight - in particular, the "canopy species" have higher leaf area relative to their stem weight
* all species show declines in leaf weight vs. stem weight as they age, but this is a much smaller effect than the across species effect
```{r, echo=FALSE, message=FALSE, fig.width=14, fig.height=14}
mod <- lm(leaf_area ~stem_weight*species*age, SummaryInd)
anova(mod)

par(mfrow=c(2,2), cex=1, omi=c(.1,.2,.1,.1), mai=c(1,1,.5,0.2)) 
plot((RGR_leaf)~(RGR_stem), SummaryInd,col=col.age[as.factor(age)], pch=16,ylim=c(-1,4))
abline(0,0)
abline(0,1)
legend("topleft",col=col.age, labels.age, pch=16, cex=1, bty="n")

plot((leaf_area)~(stem_weight), SummaryInd,col=col.age[as.factor(age)], pch=16,log="xy")
abline(0,1)
text(1000,1800,srt=39,labels="1:1 line")

plot((RGR_leaf)~(RGR_stem), SummaryInd,col=col.spp[as.factor(species)], pch=16,ylim=c(-1,4),xlab="")
abline(0,0)
abline(0,1)
legend("topleft",col=col.spp, legend=names(labels.spp), pch=16, cex=.9, bty="n")

plot((leaf_area)~(stem_weight), SummaryInd,col=col.spp[as.factor(species)], pch=16,log="xy",xlab="")
abline(0,1)
text(1000,1800,srt=39,labels="1:1 line")
words.bottom.right.logxy(mod)
```

##Comparing growth rates of species with different trait values
* same as for Anais review, looking at growth rates against maxH, leaf area, wood density, LMA, leaf lifespan, and seedsize
* splitting plants into seedlings (1 yr), saplings (2 yr), and adults (3+ yrs)  
* RGR never "adds" to the analyses - which suggests "seedlings" are already past being "seedlings"  
* I do have half year diameters for youngest plants

### Species with larger seeds have higher growth rates  
- The same basic relationship exists across all ages, so combined all data here  
```{r, echo=FALSE,message=FALSE, fig.width=7, fig.height=7}
par(mfrow=c(1,1), cex=1, omi=c(.1,.1,.1,.1), mai=c(1.1,1.1,1,0.6)) 
plot(GrowthInv_mean ~ seed_size,data=subset(SummarySppAge,age>.5),log="xy",col=col.age[as.factor(age)],pch=16,cex=1,xlab="seed size (mg)",ylab="growth investment (mg per year)",main="Effect of seed size on growth rates")
legend("topleft",col=col.age, labels.age, pch=16, cex=1,bty="n")
text(GrowthInv_mean ~ seed_size, data=subset(SummarySppAge,age==9), labels=species, pos=2, offset=-2.4, cex=0.9,col="blue")
```

### Species with greater maximum height have higher growth rates
- For younger plants there is no relationship with *SPECIES* overall maximum H  
- There is a positive correlation with the maximum height the species reaches at a given age -i.e. fast growing young plants are tall when young.  
```{r, echo=FALSE,message=FALSE,fig.width=14, fig.height=14}
par(mfrow=c(2,2), cex=1, omi=c(.5,0.3,.1,0.2), mai=c(.5,1,.6,0.2)) 
plot(GrowthInv_mean ~ maxH,data=subset(SummarySppAge,age==1.4),log="xy",col=col.age[as.factor(age)],pch=16,cex=1,xlab="",ylab="",main="Seedlings")
text(GrowthInv_mean ~ maxH, data=subset(SummarySppAge,age==1.4), labels=species, pos=1, offset=-1.1, cex=0.7,col="blue")
mod <- lm(GrowthInv_mean ~ maxH, data=subset(SummarySppAge,age==1.4))
words.bottom.right.logxy(mod)

plot(GrowthInv_mean ~ maxH,data=subset(SummarySppAge,age==2.4),log="xy",col="gold1",pch=16,cex=1,xlab="",ylab="",main="Saplings")
text(GrowthInv_mean ~ maxH, data=subset(SummarySppAge,age==2.4), labels=species, pos=1, offset=-1.1, cex=0.7,col="blue")
mod <- lm(GrowthInv_mean ~ maxH, data=subset(SummarySppAge,age==2.4))
words.bottom.right.logxy(mod)


plot(GrowthInv_mean ~ maxH,data=subset(SummarySppAge,age>3),log="xy",col=col.age3[as.factor(age)],pch=16,cex=1,xlab="",ylab="",main="Adults")
text(GrowthInv_mean ~ maxH, data=subset(SummarySppAge,age==5), labels=species, pos=1, offset=-1.1, cex=0.6,col="blue")
mod <- lm(GrowthInv_mean ~ maxH, data=subset(SummarySppAge,age>3))
words.bottom.right.logxy(mod)
legend("topleft",col=col.age,labels.age,pch=16, bty="n")

mtext("maximum H",1,outer=TRUE)
mtext("yearly growth (mg)",2,outer=TRUE)
```

### Species with higher wood density have lower growth rates  
- Adult plants strongly show this pattern
- However there is no relationship in younger plants  
```{r, echo=FALSE,message=FALSE,fig.width=14, fig.height=14}
par(mfrow=c(2,2), cex=1, omi=c(.5,0.3,.1,0.2), mai=c(.5,1,.6,0.2)) 
plot(GrowthInv_mean ~ WD_mean,data=subset(SummarySppAge,age==1.4),log="xy",col=col.age[as.factor(age)],pch=16,cex=1,xlab="",ylab="",main="Seedlings")
text(GrowthInv_mean ~ WD_mean, data=subset(SummarySppAge,age==1.4), labels=species, pos=1, offset=-1.1, cex=0.7,col="blue")
mod <- lm(GrowthInv_mean ~ WD_mean, data=subset(SummarySppAge,age==1.4))
words.bottom.left.logxy(mod)

plot(GrowthInv_mean ~ WD_mean,data=subset(SummarySppAge,age==2.4),log="xy",col="gold1",pch=16,cex=1,xlab="",ylab="",main="Saplings")
text(GrowthInv_mean ~ WD_mean, data=subset(SummarySppAge,age==2.4), labels=species, pos=1, offset=-1.1, cex=0.7,col="blue")
mod <- lm(GrowthInv_mean ~ WD_mean, data=subset(SummarySppAge,age==2.4))
words.bottom.left.logxy(mod)
legend("topright",col=col.age,labels.age,pch=16, bty="n")

plot(GrowthInv_mean ~ WD_mean,data=subset(SummarySppAge,age>3),log="xy",col=col.age3[as.factor(age)],pch=16,cex=1,xlab="",ylab="",main="Adults")
text(GrowthInv_mean ~ WD_mean, data=subset(SummarySppAge,age==5), labels=species, pos=1, offset=-1.1, cex=0.6,col="blue")
mod <- lm(GrowthInv_mean ~ WD_mean, data=subset(SummarySppAge,age>3))
words.bottom.left.logxy(mod)

mtext("wood density",1,outer=TRUE)
mtext("yearly growth (mg)",2,outer=TRUE)
```

* same wood density data plotted against RGR instead - also no pattern with young
```{r, echo=FALSE,message=FALSE,fig.width=14, fig.height=7}
par(mfrow=c(1,2), cex=1, omi=c(.5,0.3,.1,0.2), mai=c(.5,1,.6,0.2)) 
plot(RGR_mean ~ WD_mean,data=subset(SummarySppAge,age==1.4),log="xy",col=col.age[as.factor(age)],pch=16,cex=1,xlab="",ylab="",main="Seedlings")
text(RGR_mean ~ WD_mean, data=subset(SummarySppAge,age==1.4), labels=species, pos=1, offset=-1.1, cex=0.7,col="blue")
mod <- lm(RGR_mean ~ WD_mean, data=subset(SummarySppAge,age==1.4))
words.bottom.right.logxy(mod)

plot(RGR_mean ~ WD_mean,data=subset(SummarySppAge,age==2.4),log="xy",col="gold1",pch=16,cex=1,xlab="",ylab="",main="Saplings")
text(RGR_mean ~ WD_mean, data=subset(SummarySppAge,age==2.4), labels=species, pos=1, offset=-1.1, cex=0.7,col="blue")
mod <- lm(RGR_mean ~ WD_mean, data=subset(SummarySppAge,age==2.4))
words.bottom.right.logxy(mod)
legend("topright",col=col.age,labels.age,pch=16, bty="n")

mtext("wood density",1,outer=TRUE)
mtext("RGR",2,outer=TRUE)
```

### Leaf area vs growth investment
```{r, echo=FALSE,message=FALSE,fig.width=14, fig.height=14}
par(mfrow=c(2,2), cex=1, omi=c(.5,0.3,.1,0.2), mai=c(.5,1,.6,0.2)) 
plot(GrowthInv_mean ~ leaf_area_mean,data=subset(SummarySppAge,age==1.4),log="xy",col=col.age[as.factor(age)],pch=16,cex=1,xlab="",ylab="",main="Seedlings",ylim=c(100,50000))
text(GrowthInv_mean ~ leaf_area_mean, data=subset(SummarySppAge,age==1.4), labels=species, pos=1, offset=-1.1, cex=0.7,col="blue")
mod <- lm(GrowthInv_mean ~ leaf_area_mean, data=subset(SummarySppAge,age==1.4))
words.bottom.right.logxy(mod)

plot(GrowthInv_mean ~ leaf_area_mean,data=subset(SummarySppAge,age==2.4),log="xy",col="gold1",pch=16,cex=1,xlab="",ylab="",main="Saplings",ylim=c(100,100000))
text(GrowthInv_mean ~ leaf_area_mean, data=subset(SummarySppAge,age==2.4), labels=species, pos=1, offset=-1.1, cex=0.7,col="blue")
mod <- lm(GrowthInv_mean ~ leaf_area_mean, data=subset(SummarySppAge,age==2.4))
words.bottom.right.logxy(mod)


plot(GrowthInv_mean ~ leaf_area_mean,data=subset(SummarySppAge,age>3),log="xy",col=col.age3[as.factor(age)],pch=16,cex=1,xlab="",ylab="",main="Adults",ylim=c(100,1000000))
text(GrowthInv_mean ~ leaf_area_mean, data=subset(SummarySppAge,age==7), labels=species, pos=1, offset=-1.1, cex=0.6,col="blue")
mod <- lm(GrowthInv_mean ~ leaf_area_mean, data=subset(SummarySppAge,age>3))
words.bottom.right.logxy(mod)
legend("topleft",col=col.age,labels.age,pch=16, bty="n")

mtext("leaf area",1,outer=TRUE)
mtext("yearly growth (mg)",2,outer=TRUE)
```

### Species with higher LMA have higher growth rates  
- This pattern is true for adult plants  
- But there is no relationship in seedlings (age=1.4) or saplings (age=2.4)  
- This is not predicted by Daniel's model or Anais' review; re-runing with RGR yields same results
- But relationship in adults disappears when HATE is removed...
```{r, echo=FALSE,message=FALSE,fig.width=14, fig.height=14}
par(mfrow=c(2,2), cex=1, omi=c(.5,0.3,.1,0.2), mai=c(.5,1,.6,0.2)) 
plot(GrowthInv_mean ~ LMA_mean,data=subset(SummarySppAge,age==1.4),log="xy",col=col.age[as.factor(age)],pch=16,cex=1,xlab="",ylab="",main="Seedlings")
text(GrowthInv_mean ~ LMA_mean, data=subset(SummarySppAge,age==1.4), labels=species, pos=1, offset=-1.1, cex=0.7,col="blue")
mod <- lm(GrowthInv_mean ~ LMA_mean, data=subset(SummarySppAge,age==1.4))
words.bottom.right.logxy(mod)

plot(GrowthInv_mean ~ LMA_mean,data=subset(SummarySppAge,age==2.4),log="xy",col="gold1",pch=16,cex=1,xlab="",ylab="",main="Saplings")
text(GrowthInv_mean ~ LMA_mean, data=subset(SummarySppAge,age==2.4), labels=species, pos=1, offset=-1.1, cex=0.7,col="blue")
mod <- lm(GrowthInv_mean ~ LMA_mean, data=subset(SummarySppAge,age==2.4))
words.bottom.right.logxy(mod)
legend("topright",col=col.age,labels.age,pch=16, bty="n")

plot(GrowthInv_mean ~ LMA_mean,data=subset(SummarySppAge,age>3),log="xy",col=col.age3[as.factor(age)],pch=16,cex=1,xlab="",ylab="",main="Adults")
text(GrowthInv_mean ~ LMA_mean, data=subset(SummarySppAge,age>3), labels=species, pos=1, offset=-1.1, cex=0.6,col="blue")
mod <- lm(GrowthInv_mean ~ LMA_mean, data=subset(SummarySppAge,age>3))
words.bottom.right.logxy(mod)

plot(GrowthInv_mean ~ LMA_mean,data=subset(SummarySppAge,age>3&species!="HATE"),log="xy",col=col.age3[as.factor(age)],pch=16,cex=1,xlab="",ylab="",main="Adults")
text(GrowthInv_mean ~ LMA_mean, data=subset(SummarySppAge,age>3&species!="HATE"), labels=species, pos=1, offset=-1.1, cex=0.6,col="blue")
mod <- lm(GrowthInv_mean ~ LMA_mean, data=subset(SummarySppAge,age>3&species!="HATE"))
words.bottom.right.logxy(mod)

mtext("LMA",1,outer=TRUE)
mtext("yearly growth (mg)",2,outer=TRUE)
```

###Leaf lifespan vs growth investment
- There is no relationship between leaf lifespan and growth investment for any age group
- And just barely a significant relationship between RGR and leaflifespan for adult plants
```{r, echo=FALSE,message=FALSE,fig.width=14, fig.height=14}
par(mfrow=c(2,2), cex=1, omi=c(.5,0.3,.1,0.2), mai=c(.5,1,.6,0.2))
plot(GrowthInv_mean ~ LL_death_mean,data=subset(SummarySppAge,age==1.4),log="xy",col=col.age[as.factor(age)],pch=16,cex=1,xlab="",ylab="",main="Seedlings")
text(GrowthInv_mean ~ LL_death_mean, data=subset(SummarySppAge,age==1.4), labels=species, pos=1, offset=-1.1, cex=0.7,col="blue")
mod <- lm(log(LL_death_mean)~log(GrowthInv_mean), data=subset(SummarySppAge,age==1.4))
words.bottom.right.logxy(mod)

plot(GrowthInv_mean ~ LL_death_mean,data=subset(SummarySppAge,age==2.4),log="xy",col="gold1",pch=16,cex=1,xlab="",ylab="",main="Saplings")
text(GrowthInv_mean ~ LL_death_mean, data=subset(SummarySppAge,age==2.4), labels=species, pos=1, offset=-1.1, cex=0.7,col="blue")
mod <- lm(GrowthInv_mean ~ LL_death_mean, data=subset(SummarySppAge,age==2.4))
words.bottom.right.logxy(mod)

plot(GrowthInv_mean ~ LL_death_mean,data=subset(SummarySppAge,age>3),log="xy",col=col.age3[as.factor(age)],pch=16,cex=1,xlab="",ylab="",main="Adults")
text(GrowthInv_mean ~ LL_death_mean, data=subset(SummarySppAge,age>3), labels=species, pos=1, offset=-1.1, cex=0.6,col="blue")
mod <- lm(GrowthInv_mean ~ LL_death_mean, data=subset(SummarySppAge,age>3))
legend("topright",col=col.age,labels.age,pch=16, bty="n")
words.bottom.right.logxy(mod)

mtext("leaf lifespan",1,outer=TRUE)
mtext("yearly growth (mg)",2,outer=TRUE)
```

###PCA analysis
* This combination of variables shows that RGR is approximately opposite a collection of variables that indicate a plant is "bigger" - so smaller plants have higher RGR
* Orthoganal to these in WD vs. maxH, LMA_mean, seed_size, and shoot_growth - species that are taller as adults have bigger seeds, higher LMA, and greater shoot growth (both stem growth & leaf count), independent of their current (age dependent) size
* this analysis doesn't include accessory proportions, because then I have to use subset of reproducing individuals - see below - greatly reducing sample size
* fine tuning:  
  ** remove RGR leaf (similar to RGR)
  ** remove prop_max_weight and prop_max_repro (similar to prop_maxH)

```{r, echo=FALSE,message=FALSE,fig.width=7, fig.height=7}
par(mfrow=c(1,1), cex=1, omi=c(.5,0.3,.1,0.2), mai=c(1.1,1,.6,0.2))
SummaryIndPCA <- SummaryInd %>%
  filter(lvs_end_total>0&shoot_leaf_area>0&shoot_leaf_area_growth!=0) %>%
  select(prop_maxH,height,maxH,WD_mean,LMA_mean,seed_size,growth_leaf,
         RGR,leaf_area,growth_shoot_area,growth_stem_area,lvs_end_total,total_weight,
         RA,seedset,repro_all_count,accessory_inv,propagule_inv,shoot_leaf_area,shoot_leaf_area_growth)

SummaryIndPCA$leaf_area <- log((SummaryIndPCA$leaf_area)+.001)
SummaryIndPCA$total_weight <- log(SummaryIndPCA$total_weight)
SummaryIndPCA$height <- log(SummaryIndPCA$height)
SummaryIndPCA$maxH <- log(SummaryIndPCA$maxH)
SummaryIndPCA$seed_size <- log(SummaryIndPCA$seed_size)
SummaryIndPCA$accessory_inv <- log(SummaryIndPCA$accessory_inv+.001)
SummaryIndPCA$propagule_inv <- log(SummaryIndPCA$propagule_inv+.001)
SummaryIndPCA$growth_shoot_area <- log(SummaryIndPCA$growth_shoot_area)
SummaryIndPCA$growth_leaf <- log(SummaryIndPCA$growth_leaf+10000)
SummaryIndPCA$repro_all_count <- log(SummaryIndPCA$repro_all_count+1)
SummaryIndPCA$lvs_end_total <- log(SummaryIndPCA$lvs_end_total)
SummaryIndPCA$growth_stem_area <- log(SummaryIndPCA$growth_stem_area)
SummaryIndPCA$shoot_leaf_area <- log(SummaryIndPCA$shoot_leaf_area)
SummaryIndPCA$shoot_leaf_area_growth <- log(SummaryIndPCA$shoot_leaf_area_growth)

PCA_mod <- prcomp(SummaryIndPCA, scale=TRUE)
summary(PCA_mod)
biplot(PCA_mod,xlim=c(-.1,.15),ylim=c(-.1,.1),cex=.8)

PCA_loadings <- as.data.frame(PCA_mod$rotation)
PCA_loadings$variables <- row.names(PCA_loadings)

PCA_scaling <- as.data.frame(PCA_mod$scale)
PCA_scaling$variables <- row.names(PCA_scaling)
names(PCA_scaling) <- c("scale","variables")
PCA_loadings <- merge(PCA_loadings,PCA_scaling,by="variables")

PCA_lambda <- as.data.frame(PCA_mod$sdev)

PCA_scores <- as.data.frame(PCA_mod$x)
PCA_scores$individual <- subset(SummaryInd$individual, SummaryInd$lvs_end_total>0&SummaryInd$shoot_leaf_area_growth!=0)
SummaryInd_PCA_results <- merge(SummaryInd,PCA_scores, by="individual", all.x=TRUE)

n <- NROW(PCA_scores)
scale =1

PCA_lambda <- PCA_lambda*sqrt(n)
PCA_lambda <- PCA_lambda^scale

SummaryInd_PCA_results$PC1_scale <- SummaryInd_PCA_results$PC1/PCA_lambda[1]
SummaryInd_PCA_results$PC2_scale <- SummaryInd_PCA_results$PC2/PCA_lambda[2]
SummaryInd_PCA_results$PC3_scale <- SummaryInd_PCA_results$PC3/PCA_lambda[3]
SummaryInd_PCA_results$PC4_scale <- SummaryInd_PCA_results$PC4/PCA_lambda[4]
PCA_loadings$PC1_scale <- PCA_loadings$PC1 / 4.5
PCA_loadings$PC2_scale <- PCA_loadings$PC2 / 4.5
PCA_loadings$PC3_scale <- PCA_loadings$PC3 / 4.5
PCA_loadings$PC4_scale <- PCA_loadings$PC4 / 4.5
```

#Looking at PCA by species
* Main axes are (1) across species affects in trait values (PC1) and (2) within species shifts in RGR vs RA with plant size/age (PC2)
* PC1 is WD vs a whole collection of traits that have higher "values" in plants that are larger as adults, including measures of size, height, and growth increment; PELA is a rare exception in shifting along this axis. 
* PC2 most strongly separates RGR from RA (and a collection of strongly correlated traits, such as propagule investment, prop maxH). 
* PC3 primarily separates LMA and maxH from WD; high wood density is also somewhat associated with higher RGR and various shoot growth and leafiness measures, reflecting that younger individuals have more shoot growth and higher RGR 
* PC4 is effectively leaf count on shoots ("lvs_end_total") and seed set vs. seed size, shoot leaf area and shoot leaf area growth - to first order, some plants have lots of small leaves and others have fewer leaves but greater leaf area, Not sure how seed size fits in

* amazing that RA and RGR almost completely orthoganal to PC1 and PC4; To reiterate, RA and RGR are 2 variables that shift across each species' lifetime and much less across species. I suspect the inter-specific difference are effectively what proportion of individuals in this study are reproductively mature - with early maturing species having overall higher RA and lower RGR (i.e. BOLE) than do late maturing species (i.e. PELA). 

* Continuing, RGR and RA are measures that give little insight to a species trait values - or vice versa, trait values do not provide much information about RA...

* "growth_stem_area" and "growth leaf", two whole plant measures of size increase are orthoganal to RGR, while some shoot-level variables (i.e. "growth_shoot_area") and other whole plant variables (e.g. "leaf_area_growth"), are somewhat correlated with both RGR (PC2) and the "maxH" direction (PC1). I suppose this suggests that for plants with high

* For PC2, interesting that "growth_shoot_area"" and other variables associated with shoot growth and species max H correlate somewhat with RGR, but "growth_stem_area" and other whole plant "size" variables do not
* these plots are another way of affirming that RA (and RGR) is a variable that does a good job of comparing trends across species * in other words there is a trade-off between RA and RGR in all species. And even though the RA trends are messy, individuals that are proportionally taller (prop_maxH) or invest more in reproduction (investment, count, or seedset) have a higher RA. 

* this last set of variables are all ones that do not vary with the PC1 axis

PCA related code to keep:  
* plot(PCA_mod)
* pairs(SummaryIndPCA,log="xy")
* yy <- t(t(PCA_loadings[,2:3])*PCA_lambda[1:2])
* xx <- t(t(SummaryInd_PCA_results[,105:106])/PCA_lambda[1:2])
* biplot(xx,yy)
```{r, echo=FALSE,message=FALSE,fig.width=14, fig.height=14}
par(mfrow=c(2,2), cex=1, omi=c(.5,0.3,.1,0.2), mai=c(1.1,1,.6,0.2))

PCA_by_species <- SummaryInd_PCA_results %>%
  filter(lvs_end_total>0) %>%
  group_by(species) %>%
  summarise_each(funs(mean, se), PC1_scale, PC2_scale, PC3_scale, PC4_scale)

plot(PC1_scale~(PC2_scale),SummaryInd_PCA_results,pch=16,col=col.spp[as.factor(species)],xlim=c(-.1,.1))
arrows(0, 0, (.9*PCA_loadings$PC2_scale), (.9*PCA_loadings$PC1_scale), length = 0.25, angle = 30, code = 2, col = "red",lwd=2)
text(PC1_scale ~ PC2_scale, PCA_loadings, labels=variables, pos=1, offset=0, cex=1,col="black")
legend("topright",legend=names(labels.spp),col=col.spp,pch=16, cex=.8,bty="n")

mean1 <- PCA_by_species$PC1_scale_mean
se1 <- PCA_by_species$PC1_scale_se
plot(mean1~species,PCA_by_species,cex.axis=.5,pch=16,ylab="PCA axis 1")
se_function(mean1,se1)

plot(PC2_scale~(PC1_scale),SummaryInd_PCA_results,pch=16,col=col.spp[as.factor(species)])
arrows(0, 0, (.9*PCA_loadings$PC1_scale), (.9*PCA_loadings$PC2_scale), length = 0.25, angle = 30, code = 2, col = "red",lwd=2)
text(PC2_scale ~ PC1_scale, PCA_loadings, labels=variables, pos=1, offset=0, cex=1,col="black")

mean1 <- PCA_by_species$PC2_scale_mean
se1 <- PCA_by_species$PC2_scale_se
plot(mean1~species,PCA_by_species,cex.axis=.5,pch=16,ylab="PCA axis 2")
se_function(mean1,se1)

plot(PC3_scale~PC1_scale,SummaryInd_PCA_results,pch=16,col=col.spp[as.factor(species)])
arrows(0, 0, (.9*PCA_loadings$PC1_scale), (.9*PCA_loadings$PC3_scale), length = 0.25, angle = 30, code = 2, col = "red",lwd=2)
text(PC3_scale ~ PC1_scale, PCA_loadings, labels=variables, pos=1, offset=0, cex=1,col="black")

mean1 <- PCA_by_species$PC3_scale_mean
se1 <- PCA_by_species$PC3_scale_se
plot(mean1~species,PCA_by_species,cex.axis=.5,pch=16,ylab="PCA axis 3")
se_function(mean1,se1)

plot(PC4_scale~PC1_scale,SummaryInd_PCA_results,pch=16,col=col.spp[as.factor(species)],ylim=c(-.15,.15))
arrows(0, 0, (.9*PCA_loadings$PC1_scale), (.9*PCA_loadings$PC4_scale), length = 0.25, angle = 30, code = 2, col = "red",lwd=2)
text(PC4_scale ~ PC1_scale, PCA_loadings, labels=variables, pos=1, offset=0, cex=1,col="black")
legend("topright",legend=names(labels.spp),col=col.spp,pch=16, cex=.8,bty="n")

mean1 <- PCA_by_species$PC4_scale_mean
se1 <- PCA_by_species$PC4_scale_se
plot(mean1~species,PCA_by_species,cex.axis=.5,pch=16,ylab="PCA axis 4",,ylim=c(-.07,.04))
se_function(mean1,se1)
```

###Coloring data by age
* this confirms that PC2 is an axis the changes primarly by age - it is the RGR vs reproduction shift
* PC1 has a slight age component, but more about species - across species, plant size is mostly a species effect, but of course age also matters
* PC3 & PC4 all about species

```{r, echo=FALSE,message=FALSE,fig.width=14, fig.height=14}
par(mfrow=c(2,2), cex=1, omi=c(.5,0.3,.1,0.2), mai=c(1.1,1,.6,0.2))

plot(PC2_scale~(PC1_scale),SummaryInd_PCA_results,pch=16,col=col.age[as.factor(age)])
arrows(0, 0, (.9*PCA_loadings$PC1_scale), (.9*PCA_loadings$PC2_scale), length = 0.25, angle = 30, code = 2, col = "red",lwd=2)
text(PC2_scale ~ PC1_scale, PCA_loadings, labels=variables, pos=1, offset=0, cex=1,col="black")
legend("topright",legend=names(labels.spp),col=col.spp,pch=16, cex=.8,bty="n")

plot(PC3_scale~PC1_scale,SummaryInd_PCA_results,pch=16,col=col.age[as.factor(age)])
arrows(0, 0, (.9*PCA_loadings$PC1_scale), (.9*PCA_loadings$PC3_scale), length = 0.25, angle = 30, code = 2, col = "red",lwd=2)
text(PC3_scale ~ PC1_scale, PCA_loadings, labels=variables, pos=1, offset=0, cex=1,col="black")

plot(PC4_scale~PC1_scale,SummaryInd_PCA_results,pch=16,col=col.age[as.factor(age)],ylim=c(-.15,.12))
arrows(0, 0, (.9*PCA_loadings$PC1_scale), (.9*PCA_loadings$PC4_scale), length = 0.25, angle = 30, code = 2, col = "red",lwd=2)
text(PC4_scale ~ PC1_scale, PCA_loadings, labels=variables, pos=1, offset=0, cex=1,col="black")

plot(PC3_scale~PC2_scale,SummaryInd_PCA_results,pch=16,col=col.age[as.factor(age)])
arrows(0, 0, (.9*PCA_loadings$PC2_scale), (.9*PCA_loadings$PC3_scale), length = 0.25, angle = 30, code = 2, col = "red",lwd=2)
text(PC3_scale ~ PC2_scale, PCA_loadings, labels=variables, pos=1, offset=0, cex=1,col="black")
```

### Looking only at reproducing individuals - 
* can now add in "prop_propagule","prop_accessory", but not "accessory_per_seed"
* changes patterns quite a bit
* PC1 is still WD vs lots of growth variables, but now absolute measures of reproductive investment (propagule_inv and accessory_inv) associate with absolute "big size" not high RA
* PC2 is RA, seedset, and prop_propagule vs. RGR, shoot growth variables and prop_accessory; not surprising that prop_propagule and prop_accessory pulled to opposite ends
* PC3 is somewhat similar. It is also prop_accessory and prop_maxH vs seed set and prop_propagule, but it now separates out all the shoot growth values
* PC4 is now the axis that separates LMA_mean and maxH vs. WD_mean, with variables like maxH pulling toward all the "big size" arrows

```{r, echo=FALSE,message=FALSE,fig.width=7, fig.height=7}
par(mfrow=c(1,1), cex=1, omi=c(.5,0.3,.1,0.2), mai=c(1.1,1,.6,0.2))
SummaryIndPCA <- SummaryInd %>%
  filter(lvs_end_total>0&accessory_inv>0&shoot_leaf_area_growth!=0) %>%
  select(prop_maxH,height,maxH,WD_mean,LMA_mean,seed_size,growth_leaf,
         RGR,leaf_area,growth_shoot_area,growth_stem_area,lvs_end_total,total_weight,
         RA,seedset,repro_all_count,accessory_inv,propagule_inv,shoot_leaf_area,shoot_leaf_area_growth,
         prop_propagule, prop_accessory)

SummaryIndPCA$leaf_area <- log((SummaryIndPCA$leaf_area)+.001)
SummaryIndPCA$total_weight <- log(SummaryIndPCA$total_weight)
SummaryIndPCA$height <- log(SummaryIndPCA$height)
SummaryIndPCA$maxH <- log(SummaryIndPCA$maxH)
SummaryIndPCA$seed_size <- log(SummaryIndPCA$seed_size)
SummaryIndPCA$accessory_inv <- log(SummaryIndPCA$accessory_inv+.001)
SummaryIndPCA$propagule_inv <- log(SummaryIndPCA$propagule_inv+.001)
SummaryIndPCA$growth_shoot_area <- log(SummaryIndPCA$growth_shoot_area)
SummaryIndPCA$growth_leaf <- log(SummaryIndPCA$growth_leaf+10000)
SummaryIndPCA$repro_all_count <- log(SummaryIndPCA$repro_all_count+1)
SummaryIndPCA$lvs_end_total <- log(SummaryIndPCA$lvs_end_total)
SummaryIndPCA$growth_stem_area <- log(SummaryIndPCA$growth_stem_area)
SummaryIndPCA$shoot_leaf_area <- log(SummaryIndPCA$shoot_leaf_area)
SummaryIndPCA$shoot_leaf_area_growth <- log(SummaryIndPCA$shoot_leaf_area_growth)

PCA_mod <- prcomp(SummaryIndPCA, scale=TRUE)
summary(PCA_mod)
biplot(PCA_mod)

PCA_loadings <- as.data.frame(PCA_mod$rotation)
PCA_loadings$variables <- row.names(PCA_loadings)

PCA_scaling <- as.data.frame(PCA_mod$scale)
PCA_scaling$variables <- row.names(PCA_scaling)
names(PCA_scaling) <- c("scale","variables")
PCA_loadings <- merge(PCA_loadings,PCA_scaling,by="variables")

PCA_lambda <- as.data.frame(PCA_mod$sdev)

PCA_scores <- as.data.frame(PCA_mod$x)
PCA_scores$individual <- subset(SummaryInd$individual, SummaryInd$lvs_end_total>0&SummaryInd$shoot_leaf_area_growth!=0&SummaryInd$accessory_inv>0)
SummaryInd_PCA_results <- merge(SummaryInd,PCA_scores, by="individual", all.x=TRUE)

n <- NROW(PCA_scores)
scale =1

PCA_lambda <- PCA_lambda*sqrt(n)
PCA_lambda <- PCA_lambda^scale

SummaryInd_PCA_results$PC1_scale <- SummaryInd_PCA_results$PC1/PCA_lambda[1]
SummaryInd_PCA_results$PC2_scale <- SummaryInd_PCA_results$PC2/PCA_lambda[2]
SummaryInd_PCA_results$PC3_scale <- SummaryInd_PCA_results$PC3/PCA_lambda[3]
SummaryInd_PCA_results$PC4_scale <- SummaryInd_PCA_results$PC4/PCA_lambda[4]
PCA_loadings$PC1_scale <- PCA_loadings$PC1 / 4.5
PCA_loadings$PC2_scale <- PCA_loadings$PC2 / 4.5
PCA_loadings$PC3_scale <- PCA_loadings$PC3 / 4.5
PCA_loadings$PC4_scale <- PCA_loadings$PC4 / 4.5
```

```{r, echo=FALSE,message=FALSE,fig.width=14, fig.height=14}
par(mfrow=c(2,2), cex=1, omi=c(.5,0.3,.1,0.2), mai=c(1.1,1,.6,0.2))

plot(PC2_scale~(PC1_scale),SummaryInd_PCA_results,pch=16,col=col.spp[as.factor(species)])
arrows(0, 0, (.9*PCA_loadings$PC1_scale), (.9*PCA_loadings$PC2_scale), length = 0.25, angle = 30, code = 2, col = "red",lwd=2)
text(PC2_scale ~ PC1_scale, PCA_loadings, labels=variables, pos=1, offset=0, cex=1,col="black")
legend("topright",legend=names(labels.spp),col=col.spp,pch=16, cex=.8,bty="n")

plot(PC3_scale~PC1_scale,SummaryInd_PCA_results,pch=16,col=col.spp[as.factor(species)])
arrows(0, 0, (.9*PCA_loadings$PC1_scale), (.9*PCA_loadings$PC3_scale), length = 0.25, angle = 30, code = 2, col = "red",lwd=2)
text(PC3_scale ~ PC1_scale, PCA_loadings, labels=variables, pos=1, offset=0, cex=1,col="black")

plot(PC4_scale~PC1_scale,SummaryInd_PCA_results,pch=16,col=col.spp[as.factor(species)],ylim=c(-.15,.12))
arrows(0, 0, (.9*PCA_loadings$PC1_scale), (.9*PCA_loadings$PC4_scale), length = 0.25, angle = 30, code = 2, col = "red",lwd=2)
text(PC4_scale ~ PC1_scale, PCA_loadings, labels=variables, pos=1, offset=0, cex=1,col="black")

plot(PC3_scale~PC2_scale,SummaryInd_PCA_results,pch=16,col=col.spp[as.factor(species)])
arrows(0, 0, (.9*PCA_loadings$PC2_scale), (.9*PCA_loadings$PC3_scale), length = 0.25, angle = 30, code = 2, col = "red",lwd=2)
text(PC3_scale ~ PC2_scale, PCA_loadings, labels=variables, pos=1, offset=0, cex=1,col="black")
```

comparing
```{r, echo=FALSE,message=FALSE}
mod <- lm(RGR~species+asin(sqrt(RA))+prop_maxH+log(propagule_inv+1)+log(accessory_inv+1)+log(total_weight)+log(repro_all_count+1),SummaryInd)
anova(mod)
glance(mod)[1]


mod <- lm(RGR~asin(sqrt(RA))+prop_maxH+log(propagule_inv+1)+log(accessory_inv+1)+log(total_weight)+log(repro_all_count+1)+WD_mean+LMA_mean+maxH,SummaryInd)
anova(mod)
glance(mod)[1]
```

* another of the interesting pattern is that the increase in shoot area of leaders is correlated with maxH and seed_size (and opposite WD_mean) and somewhat offset from whole plant growth measures and whole plant size measures  
* seed_size removed, because no additional explanatory power after WD and maxH included


```{r, echo=FALSE,message=FALSE}
mod <- lm(log(growth_shoot_area)~log(maxH)+WD_mean+log(growth_stem_area)+log(total_weight)+RGR+asin(sqrt(RA))+LMA_mean,SummaryInd)
anova(mod)
glance(mod)
```

plot(mod)
###Traits correlated
- species maxH and wood density are highly correlated
- the two species lying a bit outside are PUTU and PHPH which both often have multiple stems from the base - the second chart omits them
-
```{r, echo=FALSE,message=FALSE,fig.width=14, fig.height=14}
par(mfrow=c(2,2), cex=1, omi=c(.5,0.3,.1,0.2), mai=c(1.1,1,.6,0.2))
plot(WD_mean~maxH,SummarySpp, log="x",col=col.spp[as.factor(species)],pch=16)
mod <- lm(log(maxH)~WD_mean,SummaryInd)
words.bottom.left.logx(mod)

plot(WD_mean~maxH,data=subset(SummarySpp,species!="PUTU"&species!="PHPH"), log="x",col=col.spp[as.factor(species)],pch=16)
mod <- lm(log(maxH)~WD_mean,data=subset(SummarySpp,species!="PUTU"&species!="PHPH"))
words.bottom.left.logx(mod)

plot(seedset_mean~total_weight_mean,SummarySpp, log="x",col=col.spp[as.factor(species)],pch=16)
mod <- lm(log(total_weight_mean) ~ (seedset_mean),SummarySpp)
words.bottom.left.logx(mod)

plot(seedset_mean~maxH,SummarySpp, log="x",col=col.spp[as.factor(species)],pch=16)
mod <- lm(log(maxH) ~ (seedset_mean),SummarySpp)
words.bottom.left.logx(mod)
