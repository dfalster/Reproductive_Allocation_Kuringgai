packages:
  - stringr
  - smatr
  - plyr
  - tidyr
  - dplyr
  - xtable
  - igraph
  - rmarkdown
  - broom

sources:
  - R

include:
  - remake_species_data.yml

plot_options:
  tall:
    width: 4
    height: 8
  extra_wide:
    width: 15
    height: 5
  wide:
    width: 8
    height: 4
  small_square:
    width: 4
    height: 4
  med_square:
    width: 6
    height: 6
  large_square:
    width: 8
    height: 8

targets:
  all:
    depends:
      - export

  CarbonInvestments.pdf:
    depends:
      - "CarbonInvestments.Rnw"
      - figures
    command: tex_2_pdf("CarbonInvestments.tex")

  # Data --------------------------------------
  IndividualsList:
    command: read_csv("data/individuals.csv")

  FlowerPartsData:
    command: read_csv("data/flowerParts.csv")

  Reproduction_raw:
    command: read_csv("data/reproduction.csv")

  ReproductionData:
    command: filterForAllocation(Reproduction_raw, IndividualsList)

  HarvestData_raw:
    command: read_csv("data/harvest.csv")

  HarvestData:
    command: preprocessHarvest(HarvestData_raw, IndividualsList)

  FloweringCategories:
    command: read_csv("data/flowerCategories.csv")

  MultiplierTable:
    command: read_csv("data/multiplierTable.csv")

  InvestmentCategories:
    command: read_csv("data/accessoryParts.csv")

  LMA:
    command:
      - read_csv("data/LMA.csv")
      - process_LMA(.)

  wood_density_spp:
    command:
      - read_csv("data/woodDensity.csv")
      - process_wood_density(.)

  seedsize:
    command:
      - read_csv("data/seedsize.csv")
      - process_seed_costs(., PartsSummary_all)
      - process_prepollination_costs(., PartsSummary_all)
      - process_dispersal_costs(., PartsSummary_all)

  leavesPerLength:
    command:
      - read_csv("data/leaves_per_length.csv")
      - process_leaves_per_length(.)

  leafLifespan:
    command:
      - read_csv("data/leaderGrowthLL.csv")
      - process_leaf_lifespan(., leavesPerLength)

  figures:
    depends:
      - figure/RA_comparison_age.pdf
      - figure/RA_comparison_diam.pdf
      - figure/RA_comparison_weight.pdf

  figure/RA_comparison_age.pdf:
    command: plot_ReproductionAllocation_comparison_age(ReproductionAllocation_all)
    plot: wide
  figure/RA_comparison_diam.pdf:
    command: plot_ReproductionAllocation_comparison_diam(ReproductionAllocation_all)
    plot: wide
  figure/RA_comparison_weight.pdf:
    command: plot_ReproductionAllocation_comparison_weight(ReproductionAllocation_all)
    plot: wide

  variable_list:
    command:
      - read_csv("data/variable_names.csv")

  SummaryInd1:
    command:
      - combine_by_individual(IndividualsList, ReproductionAllocation_all, Accessory_counts_all,
        AccessoryCosts_all, LMA, leafLifespan, wood_density_spp, seedsize)
      - sort_by_variable(., variable_list)

  SummarySppAge:
    command: get_species_values(SummaryInd1, groups=I(c("species", "age")))

  SummarySpp:
    command: get_species_values(SummaryInd1, groups=I("species"))

  SummaryInd_mature:
    command: filterToMature(SummaryInd1)

  SummarySpp_mature:
    command: get_species_values(SummaryInd_mature, groups=I("species"))

  SummaryInd:
    command: scale_individual_variable(SummaryInd1, SummarySpp)

  export:
    depends:
      - export/SummaryInd.rds
      - export/SummarySpp.rds
      - export/SummarySppAge.rds
      - export/HarvestData.rds
      - export/Investment_FD_all.rds

  export/SummaryInd.rds:
    command: saveRDS(SummaryInd, target_name)

  export/SummarySpp.rds:
    command: saveRDS(SummarySpp, target_name)

  export/SummarySppAge.rds:
    command: saveRDS(SummarySppAge, target_name)

  export/HarvestData.rds:
    command: saveRDS(HarvestData, target_name)

  export/Investment_FD_all.rds:
    command: saveRDS(Investment_FD_all, target_name)
